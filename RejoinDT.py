
import base64
exec(base64.b64decode('aW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCB0aW1lCmltcG9ydCBhc3luY2lvCmltcG9ydCBhaW9odHRwCmltcG9ydCBsb2dnaW5nCmltcG9ydCBoYXNobGliCmltcG9ydCB1dWlkCmltcG9ydCBwc3V0aWwKaW1wb3J0IHNxbGl0ZTMKaW1wb3J0IHNodXRpbAppbXBvcnQgc3VicHJvY2VzcwppbXBvcnQgcmVxdWVzdHMKaW1wb3J0IGJhc2U2NAppbXBvcnQgcGxhdGZvcm0KaW1wb3J0IHN5cwpmcm9tIGRhdGV0aW1lIGltcG9ydCBkYXRldGltZSwgdGltZWRlbHRhCmZyb20gY29sb3JhbWEgaW1wb3J0IGluaXQsIEZvcmUsIFN0eWxlCmZyb20gdHlwaW5nIGltcG9ydCBEaWN0LCBMaXN0LCBPcHRpb25hbCwgU2V0CmZyb20gcGF0aGxpYiBpbXBvcnQgUGF0aApmcm9tIHRhYnVsYXRlIGltcG9ydCB0YWJ1bGF0ZQoKIyBJbml0aWFsaXplIGNvbG9yYW1hIGFuZCBsb2dnaW5nCmluaXQoYXV0b3Jlc2V0PVRydWUpCmxvZ2dpbmcuYmFzaWNDb25maWcoCiAgICBsZXZlbD1sb2dnaW5nLklORk8sCiAgICBmb3JtYXQ9JyUoYXNjdGltZSlzIC0gJShsZXZlbG5hbWUpcyAtICUobWVzc2FnZSlzJywKICAgIGhhbmRsZXJzPVsKICAgICAgICBsb2dnaW5nLkZpbGVIYW5kbGVyKCd0b29sX2xvZy50eHQnLCBlbmNvZGluZz0ndXRmLTgnKSwKICAgICAgICBsb2dnaW5nLlN0cmVhbUhhbmRsZXIoKQogICAgXQopCmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKQoKIyBHaeG7ryBjaG8gVGVybXV4IGx1w7RuIGhv4bqhdCDEkeG7mW5nCnRyeToKICAgIHN1YnByb2Nlc3MucnVuKFsndGVybXV4LXdha2UtbG9jayddLCBjaGVjaz1UcnVlKQogICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkMOjIGvDrWNoIGhv4bqhdCB3YWtlIGxvY2sgxJHhu4MgZ2nhu68gVGVybXV4IGhv4bqhdCDEkeG7mW5nIiArIFN0eWxlLlJFU0VUX0FMTCkKZXhjZXB0OgogICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAiS2jDtG5nIHRo4buDIGvDrWNoIGhv4bqhdCB3YWtlIGxvY2ssIGPDsyB0aOG7gyBUZXJtdXg6QVBJIGNoxrBhIMSRxrDhu6NjIGPDoGkgxJHhurd0IiArIFN0eWxlLlJFU0VUX0FMTCkKCmNsYXNzIENvbmZpZzoKICAgIFNFUlZFUl9MSU5LU19GSUxFID0gIlByaXZhdGVfTGluay50eHQiCiAgICBBQ0NPVU5UU19GSUxFID0gIkFjY291bnQudHh0IgogICAgUEFDS0FHRV9GSUxFID0gIlBhY2thZ2UudHh0IiAgIyBOZXcgZmlsZSB0byBzdG9yZSBwYWNrYWdlIHBhdGhzCiAgICBESVNDT1JEX0NPTkZJR19GSUxFID0gImRpc2NvcmRfY29uZmlnLmpzb24iCiAgICBQUkVTRU5DRV9XRUJTT0NLRVRfVVJMID0gIndzczovL3ByZXNlbmNlLnJvYmxveC5jb20vdjEvcHJlc2VuY2UiCiAgICBDT09LSUVTX0ZJTEUgPSAiY29va2llLmpzb24iCiAgICBNQVhfUkVUUklFUyA9IDUKICAgIFJFVFJZX0RFTEFZID0gMwogICAgU1RBUlRVUF9ERUxBWSA9IDQ1CiAgICBIRUFSVEJFQVRfSU5URVJWQUwgPSAzMAogICAgUkVDT05ORUNUX0RFTEFZID0gNQogICAgTUFYX1JFQ09OTkVDVF9BVFRFTVBUUyA9IDMKICAgIEVSUk9SXzI3OV9SRVRSWV9ERUxBWSA9IDMwICAjIEFkZGVkIGRlbGF5IGZvciBlcnJvciAyNzkKICAgIExJQ0VOU0VfRklMRSA9ICJsaWNlbnNlLmRhdCIgICMgRmlsZSB0byBzdG9yZSBsaWNlbnNlIGtleQogICAgS0VZX1NFUlZFUl9VUkwgPSAiaHR0cHM6Ly9wcmlnYW1pbmcucHl0aG9uYW55d2hlcmUuY29tLy8vYXBpL3ZlcmlmeSIgICMgUmVwbGFjZSB3aXRoIHlvdXIgYWN0dWFsIHNlcnZlciBVUkwKCmNsYXNzIExpY2Vuc2VNYW5hZ2VyOgogICAgZGVmIF9faW5pdF9fKHNlbGYpOgogICAgICAgIHNlbGYubGljZW5zZV9maWxlID0gQ29uZmlnLkxJQ0VOU0VfRklMRQogICAgICAgIHNlbGYua2V5X3NlcnZlcl91cmwgPSBDb25maWcuS0VZX1NFUlZFUl9VUkwKICAgICAgICBzZWxmLmh3aWQgPSBzZWxmLmdldF9od2lkKCkKICAgICAgICAKICAgIGRlZiBnZXRfaHdpZChzZWxmKToKICAgICAgICAiIiJU4bqhbyBJRCBwaOG6p24gY+G7qW5nIGR1eSBuaOG6pXQgY2hvIHRoaeG6v3QgYuG7iyIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIHBo4bqnbiBj4bupbmcKICAgICAgICAgICAgc3lzdGVtX2luZm8gPSBwbGF0Zm9ybS51bmFtZSgpCiAgICAgICAgICAgIG1hY2hpbmVfaWQgPSAiIgogICAgICAgICAgICAKICAgICAgICAgICAgIyBUaOG7rSBs4bqleSBtYWNoaW5lLWlkIHThu6sgaOG7hyB0aOG7kW5nCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKCcvZXRjL21hY2hpbmUtaWQnKToKICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4oJy9ldGMvbWFjaGluZS1pZCcsICdyJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgbWFjaGluZV9pZCA9IGYucmVhZCgpLnN0cmlwKCkKICAgICAgICAgICAgICAgIGVsaWYgb3MucGF0aC5leGlzdHMoJy92YXIvbGliL2RidXMvbWFjaGluZS1pZCcpOgogICAgICAgICAgICAgICAgICAgIHdpdGggb3BlbignL3Zhci9saWIvZGJ1cy9tYWNoaW5lLWlkJywgJ3InKSBhcyBmOgogICAgICAgICAgICAgICAgICAgICAgICBtYWNoaW5lX2lkID0gZi5yZWFkKCkuc3RyaXAoKQogICAgICAgICAgICBleGNlcHQ6CiAgICAgICAgICAgICAgICBwYXNzCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEvhur90IGjhu6NwIHRow7RuZyB0aW4KICAgICAgICAgICAgY29tYmluZWQgPSBmIntzeXN0ZW1faW5mby5zeXN0ZW19e3N5c3RlbV9pbmZvLm5vZGV9e3N5c3RlbV9pbmZvLm1hY2hpbmV9e21hY2hpbmVfaWR9IgogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqhbyBoYXNoIHThu6sgdGjDtG5nIHRpbgogICAgICAgICAgICBod2lkID0gaGFzaGxpYi5tZDUoY29tYmluZWQuZW5jb2RlKCkpLmhleGRpZ2VzdCgpCiAgICAgICAgICAgIHJldHVybiBod2lkCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgdOG6oW8gSFdJRDoge2V9IikKICAgICAgICAgICAgIyBGYWxsYmFjayBu4bq/dSBjw7MgbOG7l2kKICAgICAgICAgICAgcmV0dXJuIGhhc2hsaWIubWQ1KHN0cih1dWlkLmdldG5vZGUoKSkuZW5jb2RlKCkpLmhleGRpZ2VzdCgpCiAgICAKICAgIGRlZiBzYXZlX2xpY2Vuc2Uoc2VsZiwga2V5KToKICAgICAgICAiIiJMxrB1IGtleSB2w6BvIGZpbGUiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTcOjIGjDs2Ega2V5IHRyxrDhu5tjIGtoaSBsxrB1CiAgICAgICAgICAgIGVuY29kZWRfa2V5ID0gYmFzZTY0LmI2NGVuY29kZShrZXkuZW5jb2RlKCkpLmRlY29kZSgpCiAgICAgICAgICAgIHdpdGggb3BlbihzZWxmLmxpY2Vuc2VfZmlsZSwgJ3cnKSBhcyBmOgogICAgICAgICAgICAgICAgZi53cml0ZShlbmNvZGVkX2tleSkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSBsxrB1IGxpY2Vuc2U6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgCiAgICBkZWYgbG9hZF9saWNlbnNlKHNlbGYpOgogICAgICAgICIiIsSQ4buNYyBrZXkgdOG7qyBmaWxlIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhzZWxmLmxpY2Vuc2VfZmlsZSk6CiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oc2VsZi5saWNlbnNlX2ZpbGUsICdyJykgYXMgZjoKICAgICAgICAgICAgICAgICAgICBlbmNvZGVkX2tleSA9IGYucmVhZCgpLnN0cmlwKCkKICAgICAgICAgICAgICAgICAgICAjIEdp4bqjaSBtw6Mga2V5CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGJhc2U2NC5iNjRkZWNvZGUoZW5jb2RlZF9rZXkpLmRlY29kZSgpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgxJHhu41jIGxpY2Vuc2U6IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAKICAgIGFzeW5jIGRlZiB2ZXJpZnlfbGljZW5zZShzZWxmLCBrZXk9Tm9uZSk6CiAgICAgICAgIiIiWMOhYyB0aOG7sWMga2V5IHbhu5tpIHNlcnZlciIiIgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYga2V5IGlzIE5vbmU6CiAgICAgICAgICAgICAgICBrZXkgPSBzZWxmLmxvYWRfbGljZW5zZSgpCiAgICAgICAgICAgICAgICBpZiBub3Qga2V5OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZSwgIktow7RuZyB0w6xtIHRo4bqleSBrZXkuIFZ1aSBsw7JuZyBuaOG6rXAga2V5LiIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ2h14bqpbiBi4buLIGThu68gbGnhu4d1IGfhu61pIMSR4bq/biBzZXJ2ZXIKICAgICAgICAgICAgZGF0YSA9IHsKICAgICAgICAgICAgICAgICJrZXkiOiBrZXksCiAgICAgICAgICAgICAgICAiaHdpZCI6IHNlbGYuaHdpZAogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAjIEfhu61pIHJlcXVlc3QgxJHhur9uIHNlcnZlcgogICAgICAgICAgICBhc3luYyB3aXRoIGFpb2h0dHAuQ2xpZW50U2Vzc2lvbigpIGFzIHNlc3Npb246CiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgYXN5bmMgd2l0aCBzZXNzaW9uLnBvc3Qoc2VsZi5rZXlfc2VydmVyX3VybCwganNvbj1kYXRhLCB0aW1lb3V0PTEwKSBhcyByZXNwb25zZToKICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQgPSBhd2FpdCByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZXN1bHQuZ2V0KCJ2YWxpZCIsIEZhbHNlKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBMxrB1IGtleSBu4bq/dSBo4bujcCBs4buHCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2F2ZV9saWNlbnNlKGtleSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJ5X2RhdGUgPSByZXN1bHQuZ2V0KCJleHBpcnlfZGF0ZSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlLCBmIktleSBo4bujcCBs4buHLiBI4bq/dCBo4bqhbjoge2V4cGlyeV9kYXRlfSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UsIHJlc3VsdC5nZXQoIm1lc3NhZ2UiLCAiS2V5IGtow7RuZyBo4bujcCBs4buHLiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIHjhu60gbMO9IEpTT046IHtlfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlLCBmIkzhu5dpIHjhu60gbMO9IHBo4bqjbiBo4buTaToge2V9IgogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2VfdGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlLCBmIkzhu5dpOiBLZXkga2jDtG5nIHThu5NuIHThuqFpIHZ1aSBsw7JuZyBsacOqbiBo4buHIGFkbWluIgogICAgICAgICAgICAgICAgZXhjZXB0IGFpb2h0dHAuQ2xpZW50RXJyb3IgYXMgZToKICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBr4bq/dCBu4buRaToge2V9IikKICAgICAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyBr4bq/dCBu4buRaSDEkcaw4bujYyBzZXJ2ZXIsIGtp4buDbSB0cmEgb2ZmbGluZQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBzZWxmLnZlcmlmeV9vZmZsaW5lKGtleSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGtoaSB4w6FjIHRo4buxYyBsaWNlbnNlOiB7ZX0iKQogICAgICAgICAgICAjIE7hur91IGPDsyBs4buXaSwgdGjhu60geMOhYyB0aOG7sWMgb2ZmbGluZQogICAgICAgICAgICByZXR1cm4gYXdhaXQgc2VsZi52ZXJpZnlfb2ZmbGluZShrZXkpCgogICAgCiAgICBhc3luYyBkZWYgdmVyaWZ5X29mZmxpbmUoc2VsZiwga2V5KToKICAgICAgICAiIiJYw6FjIHRo4buxYyBrZXkgb2ZmbGluZSAoa2hpIGtow7RuZyBr4bq/dCBu4buRaSDEkcaw4bujYyBzZXJ2ZXIpIiIiCiAgICAgICAgdHJ5OgogICAgICAgICAgICBzYXZlZF9rZXkgPSBzZWxmLmxvYWRfbGljZW5zZSgpCiAgICAgICAgICAgIGlmIHNhdmVkX2tleSBhbmQgc2F2ZWRfa2V5ID09IGtleToKICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0ga2V5IMSRw6MgxJHGsOG7o2MgeMOhYyB0aOG7sWMgdHLGsOG7m2MgxJHDsyBjaMawYQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUsICJLZXkgxJHDoyDEkcaw4bujYyB4w6FjIHRo4buxYyB0csaw4bubYyDEkcOzLiDEkGFuZyBz4butIGThu6VuZyBjaOG6vyDEkeG7mSBvZmZsaW5lLiIKICAgICAgICAgICAgcmV0dXJuIEZhbHNlLCAiS2jDtG5nIHRo4buDIHjDoWMgdGjhu7FjIGtleS4gVnVpIGzDsm5nIGvhur90IG7hu5FpIGludGVybmV0IHbDoCB0aOG7rSBs4bqhaS4iCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgeMOhYyB0aOG7sWMgb2ZmbGluZToge2V9IikKICAgICAgICAgICAgcmV0dXJuIEZhbHNlLCBmIkzhu5dpIHjDoWMgdGjhu7FjOiB7ZX0iCgpkZWYgcHJpbnRfaGVhZGVyKCk6CiAgICBvcy5zeXN0ZW0oJ2NscycgaWYgb3MubmFtZSA9PSAnbnQnIGVsc2UgJ2NsZWFyJykgICMgWMOzYSBtw6BuIGjDrG5oIGNvbnNvbGUKCiAgICBoZWFkZXIgPSByIiIiICAgICAgICAKICBfX18gIF8gICBfICBfX18gIF8gIF8gIF9fXyAgIF9fX19fIF8gICBfICBfICAgXyAgXyAKIHwgICBcfCB8IHwgfC8gXyBcfCBcfCB8LyBfX3wgfF8gICBffCB8IHwgfC9fXCB8IFx8IHwKIHwgfCkgfCB8X3wgfCAoXykgfCAuYCB8IChfIHwgICB8IHwgfCB8X3wgLyBfIFx8IC5gIHwKIHxfX18vIFxfX18vIFxfX18vfF98XF98XF9fX3wgICB8X3wgIFxfX18vXy8gXF9cX3xcX3wKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICIiIgogICAgcHJpbnQoRm9yZS5DWUFOICsgaGVhZGVyICsgU3R5bGUuUkVTRVRfQUxMKQoKIyBH4buNaSBow6BtIMSR4buDIGtp4buDbSB0cmEKcHJpbnRfaGVhZGVyKCkKCiMgVGjDqm0gaMOgbSBoaeG7g24gdGjhu4sgbcOgbiBow6xuaCDEkcSDbmcgbmjhuq1wIGtleQphc3luYyBkZWYgc2hvd19saWNlbnNlX3NjcmVlbigpOgogICAgbGljZW5zZV9tYW5hZ2VyID0gTGljZW5zZU1hbmFnZXIoKQogICAgCiAgICB3aGlsZSBUcnVlOgogICAgICAgIHByaW50X2hlYWRlcigpCiAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIlxu4pWU4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIEvDjUNIIEhP4bqgVCBQSOG6pk4gTeG7gE0g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWXIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWRICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgVnVpIGzDsm5nIG5o4bqtcCBrZXkgxJHhu4Mga8OtY2ggaG/huqF0IHRvb2wgICAgICDilZEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIHByaW50KEZvcmUuQ1lBTiArICLilZEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pWRIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWa4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWdXG4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gxJHDoyBjw7Mga2V5IGNoxrBhCiAgICAgICAgc2F2ZWRfa2V5ID0gbGljZW5zZV9tYW5hZ2VyLmxvYWRfbGljZW5zZSgpCiAgICAgICAgaWYgc2F2ZWRfa2V5OgogICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIGYiS2V5IMSRw6MgbMawdToge3NhdmVkX2tleVs6NV19Li4ue3NhdmVkX2tleVstNTpdfSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIsSQYW5nIHjDoWMgdGjhu7FjIGtleS4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIHZhbGlkLCBtZXNzYWdlID0gYXdhaXQgbGljZW5zZV9tYW5hZ2VyLnZlcmlmeV9saWNlbnNlKHNhdmVkX2tleSkKICAgICAgICAgICAgaWYgdmFsaWQ6CiAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgZiLinJMge21lc3NhZ2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyAixJBhbmcgY2h1eeG7g24gxJHhur9uIG1lbnUgY2jDrW5oLi4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoMikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIGYi4pyXIHttZXNzYWdlfSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgCiAgICAgICAgIyBZw6p1IGPhuqd1IG5o4bqtcCBrZXkgbeG7m2kKICAgICAgICBrZXkgPSBpbnB1dChGb3JlLkNZQU4gKyAi4pa6IE5o4bqtcCBrZXkgY+G7p2EgYuG6oW4gKGhv4bq3YyAnZXhpdCcgxJHhu4MgdGhvw6F0KTogIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBpZiBrZXkubG93ZXIoKSA9PSAnZXhpdCc6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIAogICAgICAgIGlmIGtleToKICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAixJBhbmcgeMOhYyB0aOG7sWMga2V5Li4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgdmFsaWQsIG1lc3NhZ2UgPSBhd2FpdCBsaWNlbnNlX21hbmFnZXIudmVyaWZ5X2xpY2Vuc2Uoa2V5KQogICAgICAgICAgICBpZiB2YWxpZDoKICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBmIuKckyB7bWVzc2FnZX0iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkGFuZyBjaHV54buDbiDEkeG6v24gbWVudSBjaMOtbmguLi4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgyKQogICAgICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgZiLinJcge21lc3NhZ2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoMykKICAgICAgICBlbHNlOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArICJWdWkgbMOybmcgbmjhuq1wIGtleSEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDIpCmRlZiBnZXRfZ2FtZV9zZWxlY3Rpb24oKToKICAgIG1lbnUgPSBmIiIiCiAgICB7Rm9yZS5DWUFOfeKVlOKVkOKVkOKVkOKVkOKVkOKVkOKVkCBDSOG7jE4gR0FNRSDilZDilZDilZDilZDilZDilZDilZDilZcKICAgIOKVkXtGb3JlLllFTExPV30gMS4gQW5pbWUgVmFuZ3VhcmRzICAgICAge0ZvcmUuQ1lBTn3ilZEKICAgIOKVkXtGb3JlLllFTExPV30gMi4gQW5pbWUgTGFzdCBTdGFuZCAgICAge0ZvcmUuQ1lBTn3ilZEgIAogICAg4pWRe0ZvcmUuWUVMTE9XfSAzLiBBbmltZSBBZHZlbnR1cmVzICAgICB7Rm9yZS5DWUFOfeKVkQogICAg4pWRe0ZvcmUuWUVMTE9XfSA0LiBCbG94IEZydWl0ICAgICAgICAgICB7Rm9yZS5DWUFOfeKVkQogICAg4pWRe0ZvcmUuWUVMTE9XfSA1LiBOaOG6rXAgUGxhY2VJRCBraMOhYyAgICB7Rm9yZS5DWUFOfeKVkQogICAg4pWa4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWde1N0eWxlLlJFU0VUX0FMTH0KICAgICIiIgogICAgcHJpbnQobWVudSkKICAgIAogICAgY2hvaWNlID0gaW5wdXQoZiJ7Rm9yZS5DWUFOfeKWuiBOaOG6rXAgbOG7sWEgY2jhu41uIGPhu6dhIGLhuqFuICgxLTUpOiB7U3R5bGUuUkVTRVRfQUxMfSIpCiAgICAKICAgIGlmIGNob2ljZSA9PSAiMSI6CiAgICAgICAgcmV0dXJuICIxNjE0NjgzMjExMyIKICAgIGVsaWYgY2hvaWNlID09ICIyIjoKICAgICAgICByZXR1cm4gIjEyODg2MTQzMDk1IiAKICAgIGVsaWYgY2hvaWNlID09ICIzIjoKICAgICAgICByZXR1cm4gIjgzMDQxOTE4MzAiCiAgICBlbGlmIGNob2ljZSA9PSAiNCI6CiAgICAgICAgcmV0dXJuICIyNzUzOTE1NTQ5IgogICAgZWxpZiBjaG9pY2UgPT0gIjUiOgogICAgICAgIGN1c3RvbV9pZCA9IGlucHV0KGYie0ZvcmUuQ1lBTn3ilrogTmjhuq1wIFBsYWNlSUQgZ2FtZSBj4bunYSBi4bqhbjoge1N0eWxlLlJFU0VUX0FMTH0iKQogICAgICAgIHJldHVybiBjdXN0b21faWQKICAgIGVsc2U6CiAgICAgICAgcHJpbnQoZiJ7Rm9yZS5SRUR94pyWIEzhu7FhIGNo4buNbiBraMO0bmcgaOG7o3AgbOG7hyF7U3R5bGUuUkVTRVRfQUxMfSIpCiAgICAgICAgcmV0dXJuIE5vbmUKZGVmIGZvcm1hdF9zZXJ2ZXJfbGluayhpbnB1dF9saW5rKToKICAgIGlmICdyb2Jsb3guY29tJyBpbiBpbnB1dF9saW5rOgogICAgICAgIHJldHVybiBpbnB1dF9saW5rCiAgICBlbGlmIGlucHV0X2xpbmsuaXNkaWdpdCgpOgogICAgICAgIHJldHVybiBmJ3JvYmxveDovL3BsYWNlSUQ9e2lucHV0X2xpbmt9JwogICAgZWxzZToKICAgICAgICBwcmludChGb3JlLlJFRCArICJMacOqbiBr4bq/dCBraMO0bmcgaOG7o3AgbOG7hyEgVnVpIGzDsm5nIG5o4bqtcCBJRCB0csOyIGNoxqFpIGjhu6NwIGzhu4cuIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICByZXR1cm4gTm9uZQoKZGVmIGxvYWRfZGlzY29yZF9jb25maWcoKToKICAgIGlmIG9zLnBhdGguZXhpc3RzKENvbmZpZy5ESVNDT1JEX0NPTkZJR19GSUxFKToKICAgICAgICB3aXRoIG9wZW4oQ29uZmlnLkRJU0NPUkRfQ09ORklHX0ZJTEUsICJyIikgYXMgZjoKICAgICAgICAgICAgcmV0dXJuIGpzb24ubG9hZChmKQogICAgcmV0dXJuIHsiV0VCSE9PS19VUkwiOiAiIn0KCmRlZiBzYXZlX2Rpc2NvcmRfY29uZmlnKHdlYmhvb2tfdXJsKToKICAgIGNvbmZpZyA9IHsiV0VCSE9PS19VUkwiOiB3ZWJob29rX3VybH0KICAgIHdpdGggb3BlbihDb25maWcuRElTQ09SRF9DT05GSUdfRklMRSwgInciKSBhcyBmOgogICAgICAgIGpzb24uZHVtcChjb25maWcsIGYsIGluZGVudD00KQogICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkMOjIGzGsHUgRGlzY29yZCBXZWJob29rIFVSTC4iICsgU3R5bGUuUkVTRVRfQUxMKQoKIyBU4bqjaSBj4bqldSBow6xuaCBEaXNjb3JkIGtoaSBraOG7n2kgxJHhu5luZwpkaXNjb3JkX2NvbmZpZyA9IGxvYWRfZGlzY29yZF9jb25maWcoKQoKY2xhc3MgUm9ibG94TWFuYWdlcjoKICAgIGRlZiBfX2luaXRfXyhzZWxmKToKICAgICAgICBzZWxmLl9hY2NvdW50cyA9IFtdCiAgICAgICAgc2VsZi5fc2VydmVyX2xpbmtzID0gW10KICAgICAgICBzZWxmLl9wYWNrYWdlX3BhdGhzID0ge30gICMgU3RvcmUgcGFja2FnZSBwYXRocwogICAgICAgIHNlbGYuX3J1bm5pbmcgPSBUcnVlCiAgICAgICAgc2VsZi5fc3RhdHVzX2NhY2hlID0ge30KICAgICAgICBzZWxmLl9jaGVja19tb2RlID0gIm9ubGluZSIgICMgRGVmYXVsdCB0byBvbmxpbmUgY2hlY2sgbW9kZQogICAgICAgIHNlbGYuX2Vycm9yX3N0YXRlcyA9IHt9ICAjIFRyYWNrIGVycm9yIHN0YXRlcyBwZXIgcGFja2FnZQogICAgICAgIHNlbGYuX29mZmxpbmVfdGhyZXNob2xkID0gMTUgICMgU+G7kSBs4bqnbiBraeG7g20gdHJhIHRyxrDhu5tjIGtoaSB4w6FjIG5o4bqtbiBvZmZsaW5lCiAgICAgICAgc2VsZi5jb25uZWN0aW9uX3N0YXRlcyA9IHt9ICAjIEFkZCB0aGlzIGxpbmUKICAgIGRlZiBkb3dubG9hZF9maWxlKHNlbGYsIHVybCwgZGVzdGluYXRpb24sIGJpbmFyeT1GYWxzZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCh1cmwsIHN0cmVhbT1UcnVlKQogICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICBtb2RlID0gJ3diJyBpZiBiaW5hcnkgZWxzZSAndycKICAgICAgICAgICAgICAgIHdpdGggb3BlbihkZXN0aW5hdGlvbiwgbW9kZSkgYXMgZmlsZToKICAgICAgICAgICAgICAgICAgICBpZiBiaW5hcnk6CiAgICAgICAgICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5ZmlsZW9iaihyZXNwb25zZS5yYXcsIGZpbGUpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShyZXNwb25zZS50ZXh0KQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYie29zLnBhdGguYmFzZW5hbWUoZGVzdGluYXRpb24pfSBkb3dubG9hZGVkIHN1Y2Nlc3NmdWxseS4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgcmV0dXJuIGRlc3RpbmF0aW9uCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIGYiRmFpbGVkIHRvIGRvd25sb2FkIHtvcy5wYXRoLmJhc2VuYW1lKGRlc3RpbmF0aW9uKX0uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArIGYiRXJyb3IgZG93bmxvYWRpbmcge29zLnBhdGguYmFzZW5hbWUoZGVzdGluYXRpb24pfToge2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgdmVyaWZ5X2Nvb2tpZShzZWxmLCBjb29raWVfdmFsdWUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAixJBhbmcgeMOhYyB0aOG7sWMgY29va2llLi4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGhp4bq/dCBs4bqtcCBoZWFkZXJzIHbhu5tpIGNvb2tpZQogICAgICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAgICAgJ0Nvb2tpZSc6IGYnLlJPQkxPU0VDVVJJVFk9e2Nvb2tpZV92YWx1ZX0nLAogICAgICAgICAgICAgICAgJ1VzZXItQWdlbnQnOiAnTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBNb2JpbGUpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85MS4wLjQ0NzIuMTI0IE1vYmlsZSBTYWZhcmkvNTM3LjM2JywKICAgICAgICAgICAgICAgICdSZWZlcmVyJzogJ2h0dHBzOi8vd3d3LnJvYmxveC5jb20vJywKICAgICAgICAgICAgICAgICdPcmlnaW4nOiAnaHR0cHM6Ly93d3cucm9ibG94LmNvbScsCiAgICAgICAgICAgICAgICAnQWNjZXB0LUxhbmd1YWdlJzogJ2VuLVVTLGVuO3E9MC45JywKICAgICAgICAgICAgICAgICdBY2NlcHQtRW5jb2RpbmcnOiAnZ3ppcCwgZGVmbGF0ZSwgYnInLAogICAgICAgICAgICAgICAgJ0Nvbm5lY3Rpb24nOiAna2VlcC1hbGl2ZScKICAgICAgICAgICAgfQoKICAgICAgICAgICAgIyBU4bqhbyDEkeG7mSB0cuG7hSBuaOG7jyDEkeG7gyBtw7QgcGjhu49uZyBt4bqrdSB5w6p1IGPhuqd1IHThu7Egbmhpw6puIGjGoW4KICAgICAgICAgICAgdGltZS5zbGVlcCgxKQoKICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIHnDqnUgY+G6p3UgR0VUIMSR4bq/biBlbmRwb2ludCB4w6FjIHRo4buxYwogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly91c2Vycy5yb2Jsb3guY29tL3YxL3VzZXJzL2F1dGhlbnRpY2F0ZWQnLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgICAgIAogICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIGYiS+G6v3QgcXXhuqMgeMOhYyB0aOG7sWM6IEhUVFAge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAjIE5nxrDhu51pIGTDuW5nIMSRw6MgxJHGsOG7o2MgeMOhYyB0aOG7sWMKICAgICAgICAgICAgICAgIHVzZXJfZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSB1c2VyX2RhdGEuZ2V0KCduYW1lJywgJ1Vua25vd24nKQogICAgICAgICAgICAgICAgdXNlcl9pZCA9IHVzZXJfZGF0YS5nZXQoJ2lkJywgJ1Vua25vd24nKQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYiQ29va2llIGjhu6NwIGzhu4chIMSQw6MgeMOhYyB0aOG7sWMgbmfGsOG7nWkgZMO5bmc6IHt1c2VybmFtZX0gKElEOiB7dXNlcl9pZH0pIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlCiAgICAgICAgICAgIGVsaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gNDAxOgogICAgICAgICAgICAgICAgIyBLaMO0bmcgxJHGsOG7o2MgcGjDqXAsIGNvb2tpZSBraMO0bmcgaOG7o3AgbOG7hwogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyAiQ29va2llIGtow7RuZyBo4bujcCBs4buHLiBOZ8aw4budaSBkw7luZyBraMO0bmcgxJHGsOG7o2MgeMOhYyB0aOG7sWMuIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgIyBY4bqjeSByYSBs4buXaSBraMOhYwogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBmIkzhu5dpIHjDoWMgdGjhu7FjIGNvb2tpZToge3Jlc3BvbnNlLnN0YXR1c19jb2RlfSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgZXJyb3JfZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgZiJDaGkgdGnhur90IGzhu5dpOiB7anNvbi5kdW1wcyhlcnJvcl9kYXRhLCBpbmRlbnQ9Mil9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIGYiS2jDtG5nIHRo4buDIHBow6JuIHTDrWNoIHBo4bqjbiBo4buTaSBs4buXaToge3Jlc3BvbnNlLnRleHRbOjEwMF19IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgZiJM4buXaSBraGkgeMOhYyB0aOG7sWMgY29va2llOiB7ZX0iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgcmVwbGFjZV9jb29raWVfdmFsdWVfaW5fZGIoc2VsZiwgZGJfcGF0aCwgbmV3X2Nvb2tpZV92YWx1ZSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBjb25uID0gc3FsaXRlMy5jb25uZWN0KGRiX3BhdGgpCiAgICAgICAgICAgIGN1cnNvciA9IGNvbm4uY3Vyc29yKCkKCiAgICAgICAgICAgICMgxJDhuqd1IHRpw6puLCBraeG7g20gdHJhIHhlbSBjb29raWUgLlJPQkxPU0VDVVJJVFkgY8OzIHThu5NuIHThuqFpIGtow7RuZwogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiIiIKICAgICAgICAgICAgICAgIFNFTEVDVCBDT1VOVCgqKSBGUk9NIGNvb2tpZXMgV0hFUkUgaG9zdF9rZXkgPSAnLnJvYmxveC5jb20nIEFORCBuYW1lID0gJy5ST0JMT1NFQ1VSSVRZJwogICAgICAgICAgICAiIiIpCiAgICAgICAgICAgIGNvb2tpZV9leGlzdHMgPSBjdXJzb3IuZmV0Y2hvbmUoKVswXQoKICAgICAgICAgICAgaWYgY29va2llX2V4aXN0czoKICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGNvb2tpZSBoaeG7h24gY8OzCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiIiIKICAgICAgICAgICAgICAgICAgICBVUERBVEUgY29va2llcwogICAgICAgICAgICAgICAgICAgIFNFVCB2YWx1ZSA9ID8sIGxhc3RfYWNjZXNzX3V0YyA9ID8sIGV4cGlyZXNfdXRjID0gPwogICAgICAgICAgICAgICAgICAgIFdIRVJFIGhvc3Rfa2V5ID0gJy5yb2Jsb3guY29tJyBBTkQgbmFtZSA9ICcuUk9CTE9TRUNVUklUWScKICAgICAgICAgICAgICAgICIiIiwgKG5ld19jb29raWVfdmFsdWUsIGludCh0aW1lLnRpbWUoKSAqIDEwMDAwMDApLCA5OTk5OTk5OTk5OTk5OTk5OSkpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAjIENow6huIGNvb2tpZSBu4bq/dSBuw7Mga2jDtG5nIHThu5NuIHThuqFpCiAgICAgICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgiIiIKICAgICAgICAgICAgICAgICAgICBJTlNFUlQgSU5UTyBjb29raWVzIChjcmVhdGlvbl91dGMsIGhvc3Rfa2V5LCBuYW1lLCB2YWx1ZSwgcGF0aCwgZXhwaXJlc191dGMsIGlzX3NlY3VyZSwgaXNfaHR0cG9ubHksIGxhc3RfYWNjZXNzX3V0YykKICAgICAgICAgICAgICAgICAgICBWQUxVRVMgKD8sICcucm9ibG94LmNvbScsICcuUk9CTE9TRUNVUklUWScsID8sICcvJywgOTk5OTk5OTk5OTk5OTk5OTksIDAsIDAsID8pCiAgICAgICAgICAgICAgICAiIiIsIChpbnQodGltZS50aW1lKCkgKiAxMDAwMDAwKSwgbmV3X2Nvb2tpZV92YWx1ZSwgaW50KHRpbWUudGltZSgpICogMTAwMDAwMCkpKQoKICAgICAgICAgICAgY29ubi5jb21taXQoKQogICAgICAgICAgICBjb25uLmNsb3NlKCkKICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArICJDb29raWUgdmFsdWUgcmVwbGFjZWQgc3VjY2Vzc2Z1bGx5IGluIHRoZSBkYXRhYmFzZSEiICsgU3R5bGUuUkVTRVRfQUxMKQoKICAgICAgICBleGNlcHQgc3FsaXRlMy5PcGVyYXRpb25hbEVycm9yIGFzIGU6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgZiJEYXRhYmFzZSBlcnJvciBkdXJpbmcgY29va2llIHJlcGxhY2VtZW50OiB7ZX0iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBmIkVycm9yIHJlcGxhY2luZyBjb29raWUgdmFsdWUgaW4gZGF0YWJhc2U6IHtlfSIgKyBTdHlsZS5SRVNFVF9BTEwpCgogICAgCiAgICBhc3luYyBkZWYgYXV0b19sb2dpbl92aWFfY29va2llKHNlbGYpOgogICAgICAgICIiIkNo4bupYyBuxINuZyDEkcSDbmcgbmjhuq1wIGLhurFuZyBDb29raWUgdsOgbyBwYWNrYWdlIFJvYmxveCB24bubaSBoaeG7g24gdGjhu4sgdXNlcm5hbWUiIiIKICAgICAgICBwcmludF9oZWFkZXIoKQogICAgICAgIAogICAgICAgICMgUmVtb3ZlIGRlYnVnIHByaW50cyBhYm91dCBjb29raWUgZmlsZSBwYXRoCiAgICAgICAgY29va2llX2ZpbGVfcGF0aCA9IG9zLnBhdGguam9pbihvcy5nZXRjd2QoKSwgImNvb2tpZS50eHQiKQogICAgICAgIAogICAgICAgIHByaW50KEZvcmUuQ1lBTiArICJcbuKVlOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCDEkMSCTkcgTkjhuqxQIELhurBORyBDT09LSUUg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWXIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWRICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIHByaW50KEZvcmUuQ1lBTiArICLilZEgIFTDrW5oIG7Eg25nIG7DoHkgY2hvIHBow6lwIMSRxINuZyBuaOG6rXAgdsOgbyBSb2Jsb3ggIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgYuG6sW5nIGNvb2tpZSB0csOqbiBuaGnhu4F1IHBhY2thZ2Uga2jDoWMgbmhhdSAgICAg4pWRIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWRICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIHByaW50KEZvcmUuQ1lBTiArICLilZrilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZ1cbiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIHbDoCB04bqhbyB0aMawIG3hu6VjIHThuqFtIG7hur91IGNoxrBhIHThu5NuIHThuqFpCiAgICAgICAgdGVtcF9kaXIgPSBvcy5wYXRoLmpvaW4ob3MuZ2V0Y3dkKCksICJ0ZW1wIikKICAgICAgICBvcy5tYWtlZGlycyh0ZW1wX2RpciwgZXhpc3Rfb2s9VHJ1ZSkKICAgICAgICAKICAgICAgICAjIMSQxrDhu51uZyBk4bqrbiDEkeG6v24gY8OhYyBmaWxlIGPhuqduIHRoaeG6v3QKICAgICAgICBkYl91cmwgPSAiaHR0cHM6Ly9naXRodWIuY29tL3NoaXJvb3NjcmlwdHMvYXV0by1yai9yYXcvbWFpbi9Db29raWVzIgogICAgICAgIGFwcHN0b3JhZ2VfdXJsID0gImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9LaWV0MDEwNDAyL25oYXAvcmVmcy9oZWFkcy9tYWluL2FwcFN0b3JhZ2UuanNvbiIKICAgICAgICBkb3dubG9hZGVkX2RiX3BhdGggPSBvcy5wYXRoLmpvaW4odGVtcF9kaXIsICJDb29raWVzLmRiIikKICAgICAgICBkb3dubG9hZGVkX2FwcHN0b3JhZ2VfcGF0aCA9IG9zLnBhdGguam9pbih0ZW1wX2RpciwgImFwcFN0b3JhZ2UuanNvbiIpCiAgICAgICAgCiAgICAgICAgIyBU4bqjaSB4deG7kW5nIGPDoWMgZmlsZSBj4bqnbiB0aGnhur90CiAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAixJBhbmcgdOG6o2kgeHXhu5FuZyBjw6FjIGZpbGUgY+G6p24gdGhp4bq/dC4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIFThuqNpIGZpbGUgQ29va2llcy5kYgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChkYl91cmwsIHN0cmVhbT1UcnVlKQogICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oZG93bmxvYWRlZF9kYl9wYXRoLCAnd2InKSBhcyBmaWxlOgogICAgICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5ZmlsZW9iaihyZXNwb25zZS5yYXcsIGZpbGUpCiAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgIsSQw6MgdOG6o2kgeHXhu5FuZyBDb29raWVzLmRiIHRow6BuaCBjw7RuZyIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArICJLaMO0bmcgdGjhu4MgdOG6o2kgeHXhu5FuZyBDb29raWVzLmRiIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoMikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICAKICAgICAgICAgICAgIyBU4bqjaSBmaWxlIGFwcFN0b3JhZ2UuanNvbgogICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldChhcHBzdG9yYWdlX3VybCkKICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzX2NvZGUgPT0gMjAwOgogICAgICAgICAgICAgICAgd2l0aCBvcGVuKGRvd25sb2FkZWRfYXBwc3RvcmFnZV9wYXRoLCAndycpIGFzIGZpbGU6CiAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShyZXNwb25zZS50ZXh0KQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkMOjIHThuqNpIHh14buRbmcgYXBwU3RvcmFnZS5qc29uIHRow6BuaCBjw7RuZyIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArICJLaMO0bmcgdGjhu4MgdOG6o2kgeHXhu5FuZyBhcHBTdG9yYWdlLmpzb24iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgyKQogICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArIGYiTOG7l2kga2hpIHThuqNpIHh14buRbmcgZmlsZToge2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgyKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIFjhu60gbMO9IGNvb2tpZQogICAgICAgIGNvb2tpZXMgPSBbXQogICAgICAgIAogICAgICAgICMgS2nhu4NtIHRyYSB4ZW0gZmlsZSBjb29raWUudHh0IMSRw6MgdOG7k24gdOG6oWkgY2jGsGEKICAgICAgICBpZiBub3Qgb3MucGF0aC5leGlzdHMoY29va2llX2ZpbGVfcGF0aCk6CiAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIktow7RuZyB0w6xtIHRo4bqleSBmaWxlIGNvb2tpZS50eHQiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICBjb29raWVfY2hvaWNlID0gaW5wdXQoRm9yZS5DWUFOICsgIkLhuqFuIG114buRbiBuaOG6rXAgY29va2llIG5nYXkgYsOieSBnaeG7nT8gKHkvbik6ICIgKyBTdHlsZS5SRVNFVF9BTEwpLmxvd2VyKCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGNvb2tpZV9jaG9pY2UgPT0gJ3knOgogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIlxu4pWU4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIEjGr+G7mk5HIEThuqpOIE5I4bqsUCBDT09LSUUg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWXIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArICLilZEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgMS4gTeG7l2kgY29va2llIHRyw6puIG3hu5l0IGTDsm5nICAgICAgICAgIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWRICAyLiBDaOG7iSBuaOG6rXAgZ2nDoSB0cuG7iyBjb29raWUsIGtow7RuZyAgICDilZEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgICAgY+G6p24gdGjDqm0gLlJPQkxPU0VDVVJJVFk9ICAgICAgICAgIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWRICAzLiBOaOG6rXAgJ2RvbmUnIGtoaSBob8OgbiB04bqldCAgICAgICAgICDilZEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWa4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWdXG4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArICJOaOG6rXAgY29va2llIGPhu6dhIGLhuqFuIChuaOG6rXAgJ2RvbmUnIGtoaSBob8OgbiB04bqldCk6IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIHdoaWxlIFRydWU6CiAgICAgICAgICAgICAgICAgICAgY29va2llX2lucHV0ID0gaW5wdXQoRm9yZS5DWUFOICsgIuKWuiAiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIGlmIGNvb2tpZV9pbnB1dC5sb3dlcigpID09ICdkb25lJzoKICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgICAgICBpZiBjb29raWVfaW5wdXQuc3RyaXAoKToKICAgICAgICAgICAgICAgICAgICAgICAgIyBMb+G6oWkgYuG7jyAuUk9CTE9TRUNVUklUWT0gbuG6v3UgY8OzCiAgICAgICAgICAgICAgICAgICAgICAgIGlmICcuUk9CTE9TRUNVUklUWT0nIGluIGNvb2tpZV9pbnB1dDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvb2tpZV9pbnB1dCA9IGNvb2tpZV9pbnB1dC5zcGxpdCgnLlJPQkxPU0VDVVJJVFk9JylbMV0KICAgICAgICAgICAgICAgICAgICAgICAgY29va2llcy5hcHBlbmQoY29va2llX2lucHV0LnN0cmlwKCkpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTMawdSBjb29raWUgdsOgbyBmaWxlCiAgICAgICAgICAgICAgICB3aXRoIG9wZW4oY29va2llX2ZpbGVfcGF0aCwgJ3cnKSBhcyBmaWxlOgogICAgICAgICAgICAgICAgICAgIGZvciBjb29raWUgaW4gY29va2llczoKICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShjb29raWUgKyAnXG4nKQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYixJDDoyBsxrB1IHtsZW4oY29va2llcyl9IGNvb2tpZSB2w6BvIGZpbGUgY29va2llLnR4dCIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArICJWdWkgbMOybmcgdOG6oW8gZmlsZSBjb29raWUudHh0IHbhu5tpIG3hu5dpIGNvb2tpZSB0csOqbiBt4buZdCBkw7JuZyB2w6AgdGjhu60gbOG6oWkgc2F1IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoMikKICAgICAgICAgICAgICAgIHJldHVybgogICAgICAgIGVsc2U6CiAgICAgICAgICAgICMgxJDhu41jIGNvb2tpZSB04burIGZpbGUKICAgICAgICAgICAgd2l0aCBvcGVuKGNvb2tpZV9maWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgICAgIGNvb2tpZXMgPSBbbGluZS5zdHJpcCgpIGZvciBsaW5lIGluIGZpbGUucmVhZGxpbmVzKCkgaWYgbGluZS5zdHJpcCgpXQogICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgZiLEkMOjIMSR4buNYyB7bGVuKGNvb2tpZXMpfSBjb29raWUgdOG7qyBmaWxlIGNvb2tpZS50eHQiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIGlmIG5vdCBjb29raWVzOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArICJLaMO0bmcgdMOsbSB0aOG6pXkgY29va2llIG7DoG8uIFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpIGZpbGUgY29va2llLnR4dCIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoMikKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgCiAgICAgICAgIyBM4bqleSB1c2VybmFtZSBjaG8gbeG7l2kgY29va2llCiAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAixJBhbmcgbOG6pXkgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24gdOG7qyBjb29raWUuLi4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIHZhbGlkX2Nvb2tpZXMgPSBbXQogICAgICAgIHZhbGlkX3VzZXJuYW1lcyA9IFtdCiAgICAgICAgdmFsaWRfdXNlcl9pZHMgPSBbXQogICAgICAgIGludmFsaWRfY29va2llcyA9IFtdICAjIERhbmggc8OhY2ggbMawdSBjw6FjIGNvb2tpZSBraMO0bmcgaOG7o3AgbOG7hwogICAgICAgIAogICAgICAgIGNvb2tpZV9pbmZvX3RhYmxlID0gW10KICAgICAgICAKICAgICAgICBmb3IgaSwgY29va2llIGluIGVudW1lcmF0ZShjb29raWVzKToKICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyBmIsSQYW5nIGtp4buDbSB0cmEgY29va2llIHtpKzF9L3tsZW4oY29va2llcyl9Li4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGhp4bq/dCBs4bqtcCBoZWFkZXJzIHbhu5tpIGNvb2tpZQogICAgICAgICAgICBoZWFkZXJzID0gewogICAgICAgICAgICAgICAgJ0Nvb2tpZSc6IGYnLlJPQkxPU0VDVVJJVFk9e2Nvb2tpZX0nLAogICAgICAgICAgICAgICAgJ1VzZXItQWdlbnQnOiAnTW96aWxsYS81LjAgKExpbnV4OyBBbmRyb2lkIDEwOyBNb2JpbGUpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS85MS4wLjQ0NzIuMTI0IE1vYmlsZSBTYWZhcmkvNTM3LjM2JywKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgIyBUaOG7sWMgaGnhu4duIHnDqnUgY+G6p3UgR0VUIMSR4bq/biBlbmRwb2ludCB4w6FjIHRo4buxYwogICAgICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQoJ2h0dHBzOi8vdXNlcnMucm9ibG94LmNvbS92MS91c2Vycy9hdXRoZW50aWNhdGVkJywgaGVhZGVycz1oZWFkZXJzKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgdXNlcl9kYXRhID0gcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUgPSB1c2VyX2RhdGEuZ2V0KCduYW1lJywgJ1Vua25vd24nKQogICAgICAgICAgICAgICAgICAgIHVzZXJfaWQgPSB1c2VyX2RhdGEuZ2V0KCdpZCcsICdVbmtub3duJykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB2YWxpZF9jb29raWVzLmFwcGVuZChjb29raWUpCiAgICAgICAgICAgICAgICAgICAgdmFsaWRfdXNlcm5hbWVzLmFwcGVuZCh1c2VybmFtZSkKICAgICAgICAgICAgICAgICAgICB2YWxpZF91c2VyX2lkcy5hcHBlbmQodXNlcl9pZCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBjb29raWVfaW5mb190YWJsZS5hcHBlbmQoW2krMSwgdXNlcm5hbWUsIHVzZXJfaWQsICJI4bujcCBs4buHIl0pCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYiICDinJMgQ29va2llIGjhu6NwIGzhu4c6IHt1c2VybmFtZX0gKElEOiB7dXNlcl9pZH0pIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgY29va2llX2luZm9fdGFibGUuYXBwZW5kKFtpKzEsICJOL0EiLCAiTi9BIiwgIktow7RuZyBo4bujcCBs4buHIl0pCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBmIkNvb2tpZSB7aSsxfSBraMO0bmcgaOG7o3AgbOG7hyIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgaW52YWxpZF9jb29raWVzLmFwcGVuZChjb29raWUpICAjIFRow6ptIGNvb2tpZSBraMO0bmcgaOG7o3AgbOG7hyB2w6BvIGRhbmggc8OhY2gKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgY29va2llX2luZm9fdGFibGUuYXBwZW5kKFtpKzEsICJOL0EiLCAiTi9BIiwgZiJM4buXaToge3N0cihlKVs6MzBdfS4uLiJdKQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBmIkzhu5dpIGtoaSBraeG7g20gdHJhIGNvb2tpZSB7aSsxfToge2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIGludmFsaWRfY29va2llcy5hcHBlbmQoY29va2llKSAgIyBUaMOqbSBjb29raWUgbOG7l2kgdsOgbyBkYW5oIHPDoWNoCiAgICAgICAgCiAgICAgICAgIyBYw7NhIGPDoWMgY29va2llIGtow7RuZyBo4bujcCBs4buHIGto4buPaSBmaWxlIGNvb2tpZS50eHQKICAgICAgICBpZiBpbnZhbGlkX2Nvb2tpZXM6CiAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgZiJQaMOhdCBoaeG7h24ge2xlbihpbnZhbGlkX2Nvb2tpZXMpfSBjb29raWUga2jDtG5nIGjhu6NwIGzhu4cgaG/hurdjIGzhu5dpLiDEkGFuZyB4w7NhLi4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgTMawdSBs4bqhaSBjaOG7iSBjw6FjIGNvb2tpZSBo4bujcCBs4buHCiAgICAgICAgICAgIHdpdGggb3Blbihjb29raWVfZmlsZV9wYXRoLCAndycpIGFzIGZpbGU6CiAgICAgICAgICAgICAgICBmb3IgY29va2llIGluIHZhbGlkX2Nvb2tpZXM6CiAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShjb29raWUgKyAnXG4nKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYixJDDoyB4w7NhIHtsZW4oaW52YWxpZF9jb29raWVzKX0gY29va2llIGtow7RuZyBo4bujcCBs4buHLiBDw7JuIGzhuqFpIHtsZW4odmFsaWRfY29va2llcyl9IGNvb2tpZSBo4bujcCBs4buHLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHZhbGlkX2Nvb2tpZXM6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgIktow7RuZyBjw7MgY29va2llIG7DoG8gaOG7o3AgbOG7hy4gVnVpIGzDsm5nIGtp4buDbSB0cmEgbOG6oWkgZmlsZSBjb29raWUudHh0IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgyKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIEhp4buDbiB0aOG7iyBi4bqjbmcgdGjDtG5nIHRpbiBjb29raWUKICAgICAgICBwcmludCgiXG4iICsgRm9yZS5DWUFOICsgIkRBTkggU8OBQ0ggQ09PS0lFIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBwcmludCh0YWJ1bGF0ZShjb29raWVfaW5mb190YWJsZSwgaGVhZGVycz1bIlNUVCIsICJVc2VybmFtZSIsICJVc2VyIElEIiwgIlRy4bqhbmcgdGjDoWkiXSwgdGFibGVmbXQ9ImZhbmN5X2dyaWQiKSkKICAgICAgICBwcmludChGb3JlLkdSRUVOICsgZiLEkMOjIHTDrG0gdGjhuqV5IHtsZW4odmFsaWRfY29va2llcyl9L3tsZW4oY29va2llcyl9IGNvb2tpZSBo4bujcCBs4buHXG4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIAogICAgICAgICMgTOG6pXkgZGFuaCBzw6FjaCBwYWNrYWdlIFJvYmxveAogICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIsSQYW5nIHTDrG0ga2nhur9tIHBhY2thZ2UgUm9ibG94Li4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBwYWNrYWdlcyA9IHNlbGYuZ2V0X3JvYmxveF9wYWNrYWdlcygpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHBhY2thZ2VzOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArICJLaMO0bmcgdMOsbSB0aOG6pXkgcGFja2FnZSBSb2Jsb3ggbsOgbyB0csOqbiB0aGnhur90IGLhu4siICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMgSGnhu4NuIHRo4buLIGRhbmggc8OhY2ggcGFja2FnZQogICAgICAgIHBhY2thZ2VfdGFibGUgPSBbXQogICAgICAgIGZvciBpLCBwYWNrYWdlIGluIGVudW1lcmF0ZShwYWNrYWdlcywgMSk6CiAgICAgICAgICAgIHBhY2thZ2VfdGFibGUuYXBwZW5kKFtpLCBwYWNrYWdlXSkKICAgICAgICAKICAgICAgICBwcmludCgiXG4iICsgRm9yZS5DWUFOICsgIkRBTkggU8OBQ0ggUEFDS0FHRSBST0JMT1giICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIHByaW50KHRhYnVsYXRlKHBhY2thZ2VfdGFibGUsIGhlYWRlcnM9WyJTVFQiLCAiUGFja2FnZSBOYW1lIl0sIHRhYmxlZm10PSJmYW5jeV9ncmlkIikpCiAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYixJDDoyB0w6xtIHRo4bqleSB7bGVuKHBhY2thZ2VzKX0gcGFja2FnZSBSb2Jsb3hcbiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgCiAgICAgICAgIyBDaG8gcGjDqXAgbmfGsOG7nWkgZMO5bmcgY2jhu41uIHBhY2thZ2UgxJHhu4MgxJHEg25nIG5o4bqtcAogICAgICAgIHBhY2thZ2VfY2hvaWNlID0gaW5wdXQoRm9yZS5ZRUxMT1cgKyAiTmjhuq1wIHPhu5EgdGjhu6kgdOG7sSBjw6FjIHBhY2thZ2UgbXXhu5FuIMSRxINuZyBuaOG6rXAgKGPDoWNoIG5oYXUgYuG7n2kgZOG6pXUgcGjhuql5KSBob+G6t2MgJ2FsbCcgxJHhu4MgY2jhu41uIHThuqV0IGPhuqM6ICIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgCiAgICAgICAgc2VsZWN0ZWRfcGFja2FnZXMgPSBbXQogICAgICAgIGlmIHBhY2thZ2VfY2hvaWNlLmxvd2VyKCkgPT0gJ2FsbCc6CiAgICAgICAgICAgIHNlbGVjdGVkX3BhY2thZ2VzID0gcGFja2FnZXMKICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkMOjIGNo4buNbiB04bqldCBj4bqjIHBhY2thZ2UiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHNlbGVjdGVkX2luZGljZXMgPSBbaW50KGlkeC5zdHJpcCgpKSAtIDEgZm9yIGlkeCBpbiBwYWNrYWdlX2Nob2ljZS5zcGxpdCgnLCcpIGlmIGlkeC5zdHJpcCgpXQogICAgICAgICAgICAgICAgZm9yIGlkeCBpbiBzZWxlY3RlZF9pbmRpY2VzOgogICAgICAgICAgICAgICAgICAgIGlmIDAgPD0gaWR4IDwgbGVuKHBhY2thZ2VzKToKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRfcGFja2FnZXMuYXBwZW5kKHBhY2thZ2VzW2lkeF0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBzZWxlY3RlZF9wYWNrYWdlczoKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArICJLaMO0bmcgY8OzIHBhY2thZ2UgbsOgbyDEkcaw4bujYyBjaOG7jW4sIHPhu60gZOG7pW5nIHThuqV0IGPhuqMgcGFja2FnZSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRfcGFja2FnZXMgPSBwYWNrYWdlcwogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgZiLEkMOjIGNo4buNbiB7bGVuKHNlbGVjdGVkX3BhY2thZ2VzKX0gcGFja2FnZSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAiTOG7sWEgY2jhu41uIGtow7RuZyBo4bujcCBs4buHLCBz4butIGThu6VuZyB04bqldCBj4bqjIHBhY2thZ2UiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgc2VsZWN0ZWRfcGFja2FnZXMgPSBwYWNrYWdlcwogICAgICAgIAogICAgICAgICMgQ2hvIHBow6lwIG5nxrDhu51pIGTDuW5nIGNo4buNbiBjb29raWUgY2hvIHThu6tuZyBwYWNrYWdlCiAgICAgICAgcGFja2FnZV9jb29raWVfbWFwID0ge30KICAgICAgICAKICAgICAgICBwcmludChGb3JlLkNZQU4gKyAiXG49PT0gQ0jhu4xOIENPT0tJRSBDSE8gVOG7qk5HIFBBQ0tBR0UgPT09IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAKICAgICAgICBmb3IgcGFja2FnZSBpbiBzZWxlY3RlZF9wYWNrYWdlczoKICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyBmIlxuQ2jhu41uIGNvb2tpZSBjaG8gcGFja2FnZSB7cGFja2FnZX06IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgSGnhu4NuIHRo4buLIGRhbmggc8OhY2ggY29va2llIGjhu6NwIGzhu4cKICAgICAgICAgICAgY29va2llX2Nob2ljZV90YWJsZSA9IFtdCiAgICAgICAgICAgIGZvciBpLCAodXNlcm5hbWUsIHVzZXJfaWQpIGluIGVudW1lcmF0ZSh6aXAodmFsaWRfdXNlcm5hbWVzLCB2YWxpZF91c2VyX2lkcyksIDEpOgogICAgICAgICAgICAgICAgY29va2llX2Nob2ljZV90YWJsZS5hcHBlbmQoW2ksIHVzZXJuYW1lLCB1c2VyX2lkXSkKICAgICAgICAgICAgCiAgICAgICAgICAgIHByaW50KHRhYnVsYXRlKGNvb2tpZV9jaG9pY2VfdGFibGUsIGhlYWRlcnM9WyJTVFQiLCAiVXNlcm5hbWUiLCAiVXNlciBJRCJdLCB0YWJsZWZtdD0ic2ltcGxlIikpCiAgICAgICAgICAgIAogICAgICAgICAgICBjb29raWVfaWR4ID0gaW5wdXQoRm9yZS5DWUFOICsgZiJOaOG6rXAgc+G7kSB0aOG7qSB04buxIGNvb2tpZSAoMS17bGVuKHZhbGlkX2Nvb2tpZXMpfSk6ICIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBpZHggPSBpbnQoY29va2llX2lkeCkgLSAxCiAgICAgICAgICAgICAgICBpZiAwIDw9IGlkeCA8IGxlbih2YWxpZF9jb29raWVzKToKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlX2Nvb2tpZV9tYXBbcGFja2FnZV0gPSB2YWxpZF9jb29raWVzW2lkeF0KICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgZiLEkMOjIGNo4buNbiBjb29raWUgY+G7p2Ege3ZhbGlkX3VzZXJuYW1lc1tpZHhdfSAoSUQ6IHt2YWxpZF91c2VyX2lkc1tpZHhdfSkgY2hvIHtwYWNrYWdlfSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICMgTuG6v3UgY2jhu41uIGtow7RuZyBo4bujcCBs4buHLCBz4butIGThu6VuZyBjb29raWUgxJHhuqd1IHRpw6puCiAgICAgICAgICAgICAgICAgICAgcGFja2FnZV9jb29raWVfbWFwW3BhY2thZ2VdID0gdmFsaWRfY29va2llc1swXQogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgZiJM4buxYSBjaOG7jW4ga2jDtG5nIGjhu6NwIGzhu4csIHPhu60gZOG7pW5nIGNvb2tpZSBj4bunYSB7dmFsaWRfdXNlcm5hbWVzWzBdfSBjaG8ge3BhY2thZ2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICAjIE7hur91IG5o4bqtcCBraMO0bmcgcGjhuqNpIHPhu5EsIHPhu60gZOG7pW5nIGNvb2tpZSDEkeG6p3UgdGnDqm4KICAgICAgICAgICAgICAgIHBhY2thZ2VfY29va2llX21hcFtwYWNrYWdlXSA9IHZhbGlkX2Nvb2tpZXNbMF0KICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgZiJM4buxYSBjaOG7jW4ga2jDtG5nIGjhu6NwIGzhu4csIHPhu60gZOG7pW5nIGNvb2tpZSBj4bunYSB7dmFsaWRfdXNlcm5hbWVzWzBdfSBjaG8ge3BhY2thZ2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAKICAgICAgICAjIFRp4bq/biBow6BuaCDEkcSDbmcgbmjhuq1wCiAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAiXG5C4bqvdCDEkeG6p3UgcXXDoSB0csOsbmggxJHEg25nIG5o4bqtcC4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgCiAgICAgICAgIyBU4bqhbyBi4bqjbmcgxJHhu4MgaGnhu4NuIHRo4buLIGvhur90IHF14bqjCiAgICAgICAgcmVzdWx0c190YWJsZSA9IFtdCiAgICAgICAgCiAgICAgICAgZm9yIHBhY2thZ2VfbmFtZSBpbiBzZWxlY3RlZF9wYWNrYWdlczoKICAgICAgICAgICAgY29va2llID0gcGFja2FnZV9jb29raWVfbWFwLmdldChwYWNrYWdlX25hbWUpCiAgICAgICAgICAgIGlmIG5vdCBjb29raWU6CiAgICAgICAgICAgICAgICByZXN1bHRzX3RhYmxlLmFwcGVuZChbcGFja2FnZV9uYW1lLCAiQuG7jyBxdWEiLCAiS2jDtG5nIGPDsyBjb29raWUgxJHGsOG7o2MgY2jhu41uIl0pCiAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAKICAgICAgICAgICAgIyBUw6xtIHVzZXJuYW1lIHTGsMahbmcg4bupbmcgduG7m2kgY29va2llCiAgICAgICAgICAgIGNvb2tpZV9pZHggPSB2YWxpZF9jb29raWVzLmluZGV4KGNvb2tpZSkKICAgICAgICAgICAgdXNlcm5hbWUgPSB2YWxpZF91c2VybmFtZXNbY29va2llX2lkeF0KICAgICAgICAgICAgdXNlcl9pZCA9IHZhbGlkX3VzZXJfaWRzW2Nvb2tpZV9pZHhdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEhp4buDbiB0aOG7iyB0aeG6v24gdHLDrG5oCiAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgZiLEkGFuZyB44butIGzDvSB7cGFja2FnZV9uYW1lfSB24bubaSB0w6BpIGtob+G6o24ge3VzZXJuYW1lfS4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIAogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIMSQxrDhu51uZyBk4bqrbiDEkeG6v24gdGjGsCBt4bulYyDEkcOtY2gKICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uX2RiX2RpciA9IGYiL2RhdGEvZGF0YS97cGFja2FnZV9uYW1lfS9hcHBfd2Vidmlldy9EZWZhdWx0LyIKICAgICAgICAgICAgICAgIGRlc3RpbmF0aW9uX2FwcHN0b3JhZ2VfZGlyID0gZiIvZGF0YS9kYXRhL3twYWNrYWdlX25hbWV9L2ZpbGVzL2FwcERhdGEvTG9jYWxTdG9yYWdlLyIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyDEkOG6o20gYuG6o28gdGjGsCBt4bulYyB04buTbiB04bqhaQogICAgICAgICAgICAgICAgb3MubWFrZWRpcnMoZGVzdGluYXRpb25fZGJfZGlyLCBleGlzdF9vaz1UcnVlKQogICAgICAgICAgICAgICAgb3MubWFrZWRpcnMoZGVzdGluYXRpb25fYXBwc3RvcmFnZV9kaXIsIGV4aXN0X29rPVRydWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgU2FvIGNow6lwIENvb2tpZXMuZGIgxJHDoyB04bqjaSB4deG7kW5nIHbDoG8gxJHDrWNoCiAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIGYixJBhbmcgc2FvIGNow6lwIENvb2tpZXMuZGIuLi4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgZGVzdGluYXRpb25fZGJfcGF0aCA9IG9zLnBhdGguam9pbihkZXN0aW5hdGlvbl9kYl9kaXIsICJDb29raWVzIikKICAgICAgICAgICAgICAgIHNodXRpbC5jb3B5ZmlsZShkb3dubG9hZGVkX2RiX3BhdGgsIGRlc3RpbmF0aW9uX2RiX3BhdGgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGnDqm0gYXBwU3RvcmFnZS5qc29uCiAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIGYixJBhbmcgc2FvIGNow6lwIGFwcFN0b3JhZ2UuanNvbi4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbl9hcHBzdG9yYWdlX3BhdGggPSBvcy5wYXRoLmpvaW4oZGVzdGluYXRpb25fYXBwc3RvcmFnZV9kaXIsICJhcHBTdG9yYWdlLmpzb24iKQogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHlmaWxlKGRvd25sb2FkZWRfYXBwc3RvcmFnZV9wYXRoLCBkZXN0aW5hdGlvbl9hcHBzdG9yYWdlX3BhdGgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVGhheSB0aOG6vyBnacOhIHRy4buLIGNvb2tpZSB0cm9uZyBjxqEgc+G7nyBk4buvIGxp4buHdQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyBmIsSQYW5nIMSRxINuZyBuaOG6rXAgY29va2llIHbDoG8gY8ahIHPhu58gZOG7ryBsaeG7h3UuLi4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgc2VsZi5yZXBsYWNlX2Nvb2tpZV92YWx1ZV9pbl9kYihkZXN0aW5hdGlvbl9kYl9wYXRoLCBjb29raWUpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgWMOhYyBtaW5oIGNvb2tpZSBzYXUga2hpIHRpw6ptCiAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIGYixJBhbmcgeMOhYyBtaW5oIGNvb2tpZSBzYXUga2hpIMSRxINuZyBuaOG6rXAuLi4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgaWYgc2VsZi52ZXJpZnlfY29va2llKGNvb2tpZSk6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYiQ29va2llIHbhuqtuIGjhu6NwIGzhu4cgc2F1IGtoaSDEkcSDbmcgbmjhuq1wIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIFRow6ptIG3hu5tpOiBN4bufIHBhY2thZ2UgxJHhu4MgeMOhYyBuaOG6rW4gxJHEg25nIG5o4bqtcCB0aMOgbmggY8O0bmcKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIGYixJBhbmcgbeG7nyB7cGFja2FnZV9uYW1lfSDEkeG7gyB4w6FjIG5o4bqtbiDEkcSDbmcgbmjhuq1wLi4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICMgTeG7nyDhu6luZyBk4bulbmcgUm9ibG94CiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICdhbScsICdzdGFydCcsICctbicsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmJ3twYWNrYWdlX25hbWV9L2NvbS5yb2Jsb3guY2xpZW50LnN0YXJ0dXAuQWN0aXZpdHlTcGxhc2gnCiAgICAgICAgICAgICAgICAgICAgICAgIF0sIHN0ZG91dD1zdWJwcm9jZXNzLkRFVk5VTEwsIHN0ZGVycj1zdWJwcm9jZXNzLkRFVk5VTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIMSQ4bujaSDhu6luZyBk4bulbmcga2jhu59pIMSR4buZbmcKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAixJDhu6NpIOG7qW5nIGThu6VuZyBraOG7n2kgxJHhu5luZyAoMTAgZ2nDonkpLi4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgxMCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgS2nhu4NtIHRyYSB4ZW0g4bupbmcgZOG7pW5nIGPDsyDEkWFuZyBjaOG6oXkga2jDtG5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlzX3J1bm5pbmcsIF8gPSBzZWxmLmlzX3BhY2thZ2VfcnVubmluZyhwYWNrYWdlX25hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGlzX3J1bm5pbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgZiJYw6FjIG5o4bqtbiB7cGFja2FnZV9uYW1lfSDEkcOjIGto4bufaSDEkeG7mW5nIHRow6BuaCBjw7RuZyIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIGYiS2jDtG5nIHRo4buDIHjDoWMgbmjhuq1uIHtwYWNrYWdlX25hbWV9IMSRw6Mga2jhu59pIMSR4buZbmciICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyDEkMOzbmcg4bupbmcgZOG7pW5nIHNhdSBraGkgeMOhYyBuaOG6rW4KICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyBmIsSQYW5nIMSRw7NuZyB7cGFja2FnZV9uYW1lfS4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYua2lsbF9zcGVjaWZpY19yb2Jsb3hfcHJvY2VzcyhwYWNrYWdlX25hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoMikKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBmIsSQw6MgxJHDs25nIHtwYWNrYWdlX25hbWV9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0c190YWJsZS5hcHBlbmQoW3BhY2thZ2VfbmFtZSwgIlRow6BuaCBjw7RuZyIsIGYie3VzZXJuYW1lfSAoxJDDoyB4w6FjIG5o4bqtbikiXSkKICAgICAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgZiJM4buXaSBraGkgbeG7ny/EkcOzbmcg4bupbmcgZOG7pW5nOiB7ZX0iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzX3RhYmxlLmFwcGVuZChbcGFja2FnZV9uYW1lLCAiVGjDoG5oIGPDtG5nIiwgZiJ7dXNlcm5hbWV9IChLaMO0bmcgdGjhu4MgeMOhYyBuaOG6rW4pIl0pCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgZiJDb29raWUga2jDtG5nIGjhu6NwIGzhu4cgc2F1IGtoaSDEkcSDbmcgbmjhuq1wIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICByZXN1bHRzX3RhYmxlLmFwcGVuZChbcGFja2FnZV9uYW1lLCAiQ+G6o25oIGLDoW8iLCBmInt1c2VybmFtZX0gLSBDb29raWUga2jDtG5nIGjhu6NwIGzhu4cgc2F1IGtoaSDEkcSDbmcgbmjhuq1wIl0pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyDEkMOhbmggZOG6pXUgY29va2llIG7DoHkgbMOgIGtow7RuZyBo4bujcCBs4buHIMSR4buDIHjDs2Egc2F1CiAgICAgICAgICAgICAgICAgICAgaWYgY29va2llIG5vdCBpbiBpbnZhbGlkX2Nvb2tpZXM6CiAgICAgICAgICAgICAgICAgICAgICAgIGludmFsaWRfY29va2llcy5hcHBlbmQoY29va2llKQogICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBmIkzhu5dpIGtoaSDEkcSDbmcgbmjhuq1wIGNvb2tpZToge2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIHJlc3VsdHNfdGFibGUuYXBwZW5kKFtwYWNrYWdlX25hbWUsICJUaOG6pXQgYuG6oWkiLCBmIkzhu5dpOiB7c3RyKGUpWzozMF19Li4uIl0pCiAgICAgICAgCiAgICAgICAgIyBYw7NhIHRow6ptIGPDoWMgY29va2llIGtow7RuZyBo4bujcCBs4buHIHNhdSBraGkgdGnDqm0KICAgICAgICBpZiBpbnZhbGlkX2Nvb2tpZXM6CiAgICAgICAgICAgICMgTOG7jWMgcmEgY8OhYyBjb29raWUgY8OybiBo4bujcCBs4buHIChraMO0bmcgbuG6sW0gdHJvbmcgZGFuaCBzw6FjaCBpbnZhbGlkX2Nvb2tpZXMpCiAgICAgICAgICAgIHJlbWFpbmluZ192YWxpZF9jb29raWVzID0gW2MgZm9yIGMgaW4gdmFsaWRfY29va2llcyBpZiBjIG5vdCBpbiBpbnZhbGlkX2Nvb2tpZXNdCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBs4bqhaSBmaWxlIGNvb2tpZS50eHQKICAgICAgICAgICAgd2l0aCBvcGVuKGNvb2tpZV9maWxlX3BhdGgsICd3JykgYXMgZmlsZToKICAgICAgICAgICAgICAgIGZvciBjb29raWUgaW4gcmVtYWluaW5nX3ZhbGlkX2Nvb2tpZXM6CiAgICAgICAgICAgICAgICAgICAgZmlsZS53cml0ZShjb29raWUgKyAnXG4nKQogICAgICAgICAgICAKICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyBmIsSQw6MgeMOzYSB0aMOqbSB7bGVuKGludmFsaWRfY29va2llcykgLSAobGVuKGNvb2tpZXMpIC0gbGVuKHZhbGlkX2Nvb2tpZXMpKX0gY29va2llIGtow7RuZyBo4bujcCBs4buHIHNhdSBraGkgdGnDqm0uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYiQ8OybiBs4bqhaSB7bGVuKHJlbWFpbmluZ192YWxpZF9jb29raWVzKX0gY29va2llIGjhu6NwIGzhu4cgdHJvbmcgZmlsZS4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIAogICAgICAgICMgSGnhu4NuIHRo4buLIGLhuqNuZyBr4bq/dCBxdeG6owogICAgICAgIHByaW50X2hlYWRlcigpCiAgICAgICAgcHJpbnQoRm9yZS5XSElURSArICJcbiAgICAgICAgICAgICAgICAgIEvhur5UIFFV4bqiIMSQxIJORyBOSOG6rFAgICAgICAgICAgICAgICAgICAgIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBwcmludCh0YWJ1bGF0ZShyZXN1bHRzX3RhYmxlLCBoZWFkZXJzPVsiUGFja2FnZSIsICJUcuG6oW5nIHRow6FpIiwgIlTDoGkga2hv4bqjbiJdLCB0YWJsZWZtdD0iZmFuY3lfZ3JpZCIpKQogICAgICAgIAogICAgICAgICMgSMaw4bubbmcgZOG6q24gdGnhur9wIHRoZW8KICAgICAgICBwcmludChGb3JlLkdSRUVOICsgIlF1w6EgdHLDrG5oIMSRxINuZyBuaOG6rXAgxJHDoyBob8OgbiB04bqldCEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIkzGsHUgw706IELhuqFuIGPhuqduIGto4bufaSDEkeG7mW5nIGzhuqFpIOG7qW5nIGThu6VuZyBSb2Jsb3ggxJHhu4Mgw6FwIGThu6VuZyB0aGF5IMSR4buVaSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgCiAgICAgICAgIyBYw7NhIGZpbGUgdOG6oW0gbuG6v3UgY+G6p24KICAgICAgICB0cnk6CiAgICAgICAgICAgIHNodXRpbC5ybXRyZWUodGVtcF9kaXIpCiAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyAixJDDoyBk4buNbiBk4bq5cCBmaWxlIHThuqFtIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgZiJLaMO0bmcgdGjhu4MgeMOzYSBmaWxlIHThuqFtOiB7ZX0iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIAogICAgICAgICMgxJDhu6NpIG5nxrDhu51pIGTDuW5nIHhlbSBr4bq/dCBxdeG6owogICAgICAgIGlucHV0KEZvcmUuQ1lBTiArICJcbk5o4bqlbiBFbnRlciDEkeG7gyBxdWF5IGzhuqFpIG1lbnUgY2jDrW5oLi4uIiArIFN0eWxlLlJFU0VUX0FMTCkKCiAgICAKICAgIGFzeW5jIGRlZiBleHRyYWN0X2Nvb2tpZXNfZnJvbV9wYWNrYWdlcyhzZWxmKToKICAgICAgICAiIiJDaOG7qWMgbsSDbmcgbOG6pXkgY29va2llIHThu6sgY8OhYyBwYWNrYWdlIFJvYmxveCDEkcOjIMSRxINuZyBuaOG6rXAiIiIKICAgICAgICBwcmludF9oZWFkZXIoKQogICAgICAgIHByaW50KEZvcmUuQ1lBTiArICJcbuKVlOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCBM4bqkWSBDT09LSUUgVOG7qiBQQUNLQUdFIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVlyIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgVMOtbmggbsSDbmcgbsOgeSBjaG8gcGjDqXAgbOG6pXkgY29va2llIFJvYmxveCB04burICAg4pWRIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWRICBjw6FjIHBhY2thZ2UgxJHDoyDEkcSDbmcgbmjhuq1wICAgICAgICAgICAgICAgICAgICAgIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVmuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVnVxuIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAKICAgICAgICAjIFTDrG0gY8OhYyBwYWNrYWdlIFJvYmxveAogICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIsSQYW5nIHTDrG0ga2nhur9tIHBhY2thZ2UgUm9ibG94Li4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBwYWNrYWdlcyA9IHNlbGYuZ2V0X3JvYmxveF9wYWNrYWdlcygpCiAgICAgICAgCiAgICAgICAgaWYgbm90IHBhY2thZ2VzOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArICJLaMO0bmcgdMOsbSB0aOG6pXkgcGFja2FnZSBSb2Jsb3ggbsOgbyB0csOqbiB0aGnhur90IGLhu4siICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDIpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIAogICAgICAgICMgSGnhu4NuIHRo4buLIGRhbmggc8OhY2ggcGFja2FnZQogICAgICAgIHBhY2thZ2VfdGFibGUgPSBbXQogICAgICAgIGZvciBpLCBwYWNrYWdlIGluIGVudW1lcmF0ZShwYWNrYWdlcywgMSk6CiAgICAgICAgICAgIHBhY2thZ2VfdGFibGUuYXBwZW5kKFtpLCBwYWNrYWdlXSkKICAgICAgICAKICAgICAgICBwcmludCgiXG4iICsgRm9yZS5DWUFOICsgIkRBTkggU8OBQ0ggUEFDS0FHRSBST0JMT1giICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIHByaW50KHRhYnVsYXRlKHBhY2thZ2VfdGFibGUsIGhlYWRlcnM9WyJTVFQiLCAiUGFja2FnZSBOYW1lIl0sIHRhYmxlZm10PSJmYW5jeV9ncmlkIikpCiAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYixJDDoyB0w6xtIHRo4bqleSB7bGVuKHBhY2thZ2VzKX0gcGFja2FnZSBSb2Jsb3hcbiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgCiAgICAgICAgIyBD4bqjbmggYsOhbyB24buBIGNvb2tpZQogICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIuKaoO+4jyBMxq9VIMOdIFFVQU4gVFLhu4xORyDimqDvuI8iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIi0gQ29va2llIFJvYmxveCBjw7MgdGjhu4MgYuG7iyB2w7QgaGnhu4d1IGjDs2Ega2hpIMSRxINuZyB4deG6pXQiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIi0gxJDhu4MgY8OzIGNvb2tpZSBo4bujcCBs4buHLCBLSMOUTkcgxJHEg25nIHh14bqldCBzYXUga2hpIMSRxINuZyBuaOG6rXAiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIi0gQ2jhu4kgbOG6pXkgY29va2llIHThu6sgcGFja2FnZSDEkWFuZyDEkcSDbmcgbmjhuq1wIHbDoCBjaMawYSDEkcSDbmcgeHXhuqV0XG4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgIAogICAgICAgICMgQ2hvIHBow6lwIG5nxrDhu51pIGTDuW5nIGNo4buNbiBwYWNrYWdlIMSR4buDIGzhuqV5IGNvb2tpZQogICAgICAgIHBhY2thZ2VfY2hvaWNlID0gaW5wdXQoRm9yZS5ZRUxMT1cgKyAiTmjhuq1wIHPhu5EgdGjhu6kgdOG7sSBjw6FjIHBhY2thZ2UgbXXhu5FuIGzhuqV5IGNvb2tpZSAoY8OhY2ggbmhhdSBi4bufaSBk4bqldSBwaOG6qXkpIGhv4bq3YyAnYWxsJyDEkeG7gyBjaOG7jW4gdOG6pXQgY+G6ozogIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAKICAgICAgICBzZWxlY3RlZF9wYWNrYWdlcyA9IFtdCiAgICAgICAgaWYgcGFja2FnZV9jaG9pY2UubG93ZXIoKSA9PSAnYWxsJzoKICAgICAgICAgICAgc2VsZWN0ZWRfcGFja2FnZXMgPSBwYWNrYWdlcwogICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgIsSQw6MgY2jhu41uIHThuqV0IGPhuqMgcGFja2FnZSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgc2VsZWN0ZWRfaW5kaWNlcyA9IFtpbnQoaWR4LnN0cmlwKCkpIC0gMSBmb3IgaWR4IGluIHBhY2thZ2VfY2hvaWNlLnNwbGl0KCcsJykgaWYgaWR4LnN0cmlwKCldCiAgICAgICAgICAgICAgICBmb3IgaWR4IGluIHNlbGVjdGVkX2luZGljZXM6CiAgICAgICAgICAgICAgICAgICAgaWYgMCA8PSBpZHggPCBsZW4ocGFja2FnZXMpOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9wYWNrYWdlcy5hcHBlbmQocGFja2FnZXNbaWR4XSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IHNlbGVjdGVkX3BhY2thZ2VzOgogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIktow7RuZyBjw7MgcGFja2FnZSBuw6BvIMSRxrDhu6NjIGNo4buNbiwgc+G7rSBk4bulbmcgdOG6pXQgY+G6oyBwYWNrYWdlIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9wYWNrYWdlcyA9IHBhY2thZ2VzCiAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBmIsSQw6MgY2jhu41uIHtsZW4oc2VsZWN0ZWRfcGFja2FnZXMpfSBwYWNrYWdlIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArICJM4buxYSBjaOG7jW4ga2jDtG5nIGjhu6NwIGzhu4csIHPhu60gZOG7pW5nIHThuqV0IGPhuqMgcGFja2FnZSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICBzZWxlY3RlZF9wYWNrYWdlcyA9IHBhY2thZ2VzCiAgICAgICAgCiAgICAgICAgIyBU4bqhbyB0aMawIG3hu6VjIMSR4buDIGzGsHUgY29va2llIG7hur91IGNoxrBhIHThu5NuIHThuqFpCiAgICAgICAgY29va2llc19kaXIgPSBvcy5wYXRoLmpvaW4ob3MuZ2V0Y3dkKCksICJleHRyYWN0ZWRfY29va2llcyIpCiAgICAgICAgb3MubWFrZWRpcnMoY29va2llc19kaXIsIGV4aXN0X29rPVRydWUpCiAgICAgICAgCiAgICAgICAgIyBU4bqhbyBmaWxlIMSR4buDIGzGsHUgdOG6pXQgY+G6oyBjb29raWUKICAgICAgICBhbGxfY29va2llc19maWxlID0gb3MucGF0aC5qb2luKGNvb2tpZXNfZGlyLCAiYWxsX2Nvb2tpZXMudHh0IikKICAgICAgICAKICAgICAgICAjIELhuqNuZyBr4bq/dCBxdeG6owogICAgICAgIHJlc3VsdHNfdGFibGUgPSBbXQogICAgICAgIGV4dHJhY3RlZF9jb29raWVzID0gW10KICAgICAgICAKICAgICAgICAjIFjhu60gbMO9IHThu6tuZyBwYWNrYWdlCiAgICAgICAgZm9yIHBhY2thZ2UgaW4gc2VsZWN0ZWRfcGFja2FnZXM6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICMgxJDGsOG7nW5nIGThuqtuIMSR4bq/biBmaWxlIENvb2tpZXMgdHJvbmcgcGFja2FnZQogICAgICAgICAgICAgICAgY29va2llc19kYl9wYXRoID0gZiIvZGF0YS9kYXRhL3twYWNrYWdlfS9hcHBfd2Vidmlldy9EZWZhdWx0L0Nvb2tpZXMiCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGlmIG5vdCBvcy5wYXRoLmV4aXN0cyhjb29raWVzX2RiX3BhdGgpOgogICAgICAgICAgICAgICAgICAgIHJlc3VsdHNfdGFibGUuYXBwZW5kKFtwYWNrYWdlLCAiVGjhuqV0IGLhuqFpIiwgIkZpbGUgQ29va2llcyBraMO0bmcgdOG7k24gdOG6oWkiXSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFThuqFvIGLhuqNuIHNhbyB04bqhbSB0aOG7nWkgY+G7p2EgZmlsZSBDb29raWVzIMSR4buDIHRyw6FuaCBs4buXaSBraGkgxJHhu41jCiAgICAgICAgICAgICAgICB0ZW1wX2RiX3BhdGggPSBvcy5wYXRoLmpvaW4oY29va2llc19kaXIsIGYie3BhY2thZ2V9X2Nvb2tpZXMuZGIiKQogICAgICAgICAgICAgICAgc2h1dGlsLmNvcHkyKGNvb2tpZXNfZGJfcGF0aCwgdGVtcF9kYl9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEvhur90IG7hu5FpIMSR4bq/biBkYXRhYmFzZQogICAgICAgICAgICAgICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCh0ZW1wX2RiX3BhdGgpCiAgICAgICAgICAgICAgICBjdXJzb3IgPSBjb25uLmN1cnNvcigpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgVHJ1eSB24bqlbiBjb29raWUgLlJPQkxPU0VDVVJJVFkKICAgICAgICAgICAgICAgIGN1cnNvci5leGVjdXRlKCIiIgogICAgICAgICAgICAgICAgICAgIFNFTEVDVCB2YWx1ZSBGUk9NIGNvb2tpZXMgCiAgICAgICAgICAgICAgICAgICAgV0hFUkUgaG9zdF9rZXkgPSAnLnJvYmxveC5jb20nIEFORCBuYW1lID0gJy5ST0JMT1NFQ1VSSVRZJwogICAgICAgICAgICAgICAgIiIiKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgICAgICAgICAgICAgY29ubi5jbG9zZSgpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgWMOzYSBmaWxlIHThuqFtCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUodGVtcF9kYl9wYXRoKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiByZXN1bHQ6CiAgICAgICAgICAgICAgICAgICAgY29va2llX3ZhbHVlID0gcmVzdWx0WzBdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBJbiBjb29raWUgxJHhu4MgZGVidWcgKGNo4buJIGhp4buDbiB0aOG7iyBt4buZdCBwaOG6p24pCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyBmIkNvb2tpZSB04burIHtwYWNrYWdlfToge2Nvb2tpZV92YWx1ZVs6MTVdfS4uLntjb29raWVfdmFsdWVbLTE1Ol19IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdMOtbmggaOG7o3AgbOG7hyBj4bunYSBjb29raWUKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArIGYixJBhbmcgeMOhYyB0aOG7sWMgY29va2llIHThu6sge3BhY2thZ2V9Li4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICBpZiBzZWxmLnZlcmlmeV9jb29raWUoY29va2llX3ZhbHVlKToKICAgICAgICAgICAgICAgICAgICAgICAgIyBM4bqleSB0aMO0bmcgdGluIG5nxrDhu51pIGTDuW5nIHThu6sgY29va2llCiAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnQ29va2llJzogZicuUk9CTE9TRUNVUklUWT17Y29va2llX3ZhbHVlfScsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnVXNlci1BZ2VudCc6ICdNb3ppbGxhLzUuMCAoTGludXg7IEFuZHJvaWQgMTA7IE1vYmlsZSkgQXBwbGVXZWJLaXQvNTM3LjM2IChLSFRNTCwgbGlrZSBHZWNrbykgQ2hyb21lLzkxLjAuNDQ3Mi4xMjQgTW9iaWxlIFNhZmFyaS81MzcuMzYnLAogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICByZXNwb25zZSA9IHJlcXVlc3RzLmdldCgnaHR0cHM6Ly91c2Vycy5yb2Jsb3guY29tL3YxL3VzZXJzL2F1dGhlbnRpY2F0ZWQnLCBoZWFkZXJzPWhlYWRlcnMpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXNfY29kZSA9PSAyMDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2RhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gdXNlcl9kYXRhLmdldCgnbmFtZScsICdVbmtub3duJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfaWQgPSB1c2VyX2RhdGEuZ2V0KCdpZCcsICdVbmtub3duJykKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBMxrB1IGNvb2tpZSB2w6BvIGZpbGUgcmnDqm5nIGNobyBwYWNrYWdlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwYWNrYWdlX2Nvb2tpZV9maWxlID0gb3MucGF0aC5qb2luKGNvb2tpZXNfZGlyLCBmIntwYWNrYWdlfV97dXNlcm5hbWV9X2Nvb2tpZS50eHQiKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2l0aCBvcGVuKHBhY2thZ2VfY29va2llX2ZpbGUsICd3JykgYXMgZjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmLndyaXRlKGNvb2tpZV92YWx1ZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUaMOqbSB2w6BvIGRhbmggc8OhY2ggdOG6pXQgY+G6oyBjb29raWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3RlZF9jb29raWVzLmFwcGVuZCgoY29va2llX3ZhbHVlLCB1c2VybmFtZSwgdXNlcl9pZCwgcGFja2FnZSkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHNfdGFibGUuYXBwZW5kKFtwYWNrYWdlLCAiVGjDoG5oIGPDtG5nIOKckyIsIGYie3VzZXJuYW1lfSAoSUQ6IHt1c2VyX2lkfSkiXSkKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX3RleHQgPSBmIkFQSSB0cuG6oyB24buBIGzhu5dpOiB7cmVzcG9uc2Uuc3RhdHVzX2NvZGV9IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yX2RhdGEgPSByZXNwb25zZS5qc29uKCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAnZXJyb3JzJyBpbiBlcnJvcl9kYXRhIGFuZCBlcnJvcl9kYXRhWydlcnJvcnMnXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZXJyb3JfdGV4dCArPSBmIiAtIHtlcnJvcl9kYXRhWydlcnJvcnMnXVswXS5nZXQoJ21lc3NhZ2UnLCAnJyl9IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhc3MKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHNfdGFibGUuYXBwZW5kKFtwYWNrYWdlLCAiVGjhuqV0IGLhuqFpIOKclyIsIGVycm9yX3RleHRdKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdHNfdGFibGUuYXBwZW5kKFtwYWNrYWdlLCAiVGjhuqV0IGLhuqFpIOKclyIsICJDb29raWUga2jDtG5nIGjhu6NwIGzhu4cgKFjDoWMgdGjhu7FjKSJdKQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXN1bHRzX3RhYmxlLmFwcGVuZChbcGFja2FnZSwgIlRo4bqldCBi4bqhaSDinJciLCAiS2jDtG5nIHTDrG0gdGjhuqV5IGNvb2tpZSJdKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICByZXN1bHRzX3RhYmxlLmFwcGVuZChbcGFja2FnZSwgIkzhu5dpIOKaoO+4jyIsIHN0cihlKVs6MzBdICsgIi4uLiJdKQogICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBmIkzhu5dpIGtoaSB44butIGzDvSB7cGFja2FnZX06IHtlfSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgCiAgICAgICAgIyBMxrB1IHThuqV0IGPhuqMgY29va2llIHbDoG8gbeG7mXQgZmlsZQogICAgICAgIGlmIGV4dHJhY3RlZF9jb29raWVzOgogICAgICAgICAgICB3aXRoIG9wZW4oYWxsX2Nvb2tpZXNfZmlsZSwgJ3cnKSBhcyBmOgogICAgICAgICAgICAgICAgZm9yIGNvb2tpZSwgdXNlcm5hbWUsIHVzZXJfaWQsIHBhY2thZ2UgaW4gZXh0cmFjdGVkX2Nvb2tpZXM6CiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIiMge3VzZXJuYW1lfSAoSUQ6IHt1c2VyX2lkfSkgLSBQYWNrYWdlOiB7cGFja2FnZX1cbiIpCiAgICAgICAgICAgICAgICAgICAgZi53cml0ZShmIntjb29raWV9XG5cbiIpCiAgICAgICAgCiAgICAgICAgIyBIaeG7g24gdGjhu4sga+G6v3QgcXXhuqMKICAgICAgICBwcmludF9oZWFkZXIoKQogICAgICAgIHByaW50KEZvcmUuV0hJVEUgKyAiXG4gICAgICAgICAgICAgICAgICBL4bq+VCBRVeG6oiBM4bqkWSBDT09LSUUgICAgICAgICAgICAgICAgICAgIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBwcmludCh0YWJ1bGF0ZShyZXN1bHRzX3RhYmxlLCBoZWFkZXJzPVsiUGFja2FnZSIsICJUcuG6oW5nIHRow6FpIiwgIlRow7RuZyB0aW4iXSwgdGFibGVmbXQ9ImZhbmN5X2dyaWQiKSkKICAgICAgICAKICAgICAgICBpZiBleHRyYWN0ZWRfY29va2llczoKICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYiXG7EkMOjIGzhuqV5IHRow6BuaCBjw7RuZyB7bGVuKGV4dHJhY3RlZF9jb29raWVzKX0gY29va2llISIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgZiJDb29raWUgxJHDoyDEkcaw4bujYyBsxrB1IHbDoG8gdGjGsCBt4bulYzoge2Nvb2tpZXNfZGlyfSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgZiJU4bqldCBj4bqjIGNvb2tpZSDEkcOjIMSRxrDhu6NjIGzGsHUgdsOgbzoge2FsbF9jb29raWVzX2ZpbGV9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGjDqm0gaMaw4bubbmcgZOG6q24gc+G7rSBk4bulbmcgY29va2llCiAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArICJcbj09PSBIxq/hu5pORyBE4bqqTiBT4busIEThu6RORyBDT09LSUUgPT09IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIjEuIEtIw5RORyDEkcSDbmcgeHXhuqV0IGto4buPaSBSb2Jsb3ggc2F1IGtoaSBs4bqleSBjb29raWUiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyAiMi4gU+G7rSBk4bulbmcgY29va2llIG5nYXkgc2F1IGtoaSBs4bqleSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArICIzLiBO4bq/dSBjb29raWUga2jDtG5nIGhv4bqhdCDEkeG7mW5nLCBow6N5IMSRxINuZyBuaOG6rXAgbOG6oWkgdsOgIGzhuqV5IGNvb2tpZSBt4bubaSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyAiXG5LaMO0bmcgbOG6pXkgxJHGsOG7o2MgY29va2llIG7DoG8hIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAKICAgICAgICAjIMSQ4bujaSBuZ8aw4budaSBkw7luZyB4ZW0ga+G6v3QgcXXhuqMKICAgICAgICBpbnB1dChGb3JlLkNZQU4gKyAiXG5OaOG6pW4gRW50ZXIgxJHhu4MgcXVheSBs4bqhaSBtZW51IGNow61uaC4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCgoKCiAgICBkZWYgc2F2ZV9wYWNrYWdlX3BhdGhzKHNlbGYsIHBhdGhzKToKICAgICAgICB3aXRoIG9wZW4oQ29uZmlnLlBBQ0tBR0VfRklMRSwgInciKSBhcyBmOgogICAgICAgICAgICBmb3IgcGFja2FnZV9uYW1lLCBwYXRoIGluIHBhdGhzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICBmLndyaXRlKGYie3BhY2thZ2VfbmFtZX0se3BhdGh9XG4iKQoKICAgIGRlZiBsb2FkX3BhY2thZ2VfcGF0aHMoc2VsZik6CiAgICAgICAgcGF0aHMgPSB7fQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKENvbmZpZy5QQUNLQUdFX0ZJTEUpOgogICAgICAgICAgICB3aXRoIG9wZW4oQ29uZmlnLlBBQ0tBR0VfRklMRSwgJ3InKSBhcyBmOgogICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gZjoKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlX25hbWUsIHBhdGggPSBsaW5lLnN0cmlwKCkuc3BsaXQoJywnLCAxKQogICAgICAgICAgICAgICAgICAgIHBhdGhzW3BhY2thZ2VfbmFtZV0gPSBwYXRoCiAgICAgICAgcmV0dXJuIHBhdGhzCiAgICBkZWYgX2NsZWFudXBfY2FjaGUoc2VsZik6CiAgICAgICAgIiIiWMOzYSB04bqldCBj4bqjIGNhY2hlIGtow7RuZyBwaMOibiBiaeG7h3Qga8OtY2ggdGjGsOG7m2MiIiIKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgTMawdSB0aMO0bmcgdGluIHRyxrDhu5tjIGtoaSB4w7NhCiAgICAgICAgICAgIGNhY2hlX3NpemVfYmVmb3JlID0gbGVuKHNlbGYuX3N0YXR1c19jYWNoZSkKICAgICAgICAgICAgY2FjaGVfbWVtb3J5X2JlZm9yZSA9IHN1bShsZW4oc3RyKGl0ZW0pKSBmb3IgaXRlbSBpbiBzZWxmLl9zdGF0dXNfY2FjaGUuaXRlbXMoKSkKICAgICAgICAgICAgY3VycmVudF90aW1lID0gZGF0ZXRpbWUubm93KCkKCiAgICAgICAgICAgICMgWMOzYSB0b8OgbiBi4buZIGNhY2hlCiAgICAgICAgICAgIHNlbGYuX3N0YXR1c19jYWNoZS5jbGVhcigpCgogICAgICAgICAgICAjIFTDrW5oIHRvw6FuIHRow7RuZyB0aW4gc2F1IGtoaSB4w7NhCiAgICAgICAgICAgIGNhY2hlX3NpemVfYWZ0ZXIgPSAwICAjIFbDrCDEkcOjIHjDs2EgaOG6v3QKICAgICAgICAgICAgY2FjaGVfbWVtb3J5X2FmdGVyID0gMCAgIyBWw6wgxJHDoyB4w7NhIGjhur90CiAgICAgICAgICAgIGl0ZW1zX3JlbW92ZWQgPSBjYWNoZV9zaXplX2JlZm9yZQogICAgICAgICAgICBtZW1vcnlfZnJlZWQgPSBjYWNoZV9tZW1vcnlfYmVmb3JlCgogICAgICAgICAgICAjIEzGsHUgdGjDtG5nIHRpbiDEkeG7gyBz4butIGThu6VuZyB0cm9uZyBiw6FvIGPDoW8KICAgICAgICAgICAgc2VsZi5fbGFzdF9jbGVhbnVwX3N0YXRzID0gewogICAgICAgICAgICAgICAgIml0ZW1zX3JlbW92ZWQiOiBpdGVtc19yZW1vdmVkLAogICAgICAgICAgICAgICAgIm1lbW9yeV9mcmVlZCI6IG1lbW9yeV9mcmVlZCwKICAgICAgICAgICAgICAgICJ0aW1lIjogY3VycmVudF90aW1lCiAgICAgICAgICAgIH0KCiAgICAgICAgICAgICMgRm9ybWF0IGR1bmcgbMaw4bujbmcgxJHhu4MgZOG7hSDEkeG7jWMKICAgICAgICAgICAgZGVmIGZvcm1hdF9zaXplKHNpemVfYnl0ZXMpOgogICAgICAgICAgICAgICAgaWYgc2l6ZV9ieXRlcyA8IDEwMjQ6ICAjIDwgMUtCCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYie3NpemVfYnl0ZXN9QiIKICAgICAgICAgICAgICAgIGVsaWYgc2l6ZV9ieXRlcyA8IDEwMjQgKiAxMDI0OiAgIyA8IDFNQgogICAgICAgICAgICAgICAgICAgIHJldHVybiBmIntzaXplX2J5dGVzLzEwMjQ6LjJmfUtCIgogICAgICAgICAgICAgICAgZWxzZTogICMgPj0gMU1CCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYie3NpemVfYnl0ZXMvKDEwMjQqMTAyNCk6LjJmfU1CIgoKICAgICAgICAgICAgIyBJbiB0aMO0bmcgYsOhbyBjaGkgdGnhur90CiAgICAgICAgICAgIHByaW50KGYie0ZvcmUuR1JFRU59xJDDoyB4w7NhIHRvw6BuIGLhu5kgY2FjaGU6IikKICAgICAgICAgICAgcHJpbnQoZiItIFPhu5EgbeG7pWMgxJHDoyB4w7NhOiB7aXRlbXNfcmVtb3ZlZH0iKQogICAgICAgICAgICBwcmludChmIi0gRHVuZyBsxrDhu6NuZyDEkcOjIGdp4bqjaSBwaMOzbmc6IHtmb3JtYXRfc2l6ZShtZW1vcnlfZnJlZWQpfSIpCiAgICAgICAgICAgIHByaW50KGYiLSBDYWNoZSBoaeG7h24gdOG6oWk6IHtjYWNoZV9zaXplX2FmdGVyfSBt4bulYyAoe2Zvcm1hdF9zaXplKGNhY2hlX21lbW9yeV9hZnRlcil9KXtTdHlsZS5SRVNFVF9BTEx9IikKCiAgICAgICAgICAgICMgTMawdSB0aOG7nWkgZ2lhbiBk4buNbiBk4bq5cCBjYWNoZQogICAgICAgICAgICBzZWxmLl9sYXN0X2NhY2hlX2NsZWFudXAgPSBjdXJyZW50X3RpbWUKCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZOG7jW4gZOG6uXAgY2FjaGU6IHtlfSIpCiAgICAgICAgICAgIHByaW50KGYie0ZvcmUuUkVEfUzhu5dpIGtoaSBk4buNbiBk4bq5cCBjYWNoZToge2V9e1N0eWxlLlJFU0VUX0FMTH0iKQogICAgZGVmIGxvYWRfYWNjb3VudHMoc2VsZik6CiAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKENvbmZpZy5BQ0NPVU5UU19GSUxFKToKICAgICAgICAgICAgd2l0aCBvcGVuKENvbmZpZy5BQ0NPVU5UU19GSUxFLCAncicpIGFzIGY6CiAgICAgICAgICAgICAgICBmb3IgbGluZSBpbiBmOgogICAgICAgICAgICAgICAgICAgIHBhY2thZ2UsIHVzZXJfaWQgPSBsaW5lLnN0cmlwKCkuc3BsaXQoJywnLCAxKQogICAgICAgICAgICAgICAgICAgIGFjY291bnRzLmFwcGVuZCgocGFja2FnZSwgdXNlcl9pZCkpCiAgICAgICAgcmV0dXJuIGFjY291bnRzCgogICAgZGVmIHNhdmVfYWNjb3VudHMoc2VsZiwgYWNjb3VudHMpOgogICAgICAgIHdpdGggb3BlbihDb25maWcuQUNDT1VOVFNfRklMRSwgInciKSBhcyBmOgogICAgICAgICAgICBmb3IgcGFja2FnZSwgdXNlcl9pZCBpbiBhY2NvdW50czoKICAgICAgICAgICAgICAgIGYud3JpdGUoZiJ7cGFja2FnZX0se3VzZXJfaWR9XG4iKQoKICAgIGRlZiBsb2FkX3NlcnZlcl9saW5rcyhzZWxmKToKICAgICAgICBsaW5rcyA9IFtdCiAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoQ29uZmlnLlNFUlZFUl9MSU5LU19GSUxFKToKICAgICAgICAgICAgd2l0aCBvcGVuKENvbmZpZy5TRVJWRVJfTElOS1NfRklMRSwgJ3InKSBhcyBmOgogICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gZjoKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlLCBsaW5rID0gbGluZS5zdHJpcCgpLnNwbGl0KCcsJywgMSkKICAgICAgICAgICAgICAgICAgICBsaW5rcy5hcHBlbmQoKHBhY2thZ2UsIGxpbmspKQogICAgICAgIHJldHVybiBsaW5rcwoKICAgIGRlZiBzYXZlX3NlcnZlcl9saW5rcyhzZWxmLCBzZXJ2ZXJfbGlua3MpOgogICAgICAgIHdpdGggb3BlbihDb25maWcuU0VSVkVSX0xJTktTX0ZJTEUsICJ3IikgYXMgZjoKICAgICAgICAgICAgZm9yIHBhY2thZ2UsIGxpbmsgaW4gc2VydmVyX2xpbmtzOgogICAgICAgICAgICAgICAgZi53cml0ZShmIntwYWNrYWdlfSx7bGlua31cbiIpCgogICAgZGVmIGdldF9yb2Jsb3hfcGFja2FnZXMoc2VsZik6CiAgICAgICAgcGFja2FnZXMgPSBbXQogICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKCJwbSBsaXN0IHBhY2thZ2VzIHwgZ3JlcCAncm9ibG94JyIsIHNoZWxsPVRydWUsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkKICAgICAgICBpZiByZXN1bHQucmV0dXJuY29kZSA9PSAwOgogICAgICAgICAgICBwYWNrYWdlcyA9IFtsaW5lLnNwbGl0KCI6IilbMV0gZm9yIGxpbmUgaW4gcmVzdWx0LnN0ZG91dC5zcGxpdGxpbmVzKCldCiAgICAgICAgcmV0dXJuIHBhY2thZ2VzCgogICAgYXN5bmMgZGVmIGdldF91c2VyX2lkKHNlbGYsIHVzZXJuYW1lKToKICAgICAgICB1cmwgPSAiaHR0cHM6Ly91c2Vycy5yb2Jsb3guY29tL3YxL3VzZXJuYW1lcy91c2VycyIKICAgICAgICBwYXlsb2FkID0gewogICAgICAgICAgICAidXNlcm5hbWVzIjogW3VzZXJuYW1lXSwKICAgICAgICAgICAgImV4Y2x1ZGVCYW5uZWRVc2VycyI6IFRydWUKICAgICAgICB9CiAgICAgICAgaGVhZGVycyA9IHsiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24ifQogICAgICAgIGFzeW5jIHdpdGggYWlvaHR0cC5DbGllbnRTZXNzaW9uKCkgYXMgc2Vzc2lvbjoKICAgICAgICAgICAgYXN5bmMgd2l0aCBzZXNzaW9uLnBvc3QodXJsLCBqc29uPXBheWxvYWQsIGhlYWRlcnM9aGVhZGVycykgYXMgcmVzcG9uc2U6CiAgICAgICAgICAgICAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgICAgICBpZiAnZGF0YScgaW4gZGF0YSBhbmQgbGVuKGRhdGFbJ2RhdGEnXSkgPiAwOgogICAgICAgICAgICAgICAgICAgIHJldHVybiBzdHIoZGF0YVsnZGF0YSddWzBdWydpZCddKQogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIGdldF91c2VybmFtZShzZWxmLCB1c2VyX2lkKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHVybCA9IGYiaHR0cHM6Ly91c2Vycy5yb2Jsb3guY29tL3YxL3VzZXJzL3t1c2VyX2lkfSIKICAgICAgICAgICAgcmVzcG9uc2UgPSByZXF1ZXN0cy5nZXQodXJsKQogICAgICAgICAgICByZXNwb25zZS5yYWlzZV9mb3Jfc3RhdHVzKCkKICAgICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmpzb24oKQogICAgICAgICAgICByZXR1cm4gZGF0YS5nZXQoIm5hbWUiLCAiS2jDtG5nIHLDtSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJFcnJvciBnZXR0aW5nIHVzZXJuYW1lIGZvciB7dXNlcl9pZH06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIGtpbGxfc3BlY2lmaWNfcm9ibG94X3Byb2Nlc3Moc2VsZiwgcGFja2FnZV9uYW1lKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsnYW0nLCAnZm9yY2Utc3RvcCcsIHBhY2thZ2VfbmFtZV0sCiAgICAgICAgICAgICAgICAgICAgICAgICBzdGRvdXQ9c3VicHJvY2Vzcy5ERVZOVUxMLAogICAgICAgICAgICAgICAgICAgICAgICAgc3RkZXJyPXN1YnByb2Nlc3MuREVWTlVMTCkKICAgICAgICAgICAgbG9nZ2VyLmluZm8oZiJLaWxsZWQgUm9ibG94IHByb2Nlc3MgZm9yIHtwYWNrYWdlX25hbWV9IikKICAgICAgICAgICAgdGltZS5zbGVlcCgxKQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiRmFpbGVkIHRvIGtpbGwgcHJvY2VzcyBmb3Ige3BhY2thZ2VfbmFtZX06IHtlfSIpCgogICAgZGVmIGlzX3BhY2thZ2VfaW5zdGFsbGVkKHNlbGYsIHBhY2thZ2VfbmFtZTogc3RyKSAtPiBib29sOgogICAgICAgIHRyeToKICAgICAgICAgICAgY21kID0gZiJwbSBsaXN0IHBhY2thZ2VzIHwgZ3JlcCB7cGFja2FnZV9uYW1lfSIKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oY21kLCBzaGVsbD1UcnVlLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCiAgICAgICAgICAgIHJldHVybiBib29sKHJlc3VsdC5zdGRvdXQuc3RyaXAoKSkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkVycm9yIGNoZWNraW5nIHBhY2thZ2UgaW5zdGFsbGF0aW9uOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKCiAgICBkZWYgY2hlY2tfZXJyb3JfY29kZShzZWxmLCBwYWNrYWdlX25hbWU6IHN0cikgLT4gT3B0aW9uYWxbc3RyXToKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ2hlY2sgYm90aCBwYWNrYWdlIGRpcmVjdG9yeSBhbmQgbG9nY2F0IGZvciBlcnJvciBjb2RlCiAgICAgICAgICAgIGxvZ19wYXRocyA9IFsKICAgICAgICAgICAgICAgIGYiL2RhdGEvZGF0YS97cGFja2FnZV9uYW1lfS9maWxlcy9sb2dzL2xvZy50eHQiLAogICAgICAgICAgICAgICAgZiIvZGF0YS9kYXRhL3twYWNrYWdlX25hbWV9L2ZpbGVzL0NsaWVudFNldHRpbmdzL0xPRyIKICAgICAgICAgICAgXQogICAgICAgICAgICAKICAgICAgICAgICAgIyBGaXJzdCBjaGVjayBsb2cgZmlsZXMKICAgICAgICAgICAgZm9yIGxvZ19wYXRoIGluIGxvZ19wYXRoczoKICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKGxvZ19wYXRoKToKICAgICAgICAgICAgICAgICAgICB3aXRoIG9wZW4obG9nX3BhdGgsICdyJywgZW5jb2Rpbmc9J3V0Zi04JywgZXJyb3JzPSdpZ25vcmUnKSBhcyBmOgogICAgICAgICAgICAgICAgICAgICAgICAjIFJlYWQgbGFzdCA1MCBsaW5lcyB0byBjaGVjayBmb3IgcmVjZW50IGVycm9ycwogICAgICAgICAgICAgICAgICAgICAgICBsaW5lcyA9IGYucmVhZGxpbmVzKClbLTUwOl0KICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gcmV2ZXJzZWQobGluZXMpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgIkVycm9yIENvZGU6IDI3OSIgaW4gbGluZSBvciAiSUQgPSAxNzogQ29ubmVjdGlvbiBhdHRlbXB0IGZhaWxlZCIgaW4gbGluZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gIjI3OSIKICAgICAgICAgICAgCiAgICAgICAgICAgICMgVGhlbiBjaGVjayBsb2djYXQgZm9yIHJlY2VudCBlcnJvcnMKICAgICAgICAgICAgY21kID0gZiJsb2djYXQgLWQgfCBncmVwIHtwYWNrYWdlX25hbWV9IHwgZ3JlcCAtRSAnKEVycm9yIENvZGU6IDI3OXxJRCA9IDE3OiBDb25uZWN0aW9uIGF0dGVtcHQgZmFpbGVkKScgfCB0YWlsIC1uIDUwIgogICAgICAgICAgICByZXN1bHQgPSBzdWJwcm9jZXNzLnJ1bihjbWQsIHNoZWxsPVRydWUsIGNhcHR1cmVfb3V0cHV0PVRydWUsIHRleHQ9VHJ1ZSkKICAgICAgICAgICAgaWYgIkVycm9yIENvZGU6IDI3OSIgaW4gcmVzdWx0LnN0ZG91dCBvciAiSUQgPSAxNzogQ29ubmVjdGlvbiBhdHRlbXB0IGZhaWxlZCIgaW4gcmVzdWx0LnN0ZG91dDoKICAgICAgICAgICAgICAgIHJldHVybiAiMjc5IgogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJFcnJvciBjaGVja2luZyBsb2cgZmlsZSBmb3Ige3BhY2thZ2VfbmFtZX06IHtlfSIpCiAgICAgICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIGlzX3BhY2thZ2VfcnVubmluZyhzZWxmLCBwYWNrYWdlX25hbWU6IHN0cikgLT4gdHVwbGVbYm9vbCwgT3B0aW9uYWxbc3RyXV06CiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEZpcnN0IGNoZWNrIGZvciBlcnJvciBjb2RlCiAgICAgICAgICAgIGVycm9yX2NvZGUgPSBzZWxmLmNoZWNrX2Vycm9yX2NvZGUocGFja2FnZV9uYW1lKQogICAgICAgICAgICBpZiBlcnJvcl9jb2RlID09ICIyNzkiOgogICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlLCAiMjc5IgogICAgICAgICAgICAKICAgICAgICAgICAgIyBDaGVjayBwcm9jZXNzIHN0YXR1cwogICAgICAgICAgICBjbWQgPSAicHMgLUEiCiAgICAgICAgICAgIHJlc3VsdCA9IHN1YnByb2Nlc3MucnVuKGNtZCwgc2hlbGw9VHJ1ZSwgY2FwdHVyZV9vdXRwdXQ9VHJ1ZSwgdGV4dD1UcnVlKQogICAgICAgICAgICBwcm9jZXNzZXMgPSByZXN1bHQuc3Rkb3V0LnNwbGl0KCdcbicpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIExvb2sgZm9yIHByb2Nlc3NlcyB0aGF0IG1hdGNoIG91ciBwYWNrYWdlIGJ1dCBleGNsdWRlIGdyZXAKICAgICAgICAgICAgcm9ibG94X3Byb2Nlc3NlcyA9IFsKICAgICAgICAgICAgICAgIHByb2MgZm9yIHByb2MgaW4gcHJvY2Vzc2VzCiAgICAgICAgICAgICAgICBpZiBwYWNrYWdlX25hbWUgaW4gcHJvYwogICAgICAgICAgICAgICAgYW5kIG5vdCAnZ3JlcCcgaW4gcHJvYwogICAgICAgICAgICAgICAgYW5kIGxlbihwcm9jLnN0cmlwKCkpID4gMAogICAgICAgICAgICBdCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBub3Qgcm9ibG94X3Byb2Nlc3NlczoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiTm8gcHJvY2Vzc2VzIGZvdW5kIGZvciB7cGFja2FnZV9uYW1lfSIpCiAgICAgICAgICAgICAgICByZXR1cm4gRmFsc2UsIE5vbmUKCiAgICAgICAgICAgICMgQ2hlY2sgaWYgdGhlIHBhY2thZ2UgaXMgaW4gdGhlIGFjdGl2ZSB3aW5kb3cgc3RhY2sKICAgICAgICAgICAgY21kID0gImR1bXBzeXMgYWN0aXZpdHkgYWN0aXZpdGllcyB8IGdyZXAgLUEgMyAnUnVubmluZyBhY3Rpdml0aWVzJyIKICAgICAgICAgICAgcmVzdWx0ID0gc3VicHJvY2Vzcy5ydW4oY21kLCBzaGVsbD1UcnVlLCBjYXB0dXJlX291dHB1dD1UcnVlLCB0ZXh0PVRydWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIElmIHdlIGNhbid0IGNoZWNrIGFjdGl2aXRpZXMsIGFzc3VtZSBpdCdzIHJ1bm5pbmcgaWYgcHJvY2VzcyBleGlzdHMKICAgICAgICAgICAgaWYgcmVzdWx0LnJldHVybmNvZGUgIT0gMDoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiUHJvY2VzcyBjaGVjayBvbmx5OiB7cGFja2FnZV9uYW1lfSBpcyBydW5uaW5nIikKICAgICAgICAgICAgICAgIHJldHVybiBUcnVlLCBOb25lCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgYWN0aXZpdGllc19vdXRwdXQgPSByZXN1bHQuc3Rkb3V0LnN0cmlwKCkKICAgICAgICAgICAgCiAgICAgICAgICAgICMgQ29uc2lkZXIgaXQgcnVubmluZyBpZiBlaXRoZXI6CiAgICAgICAgICAgICMgMS4gUHJvY2VzcyBleGlzdHMgYW5kIHdlIHNlZSBhY3Rpdml0eSBpbiB0aGUgc3RhY2sKICAgICAgICAgICAgIyAyLiBQcm9jZXNzIGV4aXN0cyBhbmQgYWN0aXZpdHkgY2hlY2sgZmFpbGVkIChmYWxsYmFjaykKICAgICAgICAgICAgaXNfcnVubmluZyA9IGJvb2wocm9ibG94X3Byb2Nlc3NlcykgYW5kIChwYWNrYWdlX25hbWUgaW4gYWN0aXZpdGllc19vdXRwdXQgb3IgcmVzdWx0LnJldHVybmNvZGUgIT0gMCkKICAgICAgICAgICAgcmV0dXJuIGlzX3J1bm5pbmcsIE5vbmUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkVycm9yIGNoZWNraW5nIHBhY2thZ2Ugc3RhdHVzOiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UsIE5vbmUKCiAgICBhc3luYyBkZWYgbGF1bmNoX3JvYmxveChzZWxmLCBwYWNrYWdlX25hbWU6IHN0ciwgc2VydmVyX2xpbms6IHN0ciwgZXJyb3JfY29kZTogT3B0aW9uYWxbc3RyXSA9IE5vbmUpOgogICAgICAgIHRyeToKICAgICAgICAgICAgaWYgZXJyb3JfY29kZSA9PSAiMjc5IjoKICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGYiRXJyb3IgMjc5IGRldGVjdGVkIGZvciB7cGFja2FnZV9uYW1lfSwgd2FpdGluZyB7Q29uZmlnLkVSUk9SXzI3OV9SRVRSWV9ERUxBWX0gc2Vjb25kcyBiZWZvcmUgcmVsYXVuY2guLi4iKQogICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcChDb25maWcuRVJST1JfMjc5X1JFVFJZX0RFTEFZKQogICAgICAgICAgICAKICAgICAgICAgICAgc3VicHJvY2Vzcy5ydW4oWydsb2djYXQnLCAnLWMnXSwgc3Rkb3V0PXN1YnByb2Nlc3MuREVWTlVMTCwgc3RkZXJyPXN1YnByb2Nlc3MuREVWTlVMTCkKICAgICAgICAgICAgCiAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsKICAgICAgICAgICAgICAgICdhbScsICdzdGFydCcsICctbicsCiAgICAgICAgICAgICAgICBmJ3twYWNrYWdlX25hbWV9L2NvbS5yb2Jsb3guY2xpZW50LnN0YXJ0dXAuQWN0aXZpdHlTcGxhc2gnLAogICAgICAgICAgICAgICAgJy1kJywgc2VydmVyX2xpbmsKICAgICAgICAgICAgXSwgc3Rkb3V0PXN1YnByb2Nlc3MuREVWTlVMTCwgc3RkZXJyPXN1YnByb2Nlc3MuREVWTlVMTCkKICAgICAgICAgICAgCiAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoMTApCiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsKICAgICAgICAgICAgICAgICAgICAnYW0nLCAnc3RhcnQnLCAnLW4nLAogICAgICAgICAgICAgICAgICAgIGYne3BhY2thZ2VfbmFtZX0vY29tLnJvYmxveC5jbGllbnQuQWN0aXZpdHlQcm90b2NvbExhdW5jaCcsCiAgICAgICAgICAgICAgICAgICAgJy1kJywgc2VydmVyX2xpbmsKICAgICAgICAgICAgICAgIF0sIHN0ZG91dD1zdWJwcm9jZXNzLkRFVk5VTEwsIHN0ZGVycj1zdWJwcm9jZXNzLkRFVk5VTEwpCiAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDEwKQogICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJGYWlsZWQgdG8gbGF1bmNoIFJvYmxveCBmb3Ige3BhY2thZ2VfbmFtZX06IHtlfSIpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJFcnJvciBsYXVuY2hpbmcgcHJvdG9jb2wgYWN0aXZpdHk6IHtlfSIpICAKICAgIGRlZiBmaW5kX3VzZXJpZF9mcm9tX2ZpbGUoc2VsZiwgZmlsZV9wYXRoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHdpdGggb3BlbihmaWxlX3BhdGgsICdyJykgYXMgZmlsZToKICAgICAgICAgICAgICAgIGNvbnRlbnQgPSBmaWxlLnJlYWQoKQogICAgICAgICAgICAgICAgdXNlcmlkX3N0YXJ0ID0gY29udGVudC5maW5kKCciVXNlcklkIjoiJykKICAgICAgICAgICAgICAgIGlmIHVzZXJpZF9zdGFydCA9PSAtMToKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArICJLaMO0bmcgdMOsbSB0aOG6pXkgVXNlciBJRC4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICB1c2VyaWRfc3RhcnQgKz0gbGVuKCciVXNlcklkIjoiJykKICAgICAgICAgICAgICAgIHVzZXJpZF9lbmQgPSBjb250ZW50LmZpbmQoJyInLCB1c2VyaWRfc3RhcnQpCiAgICAgICAgICAgICAgICBpZiB1c2VyaWRfZW5kID09IC0xOgogICAgICAgICAgICAgICAgICAgIHByaW50KCJLaMO0bmcgdMOsbSB0aOG6pXkga+G6v3QgdGjDumMgY+G7p2EgVXNlciBJRC4iKQogICAgICAgICAgICAgICAgICAgIHJldHVybiBOb25lCiAgICAgICAgICAgICAgICB1c2VyaWQgPSBjb250ZW50W3VzZXJpZF9zdGFydDp1c2VyaWRfZW5kXQogICAgICAgICAgICAgICAgcmV0dXJuIHVzZXJpZAogICAgICAgIGV4Y2VwdCBJT0Vycm9yIGFzIGU6CiAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgZiJM4buXaSBraGkgxJHhu41jIGZpbGU6IHtlfSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgIHJldHVybiBOb25lCiAgICBhc3luYyBkZWYgc2VuZF9kaXNjb3JkX21lc3NhZ2Uoc2VsZiwgbWVzc2FnZSk6CiAgICAgICAgIiIiR+G7rWkgdGjDtG5nIGLDoW8gRGlzY29yZCIiIgogICAgICAgIGNvbmZpZyA9IGxvYWRfZGlzY29yZF9jb25maWcoKQogICAgICAgIHdlYmhvb2tfdXJsID0gY29uZmlnLmdldCgiV0VCSE9PS19VUkwiKQogICAgICAgIGlmIHdlYmhvb2tfdXJsOgogICAgICAgICAgICBhd2FpdCBzZWxmLnNlbmRfd2ViaG9va19tZXNzYWdlKHdlYmhvb2tfdXJsLCBjb250ZW50PW1lc3NhZ2UpCgogICAgYXN5bmMgZGVmIHNlbmRfd2ViaG9va19tZXNzYWdlKHNlbGYsIHdlYmhvb2tfdXJsLCBjb250ZW50PU5vbmUsIGVtYmVkcz1Ob25lKToKICAgICAgICBwcmludChmIsSQYW5nIGfhu61pIHdlYmhvb2sgxJHhur9uOiB7d2ViaG9va191cmx9IikKICAgICAgICBwcmludChmIk7hu5lpIGR1bmc6IHtjb250ZW50fSIpCiAgICAgICAgcHJpbnQoZiJFbWJlZHM6IHtlbWJlZHN9IikKICAgICAgICAKICAgICAgICBhc3luYyB3aXRoIGFpb2h0dHAuQ2xpZW50U2Vzc2lvbigpIGFzIHNlc3Npb246CiAgICAgICAgICAgIHdlYmhvb2tfZGF0YSA9IHt9CiAgICAgICAgICAgIGlmIGNvbnRlbnQ6CiAgICAgICAgICAgICAgICB3ZWJob29rX2RhdGFbImNvbnRlbnQiXSA9IGNvbnRlbnQKICAgICAgICAgICAgaWYgZW1iZWRzOgogICAgICAgICAgICAgICAgd2ViaG9va19kYXRhWyJlbWJlZHMiXSA9IGVtYmVkcwogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgYXN5bmMgd2l0aCBzZXNzaW9uLnBvc3Qod2ViaG9va191cmwsIGpzb249d2ViaG9va19kYXRhKSBhcyByZXNwb25zZToKICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSByZXNwb25zZS5zdGF0dXMKICAgICAgICAgICAgICAgICAgICBwcmludChmIkvhur90IHF14bqjIGfhu61pIHdlYmhvb2s6IHtzdGF0dXN9IikKICAgICAgICAgICAgICAgICAgICBpZiBzdGF0dXMgPT0gMjA0OgogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3BvbnNlX3RleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJM4buXaSB3ZWJob29rOiB7c3RhdHVzfSAtIHtyZXNwb25zZV90ZXh0fSIpCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIEZhbHNlCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkzhu5dpIGfhu61pIHdlYmhvb2s6IHtlfSIpCiAgICAgICAgICAgICAgICBwcmludChmIkV4Y2VwdGlvbiBraGkgZ+G7rWkgd2ViaG9vazoge2V9IikKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZQoKICAgIGFzeW5jIGRlZiBzZW5kX3dlYmhvb2tfbm90aWZpY2F0aW9uKHNlbGYsIG1lc3NhZ2UpOgogICAgICAgICIiIkfhu61pIHRow7RuZyBiw6FvIMSRxqFuIGdp4bqjbiBxdWEgd2ViaG9vayIiIgogICAgICAgIGNvbmZpZyA9IGxvYWRfZGlzY29yZF9jb25maWcoKQogICAgICAgIHdlYmhvb2tfdXJsID0gY29uZmlnLmdldCgiV0VCSE9PS19VUkwiKQogICAgICAgIGlmIHdlYmhvb2tfdXJsOgogICAgICAgICAgICBhd2FpdCBzZWxmLnNlbmRfd2ViaG9va19tZXNzYWdlKHdlYmhvb2tfdXJsLCBjb250ZW50PW1lc3NhZ2UpCiAgICBhc3luYyBkZWYgc2VuZF9wZXJpb2RpY19zdGF0dXNfcmVwb3J0KHNlbGYpOgogICAgICAgICIiIkfhu61pIGLDoW8gY8OhbyB0cuG6oW5nIHRow6FpIMSR4buLbmgga+G7syBxdWEgRGlzY29yZCBXZWJob29rIiIiCiAgICAgICAgY29uZmlnID0gbG9hZF9kaXNjb3JkX2NvbmZpZygpCiAgICAgICAgd2ViaG9va191cmwgPSBjb25maWcuZ2V0KCJXRUJIT09LX1VSTCIpCiAgICAgICAgaWYgbm90IHdlYmhvb2tfdXJsOgogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICB0cnk6CiAgICAgICAgICAgICMgQ2h14bqpbiBi4buLIGVtYmVkIGNobyBiw6FvIGPDoW8KICAgICAgICAgICAgZW1iZWQgPSB7CiAgICAgICAgICAgICAgICAidGl0bGUiOiAiQsOhbyBjw6FvIHRy4bqhbmcgdGjDoWkgxJHhu4tuaCBr4buzIiwKICAgICAgICAgICAgICAgICJkZXNjcmlwdGlvbiI6IGYiVGjhu51pIGdpYW46IGBgYHtkYXRldGltZS5ub3coKS5zdHJmdGltZSgnJUg6JU06JVMgLSAlZC8lbS8lWScpfWBgYCIsCiAgICAgICAgICAgICAgICAiY29sb3IiOiAzNDQ3MDAzLCAgIyBNw6B1IHhhbmgKICAgICAgICAgICAgICAgICJmaWVsZHMiOiBbXQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIFRow6ptIHRow7RuZyB0aW4gduG7gSBjw6FjIHTDoGkga2hv4bqjbgogICAgICAgICAgICBhY2NvdW50X3N0YXR1cyA9IFtdCiAgICAgICAgICAgIGVycm9yX2FjY291bnRzID0gW10KICAgICAgICAgICAgb2ZmbGluZV9hY2NvdW50cyA9IFtdCiAgICAgICAgICAgIAogICAgICAgICAgICBmb3IgcGFja2FnZV9uYW1lLCB1c2VyX2lkIGluIHNlbGYuX2FjY291bnRzOgogICAgICAgICAgICAgICAgdXNlcm5hbWUgPSBzZWxmLmdldF91c2VybmFtZSh1c2VyX2lkKSBvciB1c2VyX2lkCiAgICAgICAgICAgICAgICBpc19vbmxpbmUsIHN0YXR1c190ZXh0ID0gYXdhaXQgc2VsZi52ZXJpZnlfYWNjb3VudF9zdGF0dXModXNlcl9pZCwgcGFja2FnZV9uYW1lKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBzdGF0ZSA9IHNlbGYuY29ubmVjdGlvbl9zdGF0ZXMuZ2V0KHVzZXJfaWQsIHsKICAgICAgICAgICAgICAgICAgICAib2ZmbGluZV9jb3VudCI6IDAsCiAgICAgICAgICAgICAgICAgICAgImxhc3Rfc3RhdHVzIjogTm9uZSwKICAgICAgICAgICAgICAgICAgICAibGFzdF9jaGVja190aW1lIjogZGF0ZXRpbWUubm93KCksCiAgICAgICAgICAgICAgICAgICAgImVycm9yX2NvZGUiOiBOb25lLAogICAgICAgICAgICAgICAgICAgICJyZXRyeV9jb3VudCI6IDAKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAgICAgXywgZXJyb3JfY29kZSA9IHNlbGYuaXNfcGFja2FnZV9ydW5uaW5nKHBhY2thZ2VfbmFtZSkKICAgICAgICAgICAgICAgIHN0YXR1c19lbW9qaSA9ICLwn5+iIiBpZiBpc19vbmxpbmUgZWxzZSAi8J+UtCIKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgbm90IGlzX29ubGluZToKICAgICAgICAgICAgICAgICAgICBvZmZsaW5lX2luZm8gPSBmInt1c2VybmFtZX0gLSBPZmZsaW5lIHtzdGF0ZVsnb2ZmbGluZV9jb3VudCddfS8xNSIKICAgICAgICAgICAgICAgICAgICBvZmZsaW5lX2FjY291bnRzLmFwcGVuZChvZmZsaW5lX2luZm8pCgogICAgICAgICAgICAgICAgaWYgZXJyb3JfY29kZToKICAgICAgICAgICAgICAgICAgICBlcnJvcl9hY2NvdW50cy5hcHBlbmQoZiJ7dXNlcm5hbWV9IC0gTOG7l2kge2Vycm9yX2NvZGV9IikKCiAgICAgICAgICAgICAgICBhY2NvdW50X3N0YXR1cy5hcHBlbmQoZiJ7c3RhdHVzX2Vtb2ppfSB7dXNlcm5hbWV9OiB7c3RhdHVzX3RleHR9IikKCiAgICAgICAgICAgICMgVGjDqm0gY8OhYyB0csaw4budbmcgdsOgbyBlbWJlZAogICAgICAgICAgICBpZiBhY2NvdW50X3N0YXR1czoKICAgICAgICAgICAgICAgIGVtYmVkWyJmaWVsZHMiXS5hcHBlbmQoewogICAgICAgICAgICAgICAgICAgICJuYW1lIjogIlRy4bqhbmcgdGjDoWkgdMOgaSBraG/huqNuIiwKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiAiYGBgXG4iICsgIlxuIi5qb2luKGFjY291bnRfc3RhdHVzKSArICJcbmBgYCIsCiAgICAgICAgICAgICAgICAgICAgImlubGluZSI6IEZhbHNlCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgaWYgb2ZmbGluZV9hY2NvdW50czoKICAgICAgICAgICAgICAgIG9mZmxpbmVfbWVzc2FnZSA9ICdcbicuam9pbign8J+UtCAnICsgYWNjIGZvciBhY2MgaW4gb2ZmbGluZV9hY2NvdW50cykKICAgICAgICAgICAgICAgIG9mZmxpbmVfbWVzc2FnZSArPSAiXG5cbi0gQVBJIMSRw6MgcGjDoXQgaGnhu4duIE9mZmxpbmVcbi0gxJBhbmcga+G6v3QgbuG7kWkgbOG6oWkgdnVpIGzDsm5nIMSR4bujaVxuLSBSZWpvaW4gbuG6v3UgMTUvMTUiCiAgICAgICAgICAgICAgICBlbWJlZFsiZmllbGRzIl0uYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICJUcuG6oW5nIHRow6FpIHTDoGkga2hv4bqjbiBPZmZsaW5lIiwKICAgICAgICAgICAgICAgICAgICAidmFsdWUiOiBmImBgYFxue29mZmxpbmVfbWVzc2FnZX1cbmBgYCIsCiAgICAgICAgICAgICAgICAgICAgImlubGluZSI6IEZhbHNlCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAgICAgaWYgZXJyb3JfYWNjb3VudHM6CiAgICAgICAgICAgICAgICBlbWJlZFsiZmllbGRzIl0uYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAibmFtZSI6ICLimqDvuI8gVMOgaSBraG/huqNuIGPDsyBs4buXaSIsCiAgICAgICAgICAgICAgICAgICAgInZhbHVlIjogIlxuIi5qb2luKGVycm9yX2FjY291bnRzKSwKICAgICAgICAgICAgICAgICAgICAiaW5saW5lIjogRmFsc2UKICAgICAgICAgICAgICAgIH0pCgogICAgICAgICAgICAjIFRow6ptIHRow7RuZyB0aW4gY2FjaGUKICAgICAgICAgICAgY2FjaGVfc2l6ZSA9IGxlbihzZWxmLl9zdGF0dXNfY2FjaGUpCiAgICAgICAgICAgIGN1cnJlbnRfY2FjaGVfbWVtb3J5ID0gc3VtKGxlbihzdHIoaXRlbSkpIGZvciBpdGVtIGluIHNlbGYuX3N0YXR1c19jYWNoZS5pdGVtcygpKQogICAgICAgICAgICAKICAgICAgICAgICAgZGVmIGZvcm1hdF9zaXplKHNpemVfYnl0ZXMpOgogICAgICAgICAgICAgICAgaWYgc2l6ZV9ieXRlcyA8IDEwMjQ6CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGYie3NpemVfYnl0ZXN9QiIKICAgICAgICAgICAgICAgIGVsaWYgc2l6ZV9ieXRlcyA8IDEwMjQgKiAxMDI0OgogICAgICAgICAgICAgICAgICAgIHJldHVybiBmIntzaXplX2J5dGVzLzEwMjQ6LjJmfUtCIgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICByZXR1cm4gZiJ7c2l6ZV9ieXRlcy8oMTAyNCoxMDI0KTouMmZ9TUIiCgogICAgICAgICAgICBjYWNoZV9pbmZvID0gZiJgYGAtIEvDrWNoIHRoxrDhu5tjIGNhY2hlIGhp4buHbiB04bqhaToge2NhY2hlX3NpemV9IG3hu6VjICh7Zm9ybWF0X3NpemUoY3VycmVudF9jYWNoZV9tZW1vcnkpfSlgYGAiCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFRow6ptIHRow7RuZyB0aW4gduG7gSBs4bqnbiBk4buNbiBk4bq5cCBn4bqnbiBuaOG6pXQKICAgICAgICAgICAgbGFzdF9jbGVhbnVwX3N0YXRzID0gZ2V0YXR0cihzZWxmLCAnX2xhc3RfY2xlYW51cF9zdGF0cycsIE5vbmUpCiAgICAgICAgICAgIGlmIGxhc3RfY2xlYW51cF9zdGF0czoKICAgICAgICAgICAgICAgIHRpbWVfc2luY2VfY2xlYW51cCA9IChkYXRldGltZS5ub3coKSAtIGxhc3RfY2xlYW51cF9zdGF0c1sidGltZSJdKS50b3RhbF9zZWNvbmRzKCkgLy8gNjAKICAgICAgICAgICAgICAgIGl0ZW1zX3JlbW92ZWQgPSBsYXN0X2NsZWFudXBfc3RhdHNbIml0ZW1zX3JlbW92ZWQiXQogICAgICAgICAgICAgICAgbWVtb3J5X2ZyZWVkID0gZm9ybWF0X3NpemUobGFzdF9jbGVhbnVwX3N0YXRzWyJtZW1vcnlfZnJlZWQiXSkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY2FjaGVfaW5mbyArPSBmImBgYFxuLSBM4bqnbiB4w7NhIGfhuqduIG5o4bqldCAoe3RpbWVfc2luY2VfY2xlYW51cH0gcGjDunQgdHLGsOG7m2MpOiIKICAgICAgICAgICAgICAgIGNhY2hlX2luZm8gKz0gZiJcbi0gxJDDoyB4w7NhIHRvw6BuIGLhu5kge2l0ZW1zX3JlbW92ZWR9IG3hu6VjIgogICAgICAgICAgICAgICAgY2FjaGVfaW5mbyArPSBmIlxuLSBHaeG6o2kgcGjDs25nIHttZW1vcnlfZnJlZWR9YGBgIgoKICAgICAgICAgICAgZW1iZWRbImZpZWxkcyJdLmFwcGVuZCh7CiAgICAgICAgICAgICAgICAibmFtZSI6ICJUaMO0bmcgdGluIGNhY2hlIiwKICAgICAgICAgICAgICAgICJ2YWx1ZSI6IGNhY2hlX2luZm8sCiAgICAgICAgICAgICAgICAiaW5saW5lIjogRmFsc2UKICAgICAgICAgICAgfSkKCiAgICAgICAgICAgICMgR+G7rWkgZW1iZWQgcXVhIHdlYmhvb2sKICAgICAgICAgICAgYXdhaXQgc2VsZi5zZW5kX3dlYmhvb2tfbWVzc2FnZSh3ZWJob29rX3VybCwgZW1iZWRzPVtlbWJlZF0pCgogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGfhu61pIGLDoW8gY8OhbyB3ZWJob29rOiB7ZX0iKQogICAgICAgICAgICBwcmludChmIntGb3JlLlJFRH1be2RhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCclSDolTTolUycpfV0gTOG7l2kga2hpIGfhu61pIGLDoW8gY8OhbyB3ZWJob29rOiB7ZX17U3R5bGUuUkVTRVRfQUxMfSIpCgogICAgYXN5bmMgZGVmIF9jaGVja191c2VyX29ubGluZV9hcGkoc2VsZiwgdXNlcl9pZDogc3RyKSAtPiBPcHRpb25hbFtpbnRdOgogICAgICAgIG1heF9yZXRyaWVzID0gMwogICAgICAgIHJldHJ5X2RlbGF5ID0gMiAgIyBzZWNvbmRzCiAgICAgICAgCiAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UobWF4X3JldHJpZXMpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICB1cmwgPSAiaHR0cHM6Ly9wcmVzZW5jZS5yb2Jsb3guY29tL3YxL3ByZXNlbmNlL3VzZXJzIgogICAgICAgICAgICAgICAgaGVhZGVycyA9IHsKICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAogICAgICAgICAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ1JvYmxveC8xLjAnCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBib2R5ID0ganNvbi5kdW1wcyh7InVzZXJJZHMiOiBbaW50KHVzZXJfaWQpXX0pCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggYWlvaHR0cC5DbGllbnRTZXNzaW9uKCkgYXMgc2Vzc2lvbjoKICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgIGFzeW5jIHdpdGggc2Vzc2lvbi5wb3N0KHVybCwgaGVhZGVycz1oZWFkZXJzLCBkYXRhPWJvZHksIHRpbWVvdXQ9MTApIGFzIHJlc3BvbnNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzcG9uc2Uuc3RhdHVzID09IDIwMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgInVzZXJQcmVzZW5jZXMiIGluIGRhdGEgYW5kIGRhdGFbInVzZXJQcmVzZW5jZXMiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGFbInVzZXJQcmVzZW5jZXMiXVswXVsidXNlclByZXNlbmNlVHlwZSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJBUEkgcmVzcG9uc2UgZm9yIHVzZXIge3VzZXJfaWR9IG1pc3NpbmcgdXNlclByZXNlbmNlcyBkYXRhOiB7ZGF0YX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiByZXNwb25zZS5zdGF0dXMgPT0gNDI5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGYiUmF0ZSBsaW1pdCBoaXQgd2hlbiBjaGVja2luZyB1c2VyIHt1c2VyX2lkfS4gUmV0cnlpbmcgYWZ0ZXIgZGVsYXkuIikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKHJldHJ5X2RlbGF5ICogMikgICMgTG9uZ2VyIGRlbGF5IGZvciByYXRlIGxpbWl0cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkFQSSBlcnJvciBmb3IgdXNlciB7dXNlcl9pZH06IFN0YXR1cyB7cmVzcG9uc2Uuc3RhdHVzfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIE7hur91IGtow7RuZyB0aMOgbmggY8O0bmcsIHRo4butIGzhuqFpIHNhdSBkZWxheQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9yZXRyaWVzIC0gMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKHJldHJ5X2RlbGF5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IGFpb2h0dHAuQ2xpZW50RXJyb3IgYXMgY2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiQ29ubmVjdGlvbiBlcnJvciB3aGVuIGNoZWNraW5nIHVzZXIge3VzZXJfaWR9OiB7Y2V9IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X3JldHJpZXMgLSAxOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKHJldHJ5X2RlbGF5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBhc3luY2lvLlRpbWVvdXRFcnJvcjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJUaW1lb3V0IHdoZW4gY2hlY2tpbmcgdXNlciB7dXNlcl9pZH0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCBtYXhfcmV0cmllcyAtIDE6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAocmV0cnlfZGVsYXkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3IgYXMgdmU6CiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJWYWx1ZSBlcnJvciBmb3IgdXNlciB7dXNlcl9pZH06IHt2ZX0iKQogICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9yZXRyaWVzIC0gMToKICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKHJldHJ5X2RlbGF5KQogICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiVW5leHBlY3RlZCBlcnJvciBjaGVja2luZyBvbmxpbmUgc3RhdHVzIGZvciB1c2VyIHt1c2VyX2lkfToge2V9IikKICAgICAgICAgICAgICAgIGlmIGF0dGVtcHQgPCBtYXhfcmV0cmllcyAtIDE6CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcChyZXRyeV9kZWxheSkKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgCiAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJGYWlsZWQgdG8gY2hlY2sgb25saW5lIHN0YXR1cyBmb3IgdXNlciB7dXNlcl9pZH0gYWZ0ZXIge21heF9yZXRyaWVzfSBhdHRlbXB0cyIpCiAgICAgICAgcmV0dXJuIE5vbmUKICAgIGFzeW5jIGRlZiBjaGVja191c2Vyc19vbmxpbmUoc2VsZiwgdXNlcl9pZHM6IExpc3Rbc3RyXSkgLT4gRGljdFtzdHIsIE9wdGlvbmFsW2ludF1dOgogICAgICAgICIiIktp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBvbmxpbmUgY+G7p2Egbmhp4buBdSBuZ8aw4budaSBkw7luZyB24bubaSBjYWNoZS4iIiIKICAgICAgICBjdXJyZW50X3RpbWUgPSBkYXRldGltZS5ub3coKQogICAgICAgIHJlc3VsdHMgPSB7fQogICAgICAgIHVuY2FjaGVkX2lkcyA9IFtdCiAgICAgICAgCiAgICAgICAgIyBLaeG7g20gdHJhIGNhY2hlIHRyxrDhu5tjCiAgICAgICAgZm9yIHVzZXJfaWQgaW4gdXNlcl9pZHM6CiAgICAgICAgICAgIGlmIHVzZXJfaWQgaW4gc2VsZi5fc3RhdHVzX2NhY2hlOgogICAgICAgICAgICAgICAgbGFzdF9zdGF0dXMsIGxhc3RfY2hlY2tfdGltZSA9IHNlbGYuX3N0YXR1c19jYWNoZVt1c2VyX2lkXQogICAgICAgICAgICAgICAgIyBO4bq/dSBraeG7g20gdHJhIGfhuqduIMSRw6J5ICh0cm9uZyB2w7JuZyAzMCBnacOieSksIHPhu60gZOG7pW5nIGvhur90IHF14bqjIGNhY2hlCiAgICAgICAgICAgICAgICBpZiAoY3VycmVudF90aW1lIC0gbGFzdF9jaGVja190aW1lKS50b3RhbF9zZWNvbmRzKCkgPCAzMDoKICAgICAgICAgICAgICAgICAgICByZXN1bHRzW3VzZXJfaWRdID0gbGFzdF9zdGF0dXMKICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICB1bmNhY2hlZF9pZHMuYXBwZW5kKHVzZXJfaWQpCiAgICAgICAgCiAgICAgICAgIyBO4bq/dSBjw7MgSUQgY+G6p24ga2nhu4NtIHRyYSBt4bubaSwgZ+G7jWkgQVBJCiAgICAgICAgaWYgdW5jYWNoZWRfaWRzOgogICAgICAgICAgICBhcGlfcmVzdWx0cyA9IGF3YWl0IHNlbGYuX2NoZWNrX211bHRpcGxlX3VzZXJzX29ubGluZSh1bmNhY2hlZF9pZHMpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIEPhuq1wIG5o4bqtdCBjYWNoZSB2w6Aga+G6v3QgcXXhuqMKICAgICAgICAgICAgZm9yIHVzZXJfaWQsIHN0YXR1cyBpbiBhcGlfcmVzdWx0cy5pdGVtcygpOgogICAgICAgICAgICAgICAgaWYgc3RhdHVzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX3N0YXR1c19jYWNoZVt1c2VyX2lkXSA9IChzdGF0dXMsIGN1cnJlbnRfdGltZSkKICAgICAgICAgICAgICAgIHJlc3VsdHNbdXNlcl9pZF0gPSBzdGF0dXMKICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgCiAgICBhc3luYyBkZWYgY2hlY2tfdXNlcl9vbmxpbmUoc2VsZiwgdXNlcl9pZDogc3RyKSAtPiBPcHRpb25hbFtpbnRdOgogICAgICAgICIiIktp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBvbmxpbmUgY+G7p2EgbeG7mXQgbmfGsOG7nWkgZMO5bmcuIiIiCiAgICAgICAgcmVzdWx0cyA9IGF3YWl0IHNlbGYuY2hlY2tfdXNlcnNfb25saW5lKFt1c2VyX2lkXSkKICAgICAgICByZXR1cm4gcmVzdWx0cy5nZXQodXNlcl9pZCkKICAgIGFzeW5jIGRlZiBfY2hlY2tfbXVsdGlwbGVfdXNlcnNfb25saW5lKHNlbGYsIHVzZXJfaWRzOiBMaXN0W3N0cl0pIC0+IERpY3Rbc3RyLCBPcHRpb25hbFtpbnRdXToKICAgICAgICAiIiJLaeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgb25saW5lIGPhu6dhIG5oaeG7gXUgbmfGsOG7nWkgZMO5bmcgdHJvbmcgbeG7mXQgbOG6p24gZ+G7jWkgQVBJLiIiIgogICAgICAgIGlmIG5vdCB1c2VyX2lkczoKICAgICAgICAgICAgcmV0dXJuIHt9CiAgICAgICAgCiAgICAgICAgbWF4X3JldHJpZXMgPSAzCiAgICAgICAgcmV0cnlfZGVsYXkgPSAyICAjIHNlY29uZHMKICAgICAgICByZXN1bHRzID0ge3VzZXJfaWQ6IE5vbmUgZm9yIHVzZXJfaWQgaW4gdXNlcl9pZHN9CiAgICAgICAgCiAgICAgICAgIyBHaeG7m2kgaOG6oW4gc+G7kSBsxrDhu6NuZyB1c2VyX2lkcyB0cm9uZyBt4buZdCByZXF1ZXN0IChSb2Jsb3ggQVBJIGdp4bubaSBo4bqhbiAxMDAgSURzIG3hu5dpIHJlcXVlc3QpCiAgICAgICAgYmF0Y2hfc2l6ZSA9IDEwMAogICAgICAgICMgVGjDqm0gdGltZW91dCBuZ+G6r24gaMahbiDEkeG7gyB0csOhbmggdHJlbwogICAgICAgIHRpbWVvdXQgPSBhaW9odHRwLkNsaWVudFRpbWVvdXQodG90YWw9MTApCiAgICAgICAgZm9yIGF0dGVtcHQgaW4gcmFuZ2UobWF4X3JldHJpZXMpOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAjIFjhu60gbMO9IHRoZW8gYmF0Y2ggxJHhu4MgdHLDoW5oIHbGsOG7o3QgcXXDoSBnaeG7m2kgaOG6oW4gQVBJCiAgICAgICAgICAgICAgICBmb3IgaSBpbiByYW5nZSgwLCBsZW4odXNlcl9pZHMpLCBiYXRjaF9zaXplKToKICAgICAgICAgICAgICAgICAgICBiYXRjaF9pZHMgPSB1c2VyX2lkc1tpOmkrYmF0Y2hfc2l6ZV0KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIENodXnhu4NuIMSR4buVaSBzdHJpbmcgSURzIHNhbmcgaW50ZWdlciBJRHMgY2hvIEFQSQogICAgICAgICAgICAgICAgICAgIGludF91c2VyX2lkcyA9IFtpbnQodWlkKSBmb3IgdWlkIGluIGJhdGNoX2lkc10KICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICB1cmwgPSAiaHR0cHM6Ly9wcmVzZW5jZS5yb2Jsb3guY29tL3YxL3ByZXNlbmNlL3VzZXJzIgogICAgICAgICAgICAgICAgICAgIGhlYWRlcnMgPSB7CiAgICAgICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgICAgICAgICAgICAgICdVc2VyLUFnZW50JzogJ1JvYmxveC8xLjAnCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIGJvZHkgPSBqc29uLmR1bXBzKHsidXNlcklkcyI6IGludF91c2VyX2lkc30pCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgYXN5bmMgd2l0aCBhaW9odHRwLkNsaWVudFNlc3Npb24odGltZW91dD10aW1lb3V0KSBhcyBzZXNzaW9uOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhc3luYyB3aXRoIHNlc3Npb24ucG9zdCh1cmwsIGhlYWRlcnM9aGVhZGVycywgZGF0YT1ib2R5KSBhcyByZXNwb25zZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiByZXNwb25zZS5zdGF0dXMgPT0gMjAwOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICJ1c2VyUHJlc2VuY2VzIiBpbiBkYXRhOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIHByZXNlbmNlIGluIGRhdGFbInVzZXJQcmVzZW5jZXMiXToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2lkID0gc3RyKHByZXNlbmNlWyJ1c2VySWQiXSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzW3VzZXJfaWRdID0gcHJlc2VuY2VbInVzZXJQcmVzZW5jZVR5cGUiXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZiJBUEkgcmVzcG9uc2UgbWlzc2luZyB1c2VyUHJlc2VuY2VzIGRhdGE6IHtkYXRhfSIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiByZXNwb25zZS5zdGF0dXMgPT0gNDI5OgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmIlJhdGUgbGltaXQgaGl0IHdoZW4gY2hlY2tpbmcgdXNlcnMuIFJldHJ5aW5nIGFmdGVyIGRlbGF5LiIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAocmV0cnlfZGVsYXkgKiAyKSAgIyBMb25nZXIgZGVsYXkgZm9yIHJhdGUgbGltaXRzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrICAjIEJyZWFrIGlubmVyIGxvb3AgdG8gcmV0cnkgdGhlIHdob2xlIGJhdGNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiQVBJIGVycm9yOiBTdGF0dXMge3Jlc3BvbnNlLnN0YXR1c30iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBO4bq/dSBraMO0bmcgdGjDoG5oIGPDtG5nLCB0aOG7rSBs4bqhaSBzYXUgZGVsYXkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9yZXRyaWVzIC0gMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAocmV0cnlfZGVsYXkpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhayAgIyBCcmVhayBpbm5lciBsb29wIHRvIHJldHJ5IHRoZSB3aG9sZSBiYXRjaAogICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQgKGFpb2h0dHAuQ2xpZW50RXJyb3IsIGFzeW5jaW8uVGltZW91dEVycm9yKSBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiQ29ubmVjdGlvbiBlcnJvciB3aGVuIGNoZWNraW5nIHVzZXJzOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdCA8IG1heF9yZXRyaWVzIC0gMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKHJldHJ5X2RlbGF5KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrICAjIEJyZWFrIGlubmVyIGxvb3AgdG8gcmV0cnkgdGhlIHdob2xlIGJhdGNoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgTuG6v3UgxJHDoyB44butIGzDvSB04bqldCBj4bqjIGPDoWMgYmF0Y2ggbcOgIGtow7RuZyBn4bq3cCBs4buXaSwgdGhvw6F0IGto4buPaSB2w7JuZyBs4bq3cCByZXRyeQogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIlVuZXhwZWN0ZWQgZXJyb3IgY2hlY2tpbmcgb25saW5lIHN0YXR1cyBmb3IgbXVsdGlwbGUgdXNlcnM6IHtlfSIpCiAgICAgICAgICAgICAgICBpZiBhdHRlbXB0IDwgbWF4X3JldHJpZXMgLSAxOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAocmV0cnlfZGVsYXkpCiAgICAgICAgICAgICAgICAgICAgY29udGludWUKICAgICAgICAKICAgICAgICAjIExvZyBr4bq/dCBxdeG6owogICAgICAgIG9ubGluZV9jb3VudCA9IHN1bSgxIGZvciBzdGF0dXMgaW4gcmVzdWx0cy52YWx1ZXMoKSBpZiBzdGF0dXMgPT0gMikgICMgMiA9IE9ubGluZSBpbiBSb2Jsb3ggQVBJCiAgICAgICAgbG9nZ2VyLmluZm8oZiJDaGVja2VkIHtsZW4odXNlcl9pZHMpfSB1c2Vyczoge29ubGluZV9jb3VudH0gb25saW5lLCB7bGVuKHVzZXJfaWRzKSAtIG9ubGluZV9jb3VudH0gb2ZmbGluZS91bmtub3duIikKICAgICAgICAKICAgICAgICByZXR1cm4gcmVzdWx0cwogICAgYXN5bmMgZGVmIHZlcmlmeV9zdGF0dXMoc2VsZiwgdXNlcl9pZDogc3RyLCBwYWNrYWdlX25hbWU6IHN0cikgLT4gYm9vbDoKICAgICMgS2nhu4NtIHRyYSBj4bqjIEFQSSB2w6AgcGFja2FnZSBzdGF0dXMKICAgICAgICBvbmxpbmVfc3RhdHVzID0gYXdhaXQgc2VsZi5jaGVja191c2VyX29ubGluZSh1c2VyX2lkKQogICAgICAgIHBhY2thZ2VfcnVubmluZywgXyA9IHNlbGYuaXNfcGFja2FnZV9ydW5uaW5nKHBhY2thZ2VfbmFtZSkKICAgICAgICAKICAgICAgICAjIENo4buJIGNvaSBsw6Agb2ZmbGluZSBu4bq/dSBj4bqjIGhhaSDEkWnhu4F1IGtp4buHbiDEkeG7gXUgZmFsc2UKICAgICAgICByZXR1cm4gbm90IChvbmxpbmVfc3RhdHVzID09IDAgYW5kIG5vdCBwYWNrYWdlX3J1bm5pbmcpCiAgICBhc3luYyBkZWYgdmVyaWZ5X2FjY291bnRfc3RhdHVzKHNlbGYsIHVzZXJfaWQ6IHN0ciwgcGFja2FnZV9uYW1lOiBzdHIpIC0+IHR1cGxlW2Jvb2wsIHN0cl06CiAgICAgICAgdHJ5OgogICAgICAgICAgICAjIEtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBvbmxpbmUgdOG7qyBBUEkKICAgICAgICAgICAgc3RhdHVzID0gYXdhaXQgc2VsZi5jaGVja191c2VyX29ubGluZSh1c2VyX2lkKQogICAgICAgICAgICAjIEtp4buDbSB0cmEgcGFja2FnZSBjw7MgxJFhbmcgY2jhuqF5IGtow7RuZwogICAgICAgICAgICBwYWNrYWdlX3J1bm5pbmcsIGVycm9yX2NvZGUgPSBzZWxmLmlzX3BhY2thZ2VfcnVubmluZyhwYWNrYWdlX25hbWUpCiAgICAgICAgICAgIAogICAgICAgICAgICAjIFjDoWMgxJHhu4tuaCB0cuG6oW5nIHRow6FpCiAgICAgICAgICAgIGlmIHN0YXR1cyBpcyBOb25lOgogICAgICAgICAgICAgICAgc3RhdHVzX3RleHQgPSAiQVBJIGtow7RuZyBwaOG6o24gaOG7k2kiCiAgICAgICAgICAgICAgICByZXR1cm4gcGFja2FnZV9ydW5uaW5nLCBzdGF0dXNfdGV4dAogICAgICAgICAgICBlbGlmIHN0YXR1cyA9PSAwIG9yIG5vdCBwYWNrYWdlX3J1bm5pbmc6ICAjIE7hur91IEFQSSB0cuG6oyB24buBIG9mZmxpbmUgaG/hurdjIHBhY2thZ2Uga2jDtG5nIGNo4bqheQogICAgICAgICAgICAgICAgc3RhdHVzX3RleHQgPSAiT2ZmbGluZSIKICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZSwgc3RhdHVzX3RleHQKICAgICAgICAgICAgZWxpZiBzdGF0dXMgPT0gMToKICAgICAgICAgICAgICAgIHN0YXR1c190ZXh0ID0gIlRyb25nIHPhuqNuaCIKICAgICAgICAgICAgZWxpZiBzdGF0dXMgPT0gMjoKICAgICAgICAgICAgICAgIHN0YXR1c190ZXh0ID0gIsSQYW5nIGNoxqFpIgogICAgICAgICAgICBlbGlmIHN0YXR1cyA9PSAzOgogICAgICAgICAgICAgICAgc3RhdHVzX3RleHQgPSAiU3R1ZGlvIgogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgc3RhdHVzX3RleHQgPSAiS2jDtG5nIHjDoWMgxJHhu4tuaCIKICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBUcnVlLCBzdGF0dXNfdGV4dAogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiTOG7l2kga2hpIGtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSB0w6BpIGtob+G6o24ge3VzZXJfaWR9OiB7ZX0iKQogICAgICAgICAgICByZXR1cm4gRmFsc2UsICJM4buXaSBraeG7g20gdHJhIgoKICAgIGFzeW5jIGRlZiBydW5fbWVudShzZWxmKToKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICBwcmludF9oZWFkZXIoKQogICAgICAgICAgICAgICAgbWVudSA9IGYiIiIKe0ZvcmUuQ1lBTn3ilZTilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgTUVOVSBDSMONTkgg4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWXCuKVkSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZEK4pWRICB7Rm9yZS5ZRUxMT1d9WzFdIEF1dG8gUmVqb2luIFJvYmxveCBHYW1le0ZvcmUuQ1lBTn0gICAgIOKVkQrilZEgIHtGb3JlLllFTExPV31bMl0gQ8OgaSDEkeG6t3QgU2VydmVyL0dhbWUgSUR7Rm9yZS5DWUFOfSAgICAgIOKVkQrilZEgIHtGb3JlLllFTExPV31bM10gWMOzYSBVc2VyIElEICYgU2VydmVyIExpbmt7Rm9yZS5DWUFOfSAgIOKVkQrilZEgIHtGb3JlLllFTExPV31bNF0gWGVtIERhbmggU8OhY2h7Rm9yZS5DWUFOfSAgICAgICAgICAgICAgIOKVkQrilZEgIHtGb3JlLllFTExPV31bNV0gVOG7sSDEkeG7mW5nIGPDoGkgVXNlciBJRHtGb3JlLkNZQU59ICAgICAgICAg4pWRCuKVkSAge0ZvcmUuWUVMTE9XfVs2XSBDaOG6vyDEkeG7mSBDaGVjayB2w6AgeMOzYSBjYWNoZXtGb3JlLkNZQU59ICAg4pWRCuKVkSAge0ZvcmUuWUVMTE9XfVs3XSBDw6BpIMSR4bq3dCBXZWJob29rICAgIHtGb3JlLkNZQU59ICAgICAgICAg4pWRCuKVkSAge0ZvcmUuWUVMTE9XfVs4XSDEkMSDbmcgbmjhuq1wIGLhurFuZyBDb29raWV7Rm9yZS5DWUFOfSAgICAgICDilZEK4pWRICB7Rm9yZS5ZRUxMT1d9WzldIEzhuqV5IENvb2tpZSB04burIFBhY2thZ2V7Rm9yZS5DWUFOfSAgICAgICDilZEK4pWRICB7Rm9yZS5SRUR9WzBdIFRob8OhdHtGb3JlLkNZQU59ICAgICAgICAgICAgICAgICAgICAgICDilZEK4pWRICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKVkSAgCuKVmuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVnXtTdHlsZS5SRVNFVF9BTEx9CiAgICAgICAgICAgICAgICAiIiIKICAgICAgICAgICAgICAgIHByaW50KG1lbnUpCiAgICAgICAgICAgICAgICAjIFPhu60gZOG7pW5nIGFzeW5jaW8ucnVuX2luX2V4ZWN1dG9yIMSR4buDIGtow7RuZyBjaOG6t24gZXZlbnQgbG9vcAogICAgICAgICAgICAgICAgbG9vcCA9IGFzeW5jaW8uZ2V0X2V2ZW50X2xvb3AoKQogICAgICAgICAgICAgICAgc2V0dXBfdHlwZSA9IGF3YWl0IGxvb3AucnVuX2luX2V4ZWN1dG9yKE5vbmUsIGxhbWJkYTogaW5wdXQoZiJ7Rm9yZS5DWUFOfeKWuiBOaOG6rXAgbOG7sWEgY2jhu41uIGPhu6dhIGLhuqFuICgwLTkpOiB7U3R5bGUuUkVTRVRfQUxMfSIpKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFBo4bqnbiBjw7JuIGzhuqFpIGPhu6dhIGNvZGUuLi4KICAgICAgICAgICAgICAgICMgxJDhu5FpIHbhu5tpIGPDoWMgaW5wdXQga2jDoWMgdHJvbmcgaMOgbSBuw6B5LCBjxaluZyBj4bqnbiB0aGF5IMSR4buVaSB0xrDGoW5nIHThu7EKICAgICAgICAgICAgICAgIGlmIHNldHVwX3R5cGUgPT0gIjEiOgogICAgICAgICAgICAgICAgICAgIHNlbGYuX2FjY291bnRzID0gc2VsZi5sb2FkX2FjY291bnRzKCkKICAgICAgICAgICAgICAgICAgICBzZWxmLl9zZXJ2ZXJfbGlua3MgPSBzZWxmLmxvYWRfc2VydmVyX2xpbmtzKCkKCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArICJLaMO0bmcgdMOsbSB0aOG6pXkgVXNlciBJRCwgdnVpIGzDsm5nIHRo4butIGzhuqFpIHNhdS4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIGVsaWYgbm90IHNlbGYuX3NlcnZlcl9saW5rczoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyAiS2jDtG5nIHTDrG0gdGjhuqV5IElEIEdhbWUgaG/hurdjIExpw6puIGvhur90IFNlcnZlciBSacOqbmcsIHZ1aSBsw7JuZyB0aOG7rSBs4bqhaSBzYXUuIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgICAgICAgICAgICAgcmVzdGFydF90aW1lX2lucHV0ID0gaW5wdXQoRm9yZS5DWUFOICsgIk5o4bqtcCB0aOG7nWkgZ2lhbiBraOG7n2kgxJHhu5luZyBs4bqhaSB04bqldCBj4bqjIFJvYmxveCBnYW1lICh0w61uaCBi4bqxbmcgcGjDunQpIGhv4bq3YyBuaOG6pW4gcSDEkeG7gyBi4buPIHF1YTogIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICByZXN0YXJ0X21pbnV0ZXMgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgaWYgcmVzdGFydF90aW1lX2lucHV0Lmxvd2VyKCkgIT0gJ3EnOgogICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN0YXJ0X21pbnV0ZXMgPSBpbnQocmVzdGFydF90aW1lX2lucHV0KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcmVzdGFydF9taW51dGVzIDw9IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAiVGjhu51pIGdpYW4gcGjhuqNpIGzhu5tuIGjGoW4gMCwgxJHDoyBi4buPIHF1YSB0w61uaCBuxINuZyBraOG7n2kgxJHhu5luZyBs4bqhaSB04buxIMSR4buZbmcuIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN0YXJ0X21pbnV0ZXMgPSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyBmIsSQw6MgxJHhurd0IHRo4budaSBnaWFuIGto4bufaSDEkeG7mW5nIGzhuqFpOiB7cmVzdGFydF9taW51dGVzfSBwaMO6dCIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAiR2nDoSB0cuG7iyBraMO0bmcgaOG7o3AgbOG7hywgxJHDoyBi4buPIHF1YSB0w61uaCBuxINuZyBraOG7n2kgxJHhu5luZyBs4bqhaSB04buxIMSR4buZbmcuIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3RhcnRfbWludXRlcyA9IE5vbmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgSGnhu4NuIHRo4buLIGRhbmggc8OhY2ggcGFja2FnZSB2w6AgY2hvIHBow6lwIG5nxrDhu51pIGTDuW5nIGNo4buNbiAgICAgICAKICAgICAgICAgICAgICAgICAgICBhdmFpbGFibGVfcGFja2FnZXMgPSBbcGFja2FnZSBmb3IgcGFja2FnZSwgXyBpbiBzZWxmLl9hY2NvdW50c10KICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9wYWNrYWdlcyA9IFtdCgogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArICJcbkRhbmggc8OhY2ggcGFja2FnZSBjw7Mgc+G6tW46IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICBmb3IgaSwgcGFja2FnZSBpbiBlbnVtZXJhdGUoYXZhaWxhYmxlX3BhY2thZ2VzLCAxKToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJ7aX0uIHtwYWNrYWdlfSIpCgogICAgICAgICAgICAgICAgICAgIHBhY2thZ2VfY2hvaWNlID0gaW5wdXQoRm9yZS5ZRUxMT1cgKyAiXG5OaOG6rXAgc+G7kSB0aOG7qSB04buxIGPDoWMgcGFja2FnZSBtdeG7kW4gbeG7nyAoY8OhY2ggbmhhdSBi4bufaSBk4bqldSBwaOG6qXkpIGhv4bq3YyBuaOG6pW4gcSDEkeG7gyBt4bufIHThuqV0IGPhuqM6ICIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgaWYgcGFja2FnZV9jaG9pY2UubG93ZXIoKSA9PSAncSc6CiAgICAgICAgICAgICAgICAgICAgICAgICMgTeG7nyB04bqldCBj4bqjIHBhY2thZ2UKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRfcGFja2FnZXMgPSBhdmFpbGFibGVfcGFja2FnZXMKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkMOjIGNo4buNbiBt4bufIHThuqV0IGPhuqMgcGFja2FnZS4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgWOG7rSBsw70gaW5wdXQgY+G7p2EgbmfGsOG7nWkgZMO5bmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkX2luZGljZXMgPSBbaW50KGlkeC5zdHJpcCgpKSAtIDEgZm9yIGlkeCBpbiBwYWNrYWdlX2Nob2ljZS5zcGxpdCgnLCcpIGlmIGlkeC5zdHJpcCgpXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGlkeCBpbiBzZWxlY3RlZF9pbmRpY2VzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIDAgPD0gaWR4IDwgbGVuKGF2YWlsYWJsZV9wYWNrYWdlcyk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGVjdGVkX3BhY2thZ2VzLmFwcGVuZChhdmFpbGFibGVfcGFja2FnZXNbaWR4XSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGVjdGVkX3BhY2thZ2VzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIktow7RuZyBjw7MgcGFja2FnZSBuw6BvIMSRxrDhu6NjIGNo4buNbiwgbeG7nyB04bqldCBj4bqjIHBhY2thZ2UuIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9wYWNrYWdlcyA9IGF2YWlsYWJsZV9wYWNrYWdlcwogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgZiLEkMOjIGNo4buNbiB7bGVuKHNlbGVjdGVkX3BhY2thZ2VzKX0gcGFja2FnZTogeycsICcuam9pbihzZWxlY3RlZF9wYWNrYWdlcyl9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3I6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArICJM4buxYSBjaOG7jW4ga2jDtG5nIGjhu6NwIGzhu4csIG3hu58gdOG6pXQgY+G6oyBwYWNrYWdlLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZF9wYWNrYWdlcyA9IGF2YWlsYWJsZV9wYWNrYWdlcwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgTOG7jWMgYWNjb3VudHMgdsOgIHNlcnZlcl9saW5rcyB0aGVvIHBhY2thZ2UgxJHDoyBjaOG7jW4KICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZF9hY2NvdW50cyA9IFsocGFja2FnZSwgdXNlcl9pZCkgZm9yIHBhY2thZ2UsIHVzZXJfaWQgaW4gc2VsZi5fYWNjb3VudHMgaWYgcGFja2FnZSBpbiBzZWxlY3RlZF9wYWNrYWdlc10KICAgICAgICAgICAgICAgICAgICBmaWx0ZXJlZF9zZXJ2ZXJfbGlua3MgPSBbKHBhY2thZ2UsIGxpbmspIGZvciBwYWNrYWdlLCBsaW5rIGluIHNlbGYuX3NlcnZlcl9saW5rcyBpZiBwYWNrYWdlIGluIHNlbGVjdGVkX3BhY2thZ2VzXQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgQ+G6rXAgbmjhuq10IGzhuqFpIGFjY291bnRzIHbDoCBzZXJ2ZXJfbGlua3MgY2hvIHBoacOqbiBsw6BtIHZp4buHYyBuw6B5CiAgICAgICAgICAgICAgICAgICAgc2VsZi5fYWNjb3VudHMgPSBmaWx0ZXJlZF9hY2NvdW50cwogICAgICAgICAgICAgICAgICAgIHNlbGYuX3NlcnZlcl9saW5rcyA9IGZpbHRlcmVkX3NlcnZlcl9saW5rcwoKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLnN0YXJ0X2F1dG9fcmVqb2luKHJlc3RhcnRfbWludXRlcykKCiAgICAgICAgICAgICAgICBlbGlmIHNldHVwX3R5cGUgPT0gIjIiOgogICAgICAgICAgICAgICAgICAgIHBhY2thZ2VzID0gc2VsZi5nZXRfcm9ibG94X3BhY2thZ2VzKCkKICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJfbGlua3MgPSBbXQogICAgICAgICAgICAgICAgICAgIGZvciBwYWNrYWdlX25hbWUgaW4gcGFja2FnZXM6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgZiJDaOG7jW4gZ2FtZSBjaG8ge3BhY2thZ2VfbmFtZX06IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRfZ2FtZSA9IGdldF9nYW1lX3NlbGVjdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZF9saW5rID0gZm9ybWF0X3NlcnZlcl9saW5rKHNlbGVjdGVkX2dhbWUpIGlmIHNlbGVjdGVkX2dhbWUgZWxzZSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvcm1hdHRlZF9saW5rOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyX2xpbmtzLmFwcGVuZCgocGFja2FnZV9uYW1lLCBmb3JtYXR0ZWRfbGluaykpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5zYXZlX3NlcnZlcl9saW5rcyhzZXJ2ZXJfbGlua3MpCgogICAgICAgICAgICAgICAgZWxpZiBzZXR1cF90eXBlID09ICIzIjoKICAgICAgICAgICAgICAgICAgICBjbGVhcl9jaG9pY2UgPSBpbnB1dChGb3JlLllFTExPVyArICIiIuKVlOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkCBYw5NBIEThu64gTEnhu4ZVIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVlwrilZEgMS4gWMOzYSBVc2VyIElEICAgICAgICAgICAgICAg4pWRCuKVkSAyLiBYw7NhIExpw6puIGvhur90IFNlcnZlciBSacOqbmcg4pWRIArilZEgMy4gWMOzYSBj4bqjIGhhaSAgICAgICAgICAgICAgICDilZEK4pWRIDQuIFjDs2EgUGFja2FnZSBQYXRoICAgICAgICAgIOKVkQrilZEgNS4gWMOzYSB04bqldCBj4bqjIGThu68gbGnhu4d1ICAgICAgICDilZEK4pWa4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWdCuKWuk5o4bqtcCBs4buxYSBjaOG7jW4gKDEtNSk6ICIiIiArIFN0eWxlLlJFU0VUX0FMTCkKCiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBpZiBjbGVhcl9jaG9pY2UgPT0gIjEiIGFuZCBvcy5wYXRoLmV4aXN0cyhDb25maWcuQUNDT1VOVFNfRklMRSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoQ29uZmlnLkFDQ09VTlRTX0ZJTEUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgIsSQw6MgeMOzYSBVc2VyIElELiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgY2xlYXJfY2hvaWNlID09ICIyIiBhbmQgb3MucGF0aC5leGlzdHMoQ29uZmlnLlNFUlZFUl9MSU5LU19GSUxFKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZShDb25maWcuU0VSVkVSX0xJTktTX0ZJTEUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgIsSQw6MgeMOzYSBMacOqbiBr4bq/dCBTZXJ2ZXIgUmnDqm5nLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgY2xlYXJfY2hvaWNlID09ICIzIjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9zLnBhdGguZXhpc3RzKENvbmZpZy5BQ0NPVU5UU19GSUxFKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoQ29uZmlnLkFDQ09VTlRTX0ZJTEUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhDb25maWcuU0VSVkVSX0xJTktTX0ZJTEUpOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9zLnJlbW92ZShDb25maWcuU0VSVkVSX0xJTktTX0ZJTEUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgIsSQw6MgeMOzYSBVc2VyIElEIHbDoCBMacOqbiBr4bq/dCBTZXJ2ZXIgUmnDqm5nLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgY2xlYXJfY2hvaWNlID09ICI0IiBhbmQgb3MucGF0aC5leGlzdHMoQ29uZmlnLlBBQ0tBR0VfRklMRSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoQ29uZmlnLlBBQ0tBR0VfRklMRSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyAixJDDoyB4w7NhIFBhY2thZ2UgUGF0aC4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIGNsZWFyX2Nob2ljZSA9PSAiNSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBvcy5wYXRoLmV4aXN0cyhDb25maWcuQUNDT1VOVFNfRklMRSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKENvbmZpZy5BQ0NPVU5UU19GSUxFKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoQ29uZmlnLlNFUlZFUl9MSU5LU19GSUxFKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUoQ29uZmlnLlNFUlZFUl9MSU5LU19GSUxFKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb3MucGF0aC5leGlzdHMoQ29uZmlnLlBBQ0tBR0VfRklMRSk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3MucmVtb3ZlKENvbmZpZy5QQUNLQUdFX0ZJTEUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgIsSQw6MgeMOzYSB04bqldCBj4bqjIGThu68gbGnhu4d1LiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArIGYiTOG7l2kga2hpIHjDs2EgZmlsZToge2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKCiAgICAgICAgICAgICAgICBlbGlmIHNldHVwX3R5cGUgPT0gIjQiOgogICAgICAgICAgICAgICAgICAgIHByaW50X2hlYWRlcigpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIlxu4pWU4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQIFhFTSBEQU5IIFPDgUNIIFTDgEkgS0hP4bqiTiDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZciICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArICLilZEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArICLilZEgIEhp4buDbiB0aOG7iyB0aMO0bmcgdGluIGNoaSB0aeG6v3QgduG7gSBjw6FjIHTDoGkga2hv4bqjbiAg4pWRIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWRICB2w6AgbGnDqm4ga+G6v3Qgc2VydmVyIMSRw6MgxJHGsOG7o2MgY+G6pXUgaMOsbmggICAgICAgICAgIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVmuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVnVxuIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBzZWxmLl9hY2NvdW50cyA9IHNlbGYubG9hZF9hY2NvdW50cygpCiAgICAgICAgICAgICAgICAgICAgc2VsZi5fc2VydmVyX2xpbmtzID0gc2VsZi5sb2FkX3NlcnZlcl9saW5rcygpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLlJFRCArICLimqDvuI8gQ2jGsGEgY8OzIHTDoGkga2hv4bqjbiBuw6BvIMSRxrDhu6NjIGPhuqV1IGjDrG5oISIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIlZ1aSBsw7JuZyBz4butIGThu6VuZyBjaOG7qWMgbsSDbmcgNSDEkeG7gyB04buxIMSR4buZbmcgY8OgaSDEkeG6t3QgVXNlciBJRC4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgICAgICBpbnB1dChGb3JlLkNZQU4gKyAiXG5OaOG6pW4gRW50ZXIgxJHhu4MgcXVheSBs4bqhaSBtZW51IGNow61uaC4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IHNlbGYuX3NlcnZlcl9saW5rczoKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyAi4pqg77iPIENoxrBhIGPDsyBsacOqbiBr4bq/dCBzZXJ2ZXIgbsOgbyDEkcaw4bujYyBj4bqldSBow6xuaCEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArICJWdWkgbMOybmcgc+G7rSBk4bulbmcgY2jhu6ljIG7Eg25nIDIgxJHhu4MgY8OgaSDEkeG6t3QgU2VydmVyL0dhbWUgSUQuIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgaW5wdXQoRm9yZS5DWUFOICsgIlxuTmjhuqVuIEVudGVyIMSR4buDIHF1YXkgbOG6oWkgbWVudSBjaMOtbmguLi4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgICAgICBjb250aW51ZQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgVOG6oW8gYuG6o25nIHRow7RuZyB0aW4gdMOgaSBraG/huqNuCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudF90YWJsZSA9IFtdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAixJBhbmcgbOG6pXkgdGjDtG5nIHRpbiB0w6BpIGtob+G6o24uLi4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGZvciBpLCAoKHBhY2thZ2VfbmFtZSwgdXNlcl9pZCksIChfLCBzZXJ2ZXJfbGluaykpIGluIGVudW1lcmF0ZSh6aXAoc2VsZi5fYWNjb3VudHMsIHNlbGYuX3NlcnZlcl9saW5rcyksIDEpOgogICAgICAgICAgICAgICAgICAgICAgICB1c2VybmFtZSA9IHNlbGYuZ2V0X3VzZXJuYW1lKHVzZXJfaWQpIG9yICJLaMO0bmcgeMOhYyDEkeG7i25oIgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBYw6FjIMSR4buLbmggbG/huqFpIGdhbWUgdOG7qyBzZXJ2ZXJfbGluawogICAgICAgICAgICAgICAgICAgICAgICBnYW1lX3R5cGUgPSAiS2jDtG5nIHjDoWMgxJHhu4tuaCIKICAgICAgICAgICAgICAgICAgICAgICAgaWYgIjE2MTQ2ODMyMTEzIiBpbiBzZXJ2ZXJfbGluazoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWVfdHlwZSA9ICJBbmltZSBWYW5ndWFyZHMiCiAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgIjEyODg2MTQzMDk1IiBpbiBzZXJ2ZXJfbGluazoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWVfdHlwZSA9ICJBbmltZSBMYXN0IFN0YW5kIgogICAgICAgICAgICAgICAgICAgICAgICBlbGlmICI4MzA0MTkxODMwIiBpbiBzZXJ2ZXJfbGluazoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGdhbWVfdHlwZSA9ICJBbmltZSBBZHZlbnR1cmVzIgogICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUcsOtY2ggeHXhuqV0IFBsYWNlSUQgbuG6v3UgY8OzCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnQgcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlX2lkX21hdGNoID0gcmUuc2VhcmNoKHIncGxhY2VJRD0oXGQrKScsIHNlcnZlcl9saW5rKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGxhY2VfaWRfbWF0Y2g6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2FtZV90eXBlID0gZiJHYW1lIElEOiB7cGxhY2VfaWRfbWF0Y2guZ3JvdXAoMSl9IgogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBUaMOqbSB2w6BvIGLhuqNuZyAoxJHDoyBsb+G6oWkgYuG7jyBj4buZdCB1c2VyX2lkIHbDoCB0cuG6oW5nIHRow6FpKQogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50X3RhYmxlLmFwcGVuZChbCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VfbmFtZSwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBnYW1lX3R5cGUKICAgICAgICAgICAgICAgICAgICAgICAgXSkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEhp4buDbiB0aOG7iyBi4bqjbmcgdGjDtG5nIHRpbiAoxJHDoyBsb+G6oWkgYuG7jyBoZWFkZXIgdXNlcl9pZCB2w6AgdHLhuqFuZyB0aMOhaSkKICAgICAgICAgICAgICAgICAgICBwcmludCgiXG4iICsgRm9yZS5DWUFOICsgIiAgICAgICAgICAgICAgICAgICAgICAgIERBTkggU8OBQ0ggVMOASSBLSE/huqJOICAgICAgICAgICAgICAiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIHByaW50KHRhYnVsYXRlKAogICAgICAgICAgICAgICAgICAgICAgICBhY2NvdW50X3RhYmxlLCAKICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVycz1bCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb3JlLllFTExPVyArICJTVFQiICsgU3R5bGUuUkVTRVRfQUxMLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvcmUuWUVMTE9XICsgIlTDqm4gbmfGsOG7nWkgZMO5bmciICsgU3R5bGUuUkVTRVRfQUxMLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvcmUuWUVMTE9XICsgIlBhY2thZ2UiICsgU3R5bGUuUkVTRVRfQUxMLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvcmUuWUVMTE9XICsgIkdhbWUiICsgU3R5bGUuUkVTRVRfQUxMCiAgICAgICAgICAgICAgICAgICAgICAgIF0sIAogICAgICAgICAgICAgICAgICAgICAgICB0YWJsZWZtdD0iZmFuY3lfZ3JpZCIKICAgICAgICAgICAgICAgICAgICApKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICMgSGnhu4NuIHRo4buLIHRow7RuZyB0aW4gdOG7lW5nIHF1YW4KICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgZiJcbuKckyBU4buVbmcgc+G7kSB0w6BpIGtob+G6o246IHtsZW4oc2VsZi5fYWNjb3VudHMpfSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArIGYi4pyTIFThu5VuZyBz4buRIGxpw6puIGvhur90IHNlcnZlcjoge2xlbihzZWxmLl9zZXJ2ZXJfbGlua3MpfSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBIaeG7g24gdGjhu4sgY8OhYyB0w7l5IGNo4buNbiBi4buVIHN1bmcKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyAiXG7ilZTilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgVMOZWSBDSOG7jE4gQuG7lCBTVU5HIOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVlyIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pWRIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWRICAxLiBLaeG7g20gdHJhIHRy4bqhbmcgdGjDoWkgb25saW5lICAgICAgICAgIOKVkSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIuKVkSAgMi4gUXVheSBs4bqhaSBtZW51IGNow61uaCAgICAgICAgICAgICAgICAg4pWRIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyAi4pWRICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArICLilZrilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZ0iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIG9wdGlvbiA9IGlucHV0KEZvcmUuQ1lBTiArICJcbuKWuiBOaOG6rXAgbOG7sWEgY2jhu41uIGPhu6dhIGLhuqFuICgxLTIpOiAiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIG9wdGlvbiA9PSAiMSI6CiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIlxuxJBhbmcga2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIG9ubGluZSBj4bunYSBjw6FjIHTDoGkga2hv4bqjbi4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFThuqFvIGLhuqNuZyB0cuG6oW5nIHRow6FpCiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c190YWJsZSA9IFtdCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIFRodSB0aOG6rXAgdOG6pXQgY+G6oyB1c2VyX2lkcyBj4bqnbiBraeG7g20gdHJhCiAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJfaWRzID0gW3VzZXJfaWQgZm9yIF8sIHVzZXJfaWQgaW4gc2VsZi5fYWNjb3VudHNdCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBvbmxpbmUgY+G7p2EgdOG6pXQgY+G6oyBuZ8aw4budaSBkw7luZyB0cm9uZyBt4buZdCBs4bqnbiBn4buNaSBBUEkKICAgICAgICAgICAgICAgICAgICAgICAgb25saW5lX3N0YXR1c2VzID0gYXdhaXQgc2VsZi5jaGVja191c2Vyc19vbmxpbmUodXNlcl9pZHMpCiAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICBmb3IgaSwgKChwYWNrYWdlX25hbWUsIHVzZXJfaWQpLCAoXywgc2VydmVyX2xpbmspKSBpbiBlbnVtZXJhdGUoemlwKHNlbGYuX2FjY291bnRzLCBzZWxmLl9zZXJ2ZXJfbGlua3MpLCAxKToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gc2VsZi5nZXRfdXNlcm5hbWUodXNlcl9pZCkgb3IgIktow7RuZyB4w6FjIMSR4buLbmgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTOG6pXkgdHLhuqFuZyB0aMOhaSBvbmxpbmUgdOG7qyBr4bq/dCBxdeG6oyDEkcOjIGPDswogICAgICAgICAgICAgICAgICAgICAgICAgICAgb25saW5lX3N0YXR1cyA9IG9ubGluZV9zdGF0dXNlcy5nZXQodXNlcl9pZCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHBhY2thZ2UgY8OzIMSRYW5nIGNo4bqheSBraMO0bmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VfcnVubmluZywgZXJyb3JfY29kZSA9IHNlbGYuaXNfcGFja2FnZV9ydW5uaW5nKHBhY2thZ2VfbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBYw6FjIMSR4buLbmggdHLhuqFuZyB0aMOhaQogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgb25saW5lX3N0YXR1cyBpcyBOb25lOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c190ZXh0ID0gIkFQSSBraMO0bmcgcGjhuqNuIGjhu5NpIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c19jb2xvciA9IEZvcmUuWUVMTE9XCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG9ubGluZV9zdGF0dXMgPT0gMDoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfdGV4dCA9ICJPZmZsaW5lIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c19jb2xvciA9IEZvcmUuUkVECiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG9ubGluZV9zdGF0dXMgPT0gMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfdGV4dCA9ICJUcm9uZyBz4bqjbmgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzX2NvbG9yID0gRm9yZS5CTFVFCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG9ubGluZV9zdGF0dXMgPT0gMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfdGV4dCA9ICLEkGFuZyBjaMahaSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfY29sb3IgPSBGb3JlLkdSRUVOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG9ubGluZV9zdGF0dXMgPT0gMzoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfdGV4dCA9ICJTdHVkaW8iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzX2NvbG9yID0gRm9yZS5NQUdFTlRBCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c190ZXh0ID0gIktow7RuZyB4w6FjIMSR4buLbmgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzX2NvbG9yID0gRm9yZS5ZRUxMT1cKICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBUcuG6oW5nIHRow6FpIHBhY2thZ2UKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVycm9yX2NvZGUgPT0gIjI3OSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZV9zdGF0dXMgPSAiTOG7l2kgMjc5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VfY29sb3IgPSBGb3JlLlJFRAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxpZiBwYWNrYWdlX3J1bm5pbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZV9zdGF0dXMgPSAixJBhbmcgY2jhuqF5IgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2VfY29sb3IgPSBGb3JlLkdSRUVOCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhY2thZ2Vfc3RhdHVzID0gIktow7RuZyBjaOG6oXkiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZV9jb2xvciA9IEZvcmUuUkVECiAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjDqm0gdsOgbyBi4bqjbmcKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c190YWJsZS5hcHBlbmQoWwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzX2NvbG9yICsgc3RhdHVzX3RleHQgKyBTdHlsZS5SRVNFVF9BTEwsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFja2FnZV9jb2xvciArIHBhY2thZ2Vfc3RhdHVzICsgU3R5bGUuUkVTRVRfQUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBIaeG7g24gdGjhu4sgYuG6o25nIHRy4bqhbmcgdGjDoWkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoIlxuIiArIEZvcmUuQ1lBTiArICLilZTilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZAgVFLhuqBORyBUSMOBSSBUw4BJIEtIT+G6ok4g4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWQ4pWXIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQodGFidWxhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfdGFibGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzPVsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb3JlLllFTExPVyArICJTVFQiICsgU3R5bGUuUkVTRVRfQUxMLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvcmUuWUVMTE9XICsgIlTDqm4gbmfGsOG7nWkgZMO5bmciICsgU3R5bGUuUkVTRVRfQUxMLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEZvcmUuWUVMTE9XICsgIlRy4bqhbmcgdGjDoWkgQVBJIiArIFN0eWxlLlJFU0VUX0FMTCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb3JlLllFTExPVyArICJUcuG6oW5nIHRow6FpIFBhY2thZ2UiICsgU3R5bGUuUkVTRVRfQUxMCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVmbXQ9ImZhbmN5X2dyaWQiCiAgICAgICAgICAgICAgICAgICAgICAgICkpCiAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuQ1lBTiArICLilZrilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZDilZ0iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlucHV0KEZvcmUuQ1lBTiArICJcbk5o4bqlbiBFbnRlciDEkeG7gyBxdWF5IGzhuqFpIG1lbnUgY2jDrW5oLi4uIiArIFN0eWxlLlJFU0VUX0FMTCkKCgogICAgICAgICAgICAgICAgZWxpZiBzZXR1cF90eXBlID09ICI1IjoKICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgIlThu7EgxJHhu5luZyBjw6BpIMSR4bq3dCBVc2VyIElEIHbDoCBQYWNrYWdlLi4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICBwYWNrYWdlcyA9IHNlbGYuZ2V0X3JvYmxveF9wYWNrYWdlcygpCiAgICAgICAgICAgICAgICAgICAgYWNjb3VudHMgPSBbXQogICAgICAgICAgICAgICAgICAgIHBhY2thZ2VfcGF0aHMgPSB7fQoKICAgICAgICAgICAgICAgICAgICBmb3IgcGFja2FnZV9uYW1lIGluIHBhY2thZ2VzOgogICAgICAgICAgICAgICAgICAgICAgICBmaWxlX3BhdGggPSBmJy9kYXRhL2RhdGEve3BhY2thZ2VfbmFtZX0vZmlsZXMvYXBwRGF0YS9Mb2NhbFN0b3JhZ2UvYXBwU3RvcmFnZS5qc29uJwogICAgICAgICAgICAgICAgICAgICAgICBwYWNrYWdlX3BhdGhzW3BhY2thZ2VfbmFtZV0gPSBmaWxlX3BhdGgucmVwbGFjZSgnL2FwcERhdGEvTG9jYWxTdG9yYWdlL2FwcFN0b3JhZ2UuanNvbicsICcnKQogICAgICAgICAgICAgICAgICAgICAgICB1c2VyX2lkID0gc2VsZi5maW5kX3VzZXJpZF9mcm9tX2ZpbGUoZmlsZV9wYXRoKQogICAgICAgICAgICAgICAgICAgICAgICBpZiB1c2VyX2lkOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgYWNjb3VudHMuYXBwZW5kKChwYWNrYWdlX25hbWUsIHVzZXJfaWQpKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJUw6xtIHRo4bqleSBVc2VyIElEIGNobyB7cGFja2FnZV9uYW1lfToge3VzZXJfaWR9IikKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgZiJLaMO0bmcgdMOsbSB0aOG6pXkgVXNlciBJRCBjaG8ge3BhY2thZ2VfbmFtZX0uIFZ1aSBsw7JuZyB0aOG7rSBs4bqhaSBzYXUuIiArIFN0eWxlLlJFU0VUX0FMTCkKCiAgICAgICAgICAgICAgICAgICAgaWYgYWNjb3VudHM6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc2F2ZV9hY2NvdW50cyhhY2NvdW50cykKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYXZlX3BhY2thZ2VfcGF0aHMocGFja2FnZV9wYXRocykKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5fcGFja2FnZV9wYXRocyA9IHBhY2thZ2VfcGF0aHMKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkMOjIGzGsHUgVXNlciBJRCB2w6AgUGFja2FnZSB04burIGFwcFN0b3JhZ2UuanNvbi4iICsgU3R5bGUuUkVTRVRfQUxMKQoKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZWN0ZWRfZ2FtZSA9IGdldF9nYW1lX3NlbGVjdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlZF9saW5rID0gZm9ybWF0X3NlcnZlcl9saW5rKHNlbGVjdGVkX2dhbWUpIGlmIHNlbGVjdGVkX2dhbWUgZWxzZSBOb25lCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGZvcm1hdHRlZF9saW5rOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyX2xpbmtzID0gWyhwYWNrYWdlX25hbWUsIGZvcm1hdHRlZF9saW5rKSBmb3IgcGFja2FnZV9uYW1lIGluIHBhY2thZ2VzXQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zYXZlX3NlcnZlcl9saW5rcyhzZXJ2ZXJfbGlua3MpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgIsSQw6MgbMawdSBJRCBHYW1lIHbDoCBMacOqbiBr4bq/dCBTZXJ2ZXIgUmnDqm5nIHRow6BuaCBjw7RuZyEiICsgU3R5bGUuUkVTRVRfQUxMKQoKICAgICAgICAgICAgICAgIGVsaWYgc2V0dXBfdHlwZSA9PSAiMCI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAixJBhbmcgdGhvw6F0Li4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICBleGl0ICgwKQoKICAgICAgICAgICAgICAgIGVsaWYgc2V0dXBfdHlwZSA9PSAiNiI6CiAgICAgICAgICAgICAgICAgICAgY2hlY2tfbW9kZSA9IGlucHV0KEZvcmUuQ1lBTiArICIiIuKVlOKVkOKVkOKVkCBNT0RFIEtJ4buCTSBUUkEgVsOAIENMRUFSIENBQ0hFIOKVkOKVkOKVkOKVlwrilZEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDilZEgICAK4pWRIDEuIENoZWNrIE9ubGluZSAgICAgICAgICAgICAgICAgICAg4pWRCuKVkSAgICAoa2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpIG9ubGluZSkgICAg4pWRCuKVkSAyLiBDaGVjayBQYWNrYWdlICAgICAgICAgICAgICAgICAgIOKVkQrilZEgICAgKGtp4buDbSB0cmEgcGFja2FnZSBob+G6oXQgxJHhu5luZykgICAg4pWRCuKVkSAzLiBYw7NhIENhY2hlICAgICAgICAgICAgICAgICAgICAgICDilZEgCuKVkSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIOKVkSAgCuKVmuKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVkOKVnQrilrpOaOG6rXAgbOG7sWEgY2jhu41uICgxLTMpOiAiIiIgKyBTdHlsZS5SRVNFVF9BTEwpCgogICAgICAgICAgICAgICAgICAgIGlmIGNoZWNrX21vZGUgPT0gIjEiOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9jaGVja19tb2RlID0gIm9ubGluZSIKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkMOjIGNo4buNbiBjaOG6vyDEkeG7mSBDaGVjayBPbmxpbmUiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgICAgIGVsaWYgY2hlY2tfbW9kZSA9PSAiMiI6CiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuX2NoZWNrX21vZGUgPSAicGFja2FnZSIKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkMOjIGNo4buNbiBjaOG6vyDEkeG7mSBDaGVjayBQYWNrYWdlIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICBlbGlmIGNoZWNrX21vZGUgPT0gIjMiOgogICAgICAgICAgICAgICAgICAgICAgICBzZWxmLl9jbGVhbnVwX2NhY2hlKCkKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkMOjIHjDs2EgdG/DoG4gYuG7mSBjYWNoZSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyAiTOG7sWEgY2jhu41uIGtow7RuZyBo4bujcCBs4buHISIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIGVsaWYgc2V0dXBfdHlwZSA9PSAiNyI6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5DWUFOICsgIj09PT09IEPDoGkgxJHhurd0IERpc2NvcmQgV2ViaG9vayA9PT09PSIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgY3VycmVudF9jb25maWcgPSBsb2FkX2Rpc2NvcmRfY29uZmlnKCkKICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3dlYmhvb2sgPSBjdXJyZW50X2NvbmZpZy5nZXQoIldFQkhPT0tfVVJMIiwgIiIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbWFza2VkX3dlYmhvb2sgPSAi4oCi4oCi4oCi4oCi4oCi4oCi4oCi4oCiIiArIGN1cnJlbnRfd2ViaG9va1stODpdIGlmIGN1cnJlbnRfd2ViaG9vayBlbHNlICJDaMawYSBjw6BpIMSR4bq3dCIKICAgICAgICAgICAgICAgICAgICBwcmludChmIldlYmhvb2sgVVJMIGhp4buHbiB04bqhaToge21hc2tlZF93ZWJob29rfSIpCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgbmV3X3dlYmhvb2sgPSBpbnB1dChGb3JlLllFTExPVyArICJOaOG6rXAgV2ViaG9vayBVUkwgKMSR4buDIHRy4buRbmcgbuG6v3UgZ2nhu68gbmd1ecOqbik6ICIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgaWYgbm90IG5ld193ZWJob29rOgogICAgICAgICAgICAgICAgICAgICAgICBuZXdfd2ViaG9vayA9IGN1cnJlbnRfd2ViaG9vawogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHNhdmVfZGlzY29yZF9jb25maWcobmV3X3dlYmhvb2spCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5HUkVFTiArICLEkMOjIGPhuq1wIG5o4bqtdCBXZWJob29rIFVSTCEiICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICAgICAgZWxpZiBzZXR1cF90eXBlID09ICI4IjoKICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmF1dG9fbG9naW5fdmlhX2Nvb2tpZSgpCiAgICAgICAgICAgICAgICBlbGlmIHNldHVwX3R5cGUgPT0gIjkiOgogICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuZXh0cmFjdF9jb29raWVzX2Zyb21fcGFja2FnZXMoKQoKICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyAiTOG7sWEgY2jhu41uIGtow7RuZyBo4bujcCBs4buHISIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDIpCiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgIHByaW50KEZvcmUuUkVEICsgZiJM4buXaToge2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIkVycm9yIGluIG1lbnU6IHtlfSIpCiAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDIpCgogICAgYXN5bmMgZGVmIHN0YXJ0X2F1dG9fcmVqb2luKHNlbGYsIHJlc3RhcnRfbWludXRlcz1Ob25lKToKICAgICAgICBwcmludChGb3JlLllFTExPVyArICLEkGFuZyB04bqvdCBjw6FjIHRyw7IgY2jGoWkgUm9ibG94Li4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBzdWJwcm9jZXNzLnJ1bihbJ3BraWxsJywgJy1mJywgJ3JvYmxveCddLCBzdGRvdXQ9c3VicHJvY2Vzcy5ERVZOVUxMLCBzdGRlcnI9c3VicHJvY2Vzcy5ERVZOVUxMKQogICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoNSkKCiAgICAgICAgIyBMb2FkIHBhY2thZ2UgcGF0aHMgZm9yIHBhY2thZ2UgY2hlY2sgbW9kZQogICAgICAgIHNlbGYuX3BhY2thZ2VfcGF0aHMgPSBzZWxmLmxvYWRfcGFja2FnZV9wYXRocygpCiAgICAgICAgaWYgc2VsZi5fY2hlY2tfbW9kZSA9PSAicGFja2FnZSIgYW5kIG5vdCBzZWxmLl9wYWNrYWdlX3BhdGhzOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArICJLaMO0bmcgdMOsbSB0aOG6pXkgdGjDtG5nIHRpbiBwYWNrYWdlLiBWdWkgbMOybmcgc+G7rSBk4bulbmcgY2jhu6ljIG7Eg25nIDUgxJHhu4Mgc2V0dXAgcGFja2FnZS4iICsgU3R5bGUuUkVTRVRfQUxMKQogICAgICAgICAgICByZXR1cm4KICAgICAgICAKICAgICAgICAjIEluaXRpYWxpemUgY29ubmVjdGlvbiBzdGF0ZSB0cmFja2luZwogICAgICAgIHNlbGYuY29ubmVjdGlvbl9zdGF0ZXMgPSB7fQogICAgICAgIGZvciBfLCB1c2VyX2lkIGluIHNlbGYuX2FjY291bnRzOgogICAgICAgICAgICBzZWxmLmNvbm5lY3Rpb25fc3RhdGVzW3VzZXJfaWRdID0gewogICAgICAgICAgICAgICAgIm9mZmxpbmVfY291bnQiOiAwLAogICAgICAgICAgICAgICAgImxhc3Rfc3RhdHVzIjogTm9uZSwKICAgICAgICAgICAgICAgICJsYXN0X2NoZWNrX3RpbWUiOiBkYXRldGltZS5ub3coKSwKICAgICAgICAgICAgICAgICJlcnJvcl9jb2RlIjogTm9uZSwKICAgICAgICAgICAgICAgICJyZXRyeV9jb3VudCI6IDAKICAgICAgICAgICAgfQoKICAgICAgICAjIExhdW5jaCBpbml0aWFsIGluc3RhbmNlcwogICAgICAgIHByaW50KEZvcmUuQ1lBTiArICLEkGFuZyBraOG7n2kgxJHhu5luZyBjw6FjIHBoacOqbiBi4bqjbi4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgZm9yIHBhY2thZ2VfbmFtZSwgc2VydmVyX2xpbmsgaW4gc2VsZi5fc2VydmVyX2xpbmtzOgogICAgICAgICAgICBhd2FpdCBzZWxmLmxhdW5jaF9yb2Jsb3gocGFja2FnZV9uYW1lLCBzZXJ2ZXJfbGluaykKICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgyKSAgIyBTbWFsbCBkZWxheSBiZXR3ZWVuIGxhdW5jaGVzCgogICAgICAgIHByaW50KEZvcmUuR1JFRU4gKyAixJDDoyBraOG7n2kgxJHhu5luZyB04bqldCBj4bqjIGPDoWMgcGhpw6puIGLhuqNuLiBC4bqvdCDEkeG6p3UgdGhlbyBkw7VpLi4uIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAKICAgICAgICAjIEJp4bq/biDEkeG7gyB0aGVvIGTDtWkgdGjhu51pIGdpYW4ga2jhu59pIMSR4buZbmcgbOG6oWkKICAgICAgICBsYXN0X3Jlc3RhcnRfdGltZSA9IGRhdGV0aW1lLm5vdygpCiAgICAgICAgIyBCaeG6v24gxJHhur9tIMSR4buDIGzDoG0gc+G6oWNoIGNhY2hlIMSR4buLbmgga+G7swogICAgICAgIGNoZWNrX2NvdW50ZXIgPSAwCiAgICAgICAgbGFzdF9yZXBvcnRfdGltZSA9IGRhdGV0aW1lLm5vdygpCiAgICAgICAgcmVwb3J0X2ludGVydmFsID0gMzAgICMgIHRo4budaSBnaWFuIGfhu61pIGLDoW8gY8OhbyAoZ2nDonkpCiAgICAgICAgdHJ5OgogICAgICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAgICAgY3VycmVudF90aW1lID0gZGF0ZXRpbWUubm93KCkKICAgICAgICAgICAgICAgIHRpbWVfc3RyID0gY3VycmVudF90aW1lLnN0cmZ0aW1lKCIlSDolTTolUyIpCiAgICAgICAgICAgICAgICBwcmludChmIlxue0ZvcmUuQ1lBTn1be3RpbWVfc3RyfV0gS2nhu4NtIHRyYSB0cuG6oW5nIHRow6FpLi4ue1N0eWxlLlJFU0VUX0FMTH0iKQoKICAgICAgICAgICAgICAgICMgVMSDbmcgYmnhur9uIMSR4bq/bSB2w6AgbMOgbSBz4bqhY2ggY2FjaGUgbuG6v3UgY+G6p24KICAgICAgICAgICAgICAgIGNoZWNrX2NvdW50ZXIgKz0gMQogICAgICAgICAgICAgICAgaWYgY2hlY2tfY291bnRlciA+PSAxMDoKICAgICAgICAgICAgICAgICAgICBzZWxmLl9jbGVhbnVwX2NhY2hlKCkKICAgICAgICAgICAgICAgICAgICBjaGVja19jb3VudGVyID0gMAogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIMSRw6MgxJHhur9uIHRo4budaSBnaWFuIGfhu61pIGLDoW8gY8OhbyBjaMawYQogICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRfdGltZSAtIGxhc3RfcmVwb3J0X3RpbWUpLnRvdGFsX3NlY29uZHMoKSA+PSByZXBvcnRfaW50ZXJ2YWw6CiAgICAgICAgICAgICAgICAgICAgdHJ5OgogICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLnNlbmRfcGVyaW9kaWNfc3RhdHVzX3JlcG9ydCgpCiAgICAgICAgICAgICAgICAgICAgICAgIGxhc3RfcmVwb3J0X3RpbWUgPSBjdXJyZW50X3RpbWUKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJ7Rm9yZS5HUkVFTn1be3RpbWVfc3RyfV0gxJDDoyBn4butaSBiw6FvIGPDoW8gdHLhuqFuZyB0aMOhaSDEkeG7i25oIGvhu7N7U3R5bGUuUkVTRVRfQUxMfSIpCiAgICAgICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSBraGkgZ+G7rWkgYsOhbyBjw6FvIMSR4buLbmgga+G7szoge2V9IikKICAgICAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJ7Rm9yZS5SRUR9W3t0aW1lX3N0cn1dIEzhu5dpIGtoaSBn4butaSBiw6FvIGPDoW8gxJHhu4tuaCBr4buzOiB7ZX17U3R5bGUuUkVTRVRfQUxMfSIpCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgeGVtIGPDsyBj4bqnbiBraOG7n2kgxJHhu5luZyBs4bqhaSB04bqldCBj4bqjIGtow7RuZwogICAgICAgICAgICAgICAgaWYgcmVzdGFydF9taW51dGVzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGVsYXBzZWRfbWludXRlcyA9IChjdXJyZW50X3RpbWUgLSBsYXN0X3Jlc3RhcnRfdGltZSkudG90YWxfc2Vjb25kcygpIC8gNjAKICAgICAgICAgICAgICAgICAgICBpZiBlbGFwc2VkX21pbnV0ZXMgPj0gcmVzdGFydF9taW51dGVzOgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChmIntGb3JlLllFTExPV31be3RpbWVfc3RyfV0gxJDDoyDEkeG6v24gdGjhu51pIGdpYW4ga2jhu59pIMSR4buZbmcgbOG6oWkgdOG6pXQgY+G6oyAoe3Jlc3RhcnRfbWludXRlc30gcGjDunQpe1N0eWxlLlJFU0VUX0FMTH0iKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBUaMO0bmcgYsOhbyBEaXNjb3JkIG7hur91IMSRxrDhu6NjIGPhuqV1IGjDrG5oCiAgICAgICAgICAgICAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYuc2VuZF9kaXNjb3JkX21lc3NhZ2UoZiLEkGFuZyBraOG7n2kgxJHhu5luZyBs4bqhaSB04bqldCBj4bqjIGPDoWMgcGhpw6puIGLhuqNuIFJvYmxveCB0aGVvIGzhu4tjaCB0csOsbmggKHtyZXN0YXJ0X21pbnV0ZXN9IHBow7p0KSIpCiAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmIktow7RuZyB0aOG7gyBn4butaSB0aMO0bmcgYsOhbyBEaXNjb3JkOiB7ZX0iKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBU4bqvdCB04bqldCBj4bqjIGPDoWMgcGhpw6puIGLhuqNuIFJvYmxveAogICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArICLEkGFuZyB04bqvdCB04bqldCBj4bqjIGPDoWMgcGhpw6puIGLhuqNuIFJvYmxveC4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIHN1YnByb2Nlc3MucnVuKFsncGtpbGwnLCAnLWYnLCAncm9ibG94J10sIHN0ZG91dD1zdWJwcm9jZXNzLkRFVk5VTEwsIHN0ZGVycj1zdWJwcm9jZXNzLkRFVk5VTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoNSkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgS2jhu59pIMSR4buZbmcgbOG6oWkgdOG6pXQgY+G6oyBjw6FjIHBoacOqbiBi4bqjbgogICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkNZQU4gKyAixJBhbmcga2jhu59pIMSR4buZbmcgbOG6oWkgdOG6pXQgY+G6oyBjw6FjIHBoacOqbiBi4bqjbi4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBwYWNrYWdlX25hbWUsIHNlcnZlcl9saW5rIGluIHNlbGYuX3NlcnZlcl9saW5rczoKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbGYubGF1bmNoX3JvYmxveChwYWNrYWdlX25hbWUsIHNlcnZlcl9saW5rKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgyKQogICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgIyBD4bqtcCBuaOG6rXQgdGjhu51pIGdpYW4ga2jhu59pIMSR4buZbmcgbOG6oWkKICAgICAgICAgICAgICAgICAgICAgICAgbGFzdF9yZXN0YXJ0X3RpbWUgPSBkYXRldGltZS5ub3coKQogICAgICAgICAgICAgICAgICAgICAgICBwcmludChGb3JlLkdSRUVOICsgIsSQw6Mga2jhu59pIMSR4buZbmcgbOG6oWkgdOG6pXQgY+G6oyBjw6FjIHBoacOqbiBi4bqjbiB0aMOgbmggY8O0bmchIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICMgUmVzZXQgdHLhuqFuZyB0aMOhaSB0aGVvIGTDtWkKICAgICAgICAgICAgICAgICAgICAgICAgZm9yIF8sIHVzZXJfaWQgaW4gc2VsZi5fYWNjb3VudHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmNvbm5lY3Rpb25fc3RhdGVzW3VzZXJfaWRdID0gewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJvZmZsaW5lX2NvdW50IjogMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAibGFzdF9zdGF0dXMiOiBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJsYXN0X2NoZWNrX3RpbWUiOiBkYXRldGltZS5ub3coKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiZXJyb3JfY29kZSI6IE5vbmUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgInJldHJ5X2NvdW50IjogMAogICAgICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIFByZXBhcmUgdGFibGUgZGF0YQogICAgICAgICAgICAgICAgdGFibGVfZGF0YSA9IFtdCiAgICAgICAgICAgICAgICBoZWFkZXJzID0gWyJUw6BpIGtob+G6o24iLCAiVHLhuqFuZyB0aMOhaSIsICJQYWNrYWdlIiwgIkzhu5dpIl0gaWYgc2VsZi5fY2hlY2tfbW9kZSA9PSAicGFja2FnZSIgZWxzZSBbIlTDoGkga2hv4bqjbiIsICJUcuG6oW5nIHRow6FpIiwgIkzhu5dpIiwgIkvhur90IG7hu5FpIl0KCiAgICAgICAgICAgICAgICAjIEhp4buDbiB0aOG7iyB0aOG7nWkgZ2lhbiBjw7JuIGzhuqFpIMSR4bq/biBs4bqnbiBraOG7n2kgxJHhu5luZyBs4bqhaSB0aeG6v3AgdGhlbwogICAgICAgICAgICAgICAgaWYgcmVzdGFydF9taW51dGVzIGlzIG5vdCBOb25lOgogICAgICAgICAgICAgICAgICAgIGVsYXBzZWRfbWludXRlcyA9IChjdXJyZW50X3RpbWUgLSBsYXN0X3Jlc3RhcnRfdGltZSkudG90YWxfc2Vjb25kcygpIC8gNjAKICAgICAgICAgICAgICAgICAgICByZW1haW5pbmdfbWludXRlcyA9IG1heCgwLCByZXN0YXJ0X21pbnV0ZXMgLSBlbGFwc2VkX21pbnV0ZXMpCiAgICAgICAgICAgICAgICAgICAgcmVtYWluaW5nX2hvdXJzID0gaW50KHJlbWFpbmluZ19taW51dGVzIC8vIDYwKQogICAgICAgICAgICAgICAgICAgIHJlbWFpbmluZ19taW5zID0gaW50KHJlbWFpbmluZ19taW51dGVzICUgNjApCiAgICAgICAgICAgICAgICAgICAgcHJpbnQoZiJ7Rm9yZS5DWUFOfVRo4budaSBnaWFuIMSR4bq/biBs4bqnbiBraOG7n2kgxJHhu5luZyBs4bqhaSB0aeG6v3AgdGhlbzoge3JlbWFpbmluZ19ob3Vyc31oIHtyZW1haW5pbmdfbWluc31te1N0eWxlLlJFU0VUX0FMTH0iKQoKICAgICAgICAgICAgICAgICMgVGh1IHRo4bqtcCB04bqldCBj4bqjIHVzZXJfaWRzIGPhuqduIGtp4buDbSB0cmEKICAgICAgICAgICAgICAgIHVzZXJfaWRzID0gW3VzZXJfaWQgZm9yIF8sIHVzZXJfaWQgaW4gc2VsZi5fYWNjb3VudHNdCiAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBvbmxpbmUgY+G7p2EgdOG6pXQgY+G6oyBuZ8aw4budaSBkw7luZyB0cm9uZyBt4buZdCBs4bqnbiBn4buNaSBBUEkKICAgICAgICAgICAgICAgIG9ubGluZV9zdGF0dXNlcyA9IGF3YWl0IHNlbGYuY2hlY2tfdXNlcnNfb25saW5lKHVzZXJfaWRzKQoKICAgICAgICAgICAgICAgICMgQsOieSBnaeG7nSB44butIGzDvSB04burbmcgdMOgaSBraG/huqNuIHbhu5tpIGvhur90IHF14bqjIMSRw6MgY8OzCiAgICAgICAgICAgICAgICBmb3IgcGFja2FnZV9uYW1lLCB1c2VyX2lkIGluIHNlbGYuX2FjY291bnRzOgogICAgICAgICAgICAgICAgICAgIHVzZXJuYW1lID0gc2VsZi5nZXRfdXNlcm5hbWUodXNlcl9pZCkgb3IgdXNlcl9pZAogICAgICAgICAgICAgICAgICAgIHN0YXRlID0gc2VsZi5jb25uZWN0aW9uX3N0YXRlc1t1c2VyX2lkXQogICAgICAgICAgICAgICAgICAgIHJvdyA9IFtdCiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgIyBM4bqleSB0cuG6oW5nIHRow6FpIG9ubGluZSB04burIGvhur90IHF14bqjIMSRw6MgY8OzCiAgICAgICAgICAgICAgICAgICAgb25saW5lX3N0YXR1cyA9IG9ubGluZV9zdGF0dXNlcy5nZXQodXNlcl9pZCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAjIEtp4buDbSB0cmEgdHLhuqFuZyB0aMOhaSBwYWNrYWdlCiAgICAgICAgICAgICAgICAgICAgcGFja2FnZV9ydW5uaW5nLCBlcnJvcl9jb2RlID0gc2VsZi5pc19wYWNrYWdlX3J1bm5pbmcocGFja2FnZV9uYW1lKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGlmIHNlbGYuX2NoZWNrX21vZGUgPT0gIm9ubGluZSI6CiAgICAgICAgICAgICAgICAgICAgICAgICMgWOG7rSBsw70gZOG7sWEgdHLDqm4gdHLhuqFuZyB0aMOhaSBvbmxpbmUKICAgICAgICAgICAgICAgICAgICAgICAgaWYgb25saW5lX3N0YXR1cyA9PSAwIG9yIG5vdCBwYWNrYWdlX3J1bm5pbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZVsib2ZmbGluZV9jb3VudCJdICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0YXRlWyJvZmZsaW5lX2NvdW50Il0gPj0gc2VsZi5fb2ZmbGluZV90aHJlc2hvbGQ6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93ID0gW3VzZXJuYW1lLCAiT2ZmbGluZSIsIGYie3N0YXRlWydvZmZsaW5lX2NvdW50J119IGzhuqduIiwgIkzhu5dpIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnk6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYua2lsbF9zcGVjaWZpY19yb2Jsb3hfcHJvY2VzcyhwYWNrYWdlX25hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IGFzeW5jaW8uc2xlZXAoNykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyX2xpbmsgPSBuZXh0KChsaW5rIGZvciBwa2csIGxpbmsgaW4gc2VsZi5fc2VydmVyX2xpbmtzIGlmIHBrZyA9PSBwYWNrYWdlX25hbWUpLCBOb25lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZXJ2ZXJfbGluazoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjDqm0gdGjDtG5nIGLDoW8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KGYie0ZvcmUuWUVMTE9XfcSQYW5nIGto4bufaSDEkeG7mW5nIGzhuqFpIHtwYWNrYWdlX25hbWV9IGNobyB7dXNlcm5hbWV9Li4ue1N0eWxlLlJFU0VUX0FMTH0iKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgc2VsZi5sYXVuY2hfcm9ibG94KHBhY2thZ2VfbmFtZSwgc2VydmVyX2xpbmspCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZVsib2ZmbGluZV9jb3VudCJdID0gMCAgIyBSZXNldCBjb3VudGVyIGFmdGVyIHJlc3RhcnQKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgVGjDqm0gZGVsYXkgc2F1IGtoaSBsYXVuY2ggxJHhu4MgaOG7hyB0aOG7kW5nIOG7lW4gxJHhu4tuaAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgzKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYiRXJyb3IgZHVyaW5nIHJlam9pbiBmb3Ige3VzZXJuYW1lfToge2V9IikgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93ID0gW3VzZXJuYW1lLCAiS2nhu4NtIHRyYSIsIGYiT2ZmbGluZSB7c3RhdGVbJ29mZmxpbmVfY291bnQnXX0iLCAiS2nhu4NtIHRyYSJdCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFjDoWMgxJHhu4tuaCB0cuG6oW5nIHRow6FpIHThu6sgb25saW5lX3N0YXR1cwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzX3RleHQgPSAiS2jDtG5nIHjDoWMgxJHhu4tuaCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG9ubGluZV9zdGF0dXMgPT0gMToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfdGV4dCA9ICJUcm9uZyBz4bqjbmgiCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG9ubGluZV9zdGF0dXMgPT0gMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXNfdGV4dCA9ICLEkGFuZyBjaMahaSIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsaWYgb25saW5lX3N0YXR1cyA9PSAzOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1c190ZXh0ID0gIlN0dWRpbyIKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdyA9IFt1c2VybmFtZSwgc3RhdHVzX3RleHQsICItIiwgIlThu5F0Il0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlWyJvZmZsaW5lX2NvdW50Il0gPSAwICAjIFJlc2V0IGNvdW50ZXIgd2hlbiBvbmxpbmUKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICAjIFBhY2thZ2UgY2hlY2sgbW9kZSB3aXRoIGVycm9yIGhhbmRsaW5nCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIGVycm9yX2NvZGUgPT0gIjI3OSI6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cgPSBbdXNlcm5hbWUsICJM4buXaSAyNzkiLCBwYWNrYWdlX25hbWUsICLEkOG7o2kgMzBzIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYua2lsbF9zcGVjaWZpY19yb2Jsb3hfcHJvY2VzcyhwYWNrYWdlX25hbWUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZXJ2ZXJfbGluayA9IG5leHQoKGxpbmsgZm9yIHBrZywgbGluayBpbiBzZWxmLl9zZXJ2ZXJfbGlua3MgaWYgcGtnID09IHBhY2thZ2VfbmFtZSksIE5vbmUpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBzZXJ2ZXJfbGluazoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxhdW5jaF9yb2Jsb3gocGFja2FnZV9uYW1lLCBzZXJ2ZXJfbGluaywgZXJyb3JfY29kZT0iMjc5IikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZVsib2ZmbGluZV9jb3VudCJdID0gMAogICAgICAgICAgICAgICAgICAgICAgICBlbGlmIG5vdCBwYWNrYWdlX3J1bm5pbmc6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZVsib2ZmbGluZV9jb3VudCJdICs9IDEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHN0YXRlWyJvZmZsaW5lX2NvdW50Il0gPj0gMjoKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZVsicmV0cnlfY291bnQiXSArPSAxCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVbImxhc3RfY2hlY2tfdGltZSJdID0gZGF0ZXRpbWUubm93KCkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3cgPSBbdXNlcm5hbWUsICJLaMO0bmcgaG/huqF0IMSR4buZbmciLCBwYWNrYWdlX25hbWUsIGYiUmV0cnkge3N0YXRlWydyZXRyeV9jb3VudCddfSJdCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5raWxsX3NwZWNpZmljX3JvYmxveF9wcm9jZXNzKHBhY2thZ2VfbmFtZSkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBhc3luY2lvLnNsZWVwKDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VydmVyX2xpbmsgPSBuZXh0KChsaW5rIGZvciBwa2csIGxpbmsgaW4gc2VsZi5fc2VydmVyX2xpbmtzIGlmIHBrZyA9PSBwYWNrYWdlX25hbWUpLCBOb25lKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIHNlcnZlcl9saW5rOgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBzZWxmLmxhdW5jaF9yb2Jsb3gocGFja2FnZV9uYW1lLCBzZXJ2ZXJfbGluaykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGVbIm9mZmxpbmVfY291bnQiXSA9IDAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93ID0gW3VzZXJuYW1lLCBmIktp4buDbSB0cmEgbOG6p24ge3N0YXRlWydvZmZsaW5lX2NvdW50J119IiwgcGFja2FnZV9uYW1lLCAiLSJdCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjIFBhY2thZ2UgxJFhbmcgY2jhuqF5IGLDrG5oIHRoxrDhu51uZwogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc3RhdGVbIm9mZmxpbmVfY291bnQiXSA+IDA6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93ID0gW3VzZXJuYW1lLCAixJDDoyBwaOG7pWMgaOG7k2kiLCBwYWNrYWdlX25hbWUsICItIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93ID0gW3VzZXJuYW1lLCAiSG/huqF0IMSR4buZbmciLCBwYWNrYWdlX25hbWUsICItIl0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlWyJvZmZsaW5lX2NvdW50Il0gPSAwICAjIFJlc2V0IGNvdW50ZXIgd2hlbiBydW5uaW5nCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZVsicmV0cnlfY291bnQiXSA9IDAgICMgUmVzZXQgc+G7kSBs4bqnbiB0aOG7rSBr4bq/dCBu4buRaQogICAgICAgICAgICAgICAgICAgIHRhYmxlX2RhdGEuYXBwZW5kKHJvdykKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICMgQ2xlYXIgc2NyZWVuIGFuZCBwcmludCB0YWJsZQogICAgICAgICAgICAgICAgb3Muc3lzdGVtKCdjbHMnIGlmIG9zLm5hbWUgPT0gJ250JyBlbHNlICdjbGVhcicpCiAgICAgICAgICAgICAgICBwcmludF9oZWFkZXIoKQogICAgICAgICAgICAgICAgcHJpbnQodGFidWxhdGUodGFibGVfZGF0YSwgaGVhZGVycz1oZWFkZXJzLCB0YWJsZWZtdD0iZ3JpZCIpKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgIyBVcGRhdGUgbGFzdCBjaGVjayB0aW1lIGZvciBhbGwgc3RhdGVzCiAgICAgICAgICAgICAgICBmb3Igc3RhdGUgaW4gc2VsZi5jb25uZWN0aW9uX3N0YXRlcy52YWx1ZXMoKToKICAgICAgICAgICAgICAgICAgICBzdGF0ZVsibGFzdF9jaGVja190aW1lIl0gPSBkYXRldGltZS5ub3coKQogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAjIERpZmZlcmVudCBjaGVjayBpbnRlcnZhbHMgZm9yIGRpZmZlcmVudCBtb2RlcwogICAgICAgICAgICAgICAgYXdhaXQgYXN5bmNpby5zbGVlcCgzMCBpZiBzZWxmLl9jaGVja19tb2RlID09ICJvbmxpbmUiIGVsc2UgMTApCiAgICAgICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgICAgICBwcmludChGb3JlLllFTExPVyArICJcbsSQYW5nIGThu6tuZyBhdXRvIHJlam9pbi4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBsb2dnZXIuZXJyb3IoZiJFcnJvciBpbiBhdXRvIHJlam9pbjoge2V9IikKICAgICAgICAgICAgcHJpbnQoRm9yZS5SRUQgKyBmIlxuTOG7l2kgeOG6o3kgcmE6IHtlfSIgKyBTdHlsZS5SRVNFVF9BTEwpCgphc3luYyBkZWYgbWFpbigpOgogICAgdHJ5OgogICAgICAgICMgSGnhu4NuIHRo4buLIG3DoG4gaMOsbmggeMOhYyB0aOG7sWMga2V5IHRyxrDhu5tjCiAgICAgICAgbGljZW5zZV92YWxpZCA9IGF3YWl0IHNob3dfbGljZW5zZV9zY3JlZW4oKQogICAgICAgIGlmIG5vdCBsaWNlbnNlX3ZhbGlkOgogICAgICAgICAgICBwcmludChGb3JlLlJFRCArICJLaMO0bmcgdGjhu4MgeMOhYyB0aOG7sWMga2V5LiBDaMawxqFuZyB0csOsbmggc+G6vSB0aG/DoXQuIiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgICAgIAogICAgICAgICMgTuG6v3Uga2V5IGjhu6NwIGzhu4csIHRp4bq/cCB04bulYyBjaOG6oXkgY2jGsMahbmcgdHLDrG5oCiAgICAgICAgbWFuYWdlciA9IFJvYmxveE1hbmFnZXIoKQogICAgICAgIGF3YWl0IG1hbmFnZXIucnVuX21lbnUoKQogICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgIHByaW50KEZvcmUuUkVEICsgZiJM4buXaToge2V9IiArIFN0eWxlLlJFU0VUX0FMTCkKICAgICAgICBsb2dnZXIuZXJyb3IoZiJM4buXaSB0cm9uZyBtYWluOiB7ZX0iKQogICAgZXhjZXB0IEtleWJvYXJkSW50ZXJydXB0OgogICAgICAgIHByaW50KEZvcmUuWUVMTE9XICsgIlRob8OhdC4uLiIgKyBTdHlsZS5SRVNFVF9BTEwpCgoKaWYgX19uYW1lX18gPT0gIl9fbWFpbl9fIjoKICAgIHRyeToKICAgICAgICBhc3luY2lvLnJ1bihtYWluKCkpCiAgICBleGNlcHQgS2V5Ym9hcmRJbnRlcnJ1cHQ6CiAgICAgICAgcHJpbnQoRm9yZS5ZRUxMT1cgKyAiVGhvw6F0Li4uIiArIFN0eWxlLlJFU0VUX0FMTCk=').decode())
